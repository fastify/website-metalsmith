<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Decorators</title><meta name=description content="Fast and low overhead web framework, for Node.js"><link rel=apple-touch-icon sizes=57x57 href=/images/apple-icon-57x57.ed24c0a19503e080.png><link rel=apple-touch-icon sizes=60x60 href=/images/apple-icon-60x60.60c285c424d50738.png><link rel=apple-touch-icon sizes=72x72 href=/images/apple-icon-72x72.e49b27cfe1ab1461.png><link rel=apple-touch-icon sizes=76x76 href=/images/apple-icon-76x76.752f43fc91b8c1f7.png><link rel=apple-touch-icon sizes=114x114 href=/images/apple-icon-114x114.61739fa1d5a7059a.png><link rel=apple-touch-icon sizes=120x120 href=/images/apple-icon-120x120.7c25de37c5ce2ec1.png><link rel=apple-touch-icon sizes=144x144 href=/images/apple-icon-144x144.04d88fb27bd92cbe.png><link rel=apple-touch-icon sizes=152x152 href=/images/apple-icon-152x152.9364781175671626.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-icon-180x180.67579100928bfcd2.png><link rel=icon type=image/png sizes=192x192 href=/images/android-icon-192x192.37eb7f1ae3853740.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.1e22f0e774bc3cce.png><link rel=icon type=image/png sizes=96x96 href=/images/favicon-96x96.7e8a68b1b80c1799.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.e534ce05cb727f1a.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content=#ffffff><meta name=msapplication-TileImage content=/images/ms-icon-144x144.png><meta name=theme-color content=#ffffff><meta property=og:url content=https://www.fastify.io/docs/v3.0.x/Decorators><meta property=og:type content=website><meta property=og:title content=Decorators><meta property=og:description content="Fast and low overhead web framework, for Node.js"><meta property=og:image content=https://www.fastify.io/images/fastify-fb-share-image.07b6e6860853c758.png><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@fastifyjs><meta name=twitter:creator content=@fastifyjs><meta name=twitter:title content=Decorators><meta name=twitter:description content="Fast and low overhead web framework, for Node.js"><meta name=twitter:image content=https://www.fastify.io/images/fastify-twitter-share-image.cd9f217b360af3e2.png><link rel=stylesheet href=/css/style.d15a109af4abe61e.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css integrity="sha256-Zd1icfZ72UBmsId/mUcagrmN7IN5Qkrvh75ICHIQVTk=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css crossorigin=anonymous></head><body><nav id=main-navbar class=navbar><div class=navbar-brand><a class=navbar-item href=/ ><img src=/images/fastify-logo-menu.d13f8da7a965c800.png alt="Fastify: Fast and low overhead web framework, for Node.js" height=28> </a><a class="navbar-item is-hidden-desktop" href=https://github.com/fastify/fastify target=_blank><span class=icon style="color: #333;"><i class="fa fa-github"></i></span></a><div class="navbar-burger burger" data-target=mobileMenu><span></span> <span></span> <span></span></div></div><div class=navbar-menu id=mobileMenu><div class=navbar-start><a class=navbar-item href=/ >Home</a> <a class=navbar-item href=/docs/latest>Docs</a> <a class=navbar-item href=/ecosystem>Ecosystem</a> <a class=navbar-item href=/benchmarks>Benchmarks</a> <a class=navbar-item href=/contribute>Contribute</a> <a class=navbar-item href=https://medium.com/@fastifyjs/ >Blog</a> <a class=navbar-item href=https://github.com/fastify/help>Help</a></div><div class=navbar-end><span class="control has-icons-left navbar-item"><input id=algolia-search-input class=input type=search placeholder=""> <span class="icon is-medium is-left"><i class="fa fa-search"></i> </span></span><a class=navbar-item href=https://github.com/fastify/fastify target=_blank><span class="fa fa-github"></span>&nbsp;GitHub </a><a class=navbar-item href=https://twitter.com/fastifyjs target=_blank><span class="fa fa-twitter"></span>&nbsp;Twitter</a></div></div></nav><main class=page-content aria-label=Content><section class="hero is-primary" style="background-image: url(/images/bg-pattern-dark.3f8cda863b3bbf52.png)"><div class=hero-body><div class=container><h1 class=title>Documentation (v3.0.3)</h1></div></div></section><section class=section><div class=container><div class=columns><div class="column is-3 is-hidden-mobile" data-sticky-container><aside class="menu sticky"><p class=menu-label>Table of contents</p><ul class=menu-list><li><a title="Getting Started" href=/docs/v3.0.x/Getting-Started>Getting Started</a></li><li><a title=Server href=/docs/v3.0.x/Server>Server</a></li><li><a title=Routes href=/docs/v3.0.x/Routes>Routes</a></li><li><a title=Logging href=/docs/v3.0.x/Logging>Logging</a></li><li><a title=Middleware href=/docs/v3.0.x/Middleware>Middleware</a></li><li><a title=Hooks href=/docs/v3.0.x/Hooks>Hooks</a></li><li id=doc-menu-section><a title=Decorators class=is-active href=/docs/v3.0.x/Decorators>Decorators</a></li><li><a title="Validation and Serialization" href=/docs/v3.0.x/Validation-and-Serialization>Validation and Serialization</a></li><li><a title="Fluent Schema" href=/docs/v3.0.x/Fluent-Schema>Fluent Schema</a></li><li><a title=Lifecycle href=/docs/v3.0.x/Lifecycle>Lifecycle</a></li><li><a title=Reply href=/docs/v3.0.x/Reply>Reply</a></li><li><a title=Request href=/docs/v3.0.x/Request>Request</a></li><li><a title=Errors href=/docs/v3.0.x/Errors>Errors</a></li><li><a title="Content Type Parser" href=/docs/v3.0.x/ContentTypeParser>Content Type Parser</a></li><li><a title=Plugins href=/docs/v3.0.x/Plugins>Plugins</a></li><li><a title=Testing href=/docs/v3.0.x/Testing>Testing</a></li><li><a title=Benchmarking href=/docs/v3.0.x/Benchmarking>Benchmarking</a></li><li><a title="How to write a good plugin" href=/docs/v3.0.x/Write-Plugin>How to write a good plugin</a></li><li><a title="Plugins Guide" href=/docs/v3.0.x/Plugins-Guide>Plugins Guide</a></li><li><a title=HTTP2 href=/docs/v3.0.x/HTTP2>HTTP2</a></li><li><a title="Long Term Support" href=/docs/v3.0.x/LTS>Long Term Support</a></li><li><a title="TypeScript and types support" href=/docs/v3.0.x/TypeScript>TypeScript and types support</a></li><li><a title=Serverless href=/docs/v3.0.x/Serverless>Serverless</a></li><li><a title=Recommendations href=/docs/v3.0.x/Recommendations>Recommendations</a></li></ul><div class=content style="margin: .8em; border-top: 1px solid #ccc; padding: .8em 0 0 0">Docs version<div class=field><div class=control><div class=select><select onchange="if (this.value) window.location.href=this.value"><option value=/docs/latest>latest</option><option value=/docs/master>master</option><option value=/docs/v3.10.x>v3.10.x</option><option value=/docs/v3.9.x>v3.9.x</option><option value=/docs/v3.8.x>v3.8.x</option><option value=/docs/v3.7.x>v3.7.x</option><option value=/docs/v3.6.x>v3.6.x</option><option value=/docs/v3.5.x>v3.5.x</option><option value=/docs/v3.4.x>v3.4.x</option><option value=/docs/v3.3.x>v3.3.x</option><option value=/docs/v3.2.x>v3.2.x</option><option value=/docs/v3.1.x>v3.1.x</option><option selected value=/docs/v3.0.x>v3.0.x</option><option value=/docs/v2.15.x>v2.15.x</option><option value=/docs/v2.14.x>v2.14.x</option><option value=/docs/v2.13.x>v2.13.x</option><option value=/docs/v2.12.x>v2.12.x</option><option value=/docs/v2.11.x>v2.11.x</option><option value=/docs/v2.10.x>v2.10.x</option><option value=/docs/v2.9.x>v2.9.x</option><option value=/docs/v2.8.x>v2.8.x</option><option value=/docs/v2.7.x>v2.7.x</option><option value=/docs/v2.6.x>v2.6.x</option><option value=/docs/v2.5.x>v2.5.x</option><option value=/docs/v2.4.x>v2.4.x</option><option value=/docs/v2.3.x>v2.3.x</option><option value=/docs/v2.2.x>v2.2.x</option><option value=/docs/v2.1.x>v2.1.x</option><option value=/docs/v2.0.x>v2.0.x</option><option value=/docs/v1.14.x>v1.14.x</option><option value=/docs/v1.13.x>v1.13.x</option></select></div></div></div></div></aside></div><div class="column is-9"><nav class=breadcrumb><ul><li><a href=/ style="padding-left: 0">Fastify</a></li><li><a href=/docs/ >Documentation</a></li><li><div class=field><div class=control><div class=select><select onchange="if (this.value) window.location.href=this.value" style="border: none;"><option value=/docs/latest>latest</option><option value=/docs/master>master</option><option value=/docs/v3.10.x>v3.10.x</option><option value=/docs/v3.9.x>v3.9.x</option><option value=/docs/v3.8.x>v3.8.x</option><option value=/docs/v3.7.x>v3.7.x</option><option value=/docs/v3.6.x>v3.6.x</option><option value=/docs/v3.5.x>v3.5.x</option><option value=/docs/v3.4.x>v3.4.x</option><option value=/docs/v3.3.x>v3.3.x</option><option value=/docs/v3.2.x>v3.2.x</option><option value=/docs/v3.1.x>v3.1.x</option><option selected value=/docs/v3.0.x>v3.0.x</option><option value=/docs/v2.15.x>v2.15.x</option><option value=/docs/v2.14.x>v2.14.x</option><option value=/docs/v2.13.x>v2.13.x</option><option value=/docs/v2.12.x>v2.12.x</option><option value=/docs/v2.11.x>v2.11.x</option><option value=/docs/v2.10.x>v2.10.x</option><option value=/docs/v2.9.x>v2.9.x</option><option value=/docs/v2.8.x>v2.8.x</option><option value=/docs/v2.7.x>v2.7.x</option><option value=/docs/v2.6.x>v2.6.x</option><option value=/docs/v2.5.x>v2.5.x</option><option value=/docs/v2.4.x>v2.4.x</option><option value=/docs/v2.3.x>v2.3.x</option><option value=/docs/v2.2.x>v2.2.x</option><option value=/docs/v2.1.x>v2.1.x</option><option value=/docs/v2.0.x>v2.0.x</option><option value=/docs/v1.14.x>v1.14.x</option><option value=/docs/v1.13.x>v1.13.x</option></select></div></div></div></li><li class=is-active><a>Decorators</a></li></ul></nav><div id=doc-content class=content><h2 id=decorators>Decorators</h2><p>The decorators API allows customization of the core Fastify objects, such as the server instance itself and any request and reply objects used during the HTTP request lifecycle. The decorators API can be used to attach any type of property to the core objects, e.g. functions, plain objects, or native types.</p><p>This API is a <em>synchronous</em> API. Attempting to define a decoration asynchronously could result in the Fastify instance booting prior to the decoration completing its initialization. To avoid this issue, and register an asynchronous decoration, the <code>register</code> API, in combination with <code>fastify-plugin</code>, must be used instead. To learn more, see the <a href=/docs/v3.0.x/Plugins>Plugins</a> documentation.</p><p>Decorating core objects with this API allows the underlying JavaScript engine to optimize handling of the server, request, and reply objects. This is accomplished by defining the shape of all such object instances before they are instantiated and used. As an example, the following is not recommended because it will change the shape of objects during their lifecycle:</p><pre><code class=language-js>// Bad example! Continue reading.

// Attach a user property to the incoming request before the request
// handler is invoked.
fastify.addHook(&#39;preHandler&#39;, function (req, reply, done) {
  req.user = &#39;Bob Dylan&#39;
  done()
})

// Use the attached user property in the request handler.
fastify.get(&#39;/&#39;, function (req, reply) {
  reply.send(`Hello, ${req.user}`)
})</code></pre><p>Since the above example mutates the request object after it has already been instantiated, the JavaScript engine must deoptimize access to the request object. By using the decoration API this deoptimization is avoided:</p><pre><code class=language-js>// Decorate request with a &#39;user&#39; property
fastify.decorateRequest(&#39;user&#39;, &#39;&#39;)

// Update our property
fastify.addHook(&#39;preHandler&#39;, (req, reply, done) =&gt; {
  req.user = &#39;Bob Dylan&#39;
  done()
})
// And finally access it
fastify.get(&#39;/&#39;, (req, reply) =&gt; {
  reply.send(`Hello, ${req.user}!`)
})</code></pre><p>See <a href=https://web.archive.org/web/20200201163000/https://mathiasbynens.be/notes/shapes-ics>JavaScript engine fundamentals: Shapes and Inline Caches</a> for more information on this topic.</p><h3 id=usage>Usage</h3><p><a name=usage></a></p><h4 id=decoratename-value-dependencies><code>decorate(name, value, [dependencies])</code></h4><p><a name=decorate></a></p><p>This method is used to customize the Fastify <a href=/docs/v3.0.x/Server>server</a> instance.</p><p>For example, to attach a new method to the server instance:</p><pre><code class=language-js>fastify.decorate(&#39;utility&#39;, function () {
  // Something very useful
})</code></pre><p>As mentioned above, non-function values can be attached:</p><pre><code class=language-js>fastify.decorate(&#39;conf&#39;, {
  db: &#39;some.db&#39;,
  port: 3000
})</code></pre><p>To access decorated properties, simply use the name provided to the decoration API:</p><pre><code class=language-js>fastify.utility()

console.log(fastify.conf.db)</code></pre><p>The decorated <a href=/docs/v3.0.x/Server>Fastify server</a> is bound to <code>this</code> in route <a href=/docs/v3.0.x/Routes>route</a> handlers:</p><pre><code class=language-js>fastify.decorate(&#39;db&#39;, new DbConnection())

fastify.get(&#39;/&#39;, async function (request, reply) {
  reply({hello: await this.db.query(&#39;world&#39;)})
})</code></pre><p>The <code>dependencies</code> parameter is an optional list of decorators that the decorator being defined relies upon. This list is simply a list of string names of other decorators. In the following example, the &quot;utility&quot; decorator depends upon &quot;greet&quot; and &quot;log&quot; decorators:</p><pre><code class=language-js>fastify.decorate(&#39;utility&#39;, fn, [&#39;greet&#39;, &#39;log&#39;])</code></pre><p>If a dependency is not satisfied, the <code>decorate</code> method will throw an exception. The dependency check is performed before the server instance is booted. Thus, it cannot occur during runtime.</p><h4 id=decoratereplyname-value-dependencies><code>decorateReply(name, value, [dependencies])</code></h4><p><a name=decorate-reply></a></p><p>As the name suggests, this API is used to add new methods/properties to the core <code>Reply</code> object:</p><pre><code class=language-js>fastify.decorateReply(&#39;utility&#39;, function () {
  // Something very useful
})</code></pre><p>Note: using an arrow function will break the binding of <code>this</code> to the Fastify <code>Reply</code> instance.</p><p>See <a href=#decorate><code>decorate</code></a> for information about the <code>dependencies</code> parameter.</p><h4 id=decoraterequestname-value-dependencies><code>decorateRequest(name, value, [dependencies])</code></h4><p><a name=decorate-request></a></p><p>As above with <a href=#decorate-reply><code>decorateReply</code></a>, this API is used add new methods/properties to the core <code>Request</code> object:</p><pre><code class=language-js>fastify.decorateRequest(&#39;utility&#39;, function () {
  // something very useful
})</code></pre><p>Note: using an arrow function will break the binding of <code>this</code> to the Fastify <code>Request</code> instance.</p><p>See <a href=#decorate><code>decorate</code></a> for information about the <code>dependencies</code> parameter.</p><h4 id=hasdecoratorname><code>hasDecorator(name)</code></h4><p><a name=has-decorator></a></p><p>Used to check for the existence of a server instance decoration:</p><pre><code class=language-js>fastify.hasDecorator(&#39;utility&#39;)</code></pre><h4 id=hasrequestdecorator>hasRequestDecorator</h4><p><a name=has-request-decorator></a></p><p>Used to check for the existence of a Request decoration:</p><pre><code class=language-js>fastify.hasRequestDecorator(&#39;utility&#39;)</code></pre><h4 id=hasreplydecorator>hasReplyDecorator</h4><p><a name=has-reply-decorator></a></p><p>Used to check for the existence of a Reply decoration:</p><pre><code class=language-js>fastify.hasReplyDecorator(&#39;utility&#39;)</code></pre><h3 id=decorators-and-encapsulation>Decorators and Encapsulation</h3><p><a name=decorators-encapsulation></a></p><p>Defining a decorator (using <code>decorate</code>, <code>decorateRequest</code> or <code>decorateReply</code>) with the same name more than once in the same <strong>encapsulated</strong> context will throw an exception.</p><p>As an example, the following will throw:</p><pre><code class=language-js>const server = require(&#39;fastify&#39;)()

server.decorateReply(&#39;view&#39;, function (template, args) {
  // Amazing view rendering engine
})

server.get(&#39;/&#39;, (req, reply) =&gt; {
  reply.view(&#39;/index.html&#39;, { hello: &#39;world&#39; })
})

// Somewhere else in our codebase, we define another
// view decorator. This throws.
server.decorateReply(&#39;view&#39;, function (template, args) {
  // Another rendering engine
})

server.listen(3000)</code></pre><p>But this will not:</p><pre><code class=language-js>const server = require(&#39;fastify&#39;)()

server.decorateReply(&#39;view&#39;, function (template, args) {
  // Amazing view rendering engine.
})

server.register(async function (server, opts) {
  // We add a view decorator to the current encapsulated
  // plugin. This will not throw as outside of this encapsulated
  // plugin view is the old one, while inside it is the new one.
  server.decorateReply(&#39;view&#39;, function (template, args) {
    // Another rendering engine
  })

  server.get(&#39;/&#39;, (req, reply) =&gt; {
    reply.view(&#39;/index.page&#39;, { hello: &#39;world&#39; })
  })
}, { prefix: &#39;/bar&#39; })

server.listen(3000)</code></pre><h3 id=getters-and-setters>Getters and Setters</h3><p><a name=getters-setters></a></p><p>Decorators accept special &quot;getter/setter&quot; objects. These objects have functions named <code>getter</code> and <code>setter</code> (though, the <code>setter</code> function is optional). This allows defining properties via decorators. For example:</p><pre><code class=language-js>fastify.decorate(&#39;foo&#39;, {
  getter () {
    return &#39;a getter&#39;
  }
})</code></pre><p>Will define the <code>foo</code> property on the Fastify instance:</p><pre><code class=language-js>console.log(fastify.foo) // &#39;a getter&#39;</code></pre></div><hr><nav class=level><div class=level-left><div class=level-item><a href=/docs/v3.0.x/Hooks class="button prev">≪ Hooks</a></div></div><div class=level-right><div class=level-item><a href=/docs/v3.0.x/Validation-and-Serialization class="button next">Validation and Serialization ≫</a></div></div></nav></div></div></div></section><script>// dynamically creates a submenu for the current section based on the content headers
  var titles = document.querySelectorAll('#doc-content h3, #doc-content h4')
  var currentMenu = document.getElementById('doc-menu-section')
  if (titles.length && currentMenu) {
    var submenu = document.createElement('ul')
    titles.forEach(el => {
      var currentSubmenuItem = document.createElement('li')
      var currentSubmenuLink = document.createElement('a')
      currentSubmenuLink.href = '#' + el.id
      currentSubmenuLink.title = el.textContent
      currentSubmenuLink.append(document.createTextNode(el.textContent))
      currentSubmenuItem.append(currentSubmenuLink)
      submenu.append(currentSubmenuItem)
    })
    currentMenu.append(submenu)
  }

  // dynamically creates header anchor links
  var headers = document.querySelectorAll('#doc-content h3, #doc-content h4')
  headers.forEach(el => {
    var currentAnchorLink = document.createElement('a')
    currentAnchorLink.className = 'anchor'
    currentAnchorLink.href = "#" + el.id
    currentAnchorLink.append(document.createTextNode('¶'))
    el.insertBefore(currentAnchorLink, el.firstChild);
  })</script></main><footer class="grey is-primary footer"><div class=container><div class="content has-text-centered"><p>Fastify, Copyright &copy; 2016-2021 <a href=https://openjsf.org/ target=_blank>OpenJS Foundation</a> and <a href=https://github.com/fastify/fastify#team target=_blank>The Fastify team</a>, Licensed under <a href=https://github.com/fastify/fastify/blob/master/LICENSE target=_blank>MIT</a></p></div></div></footer><script src=/js/main.97eeabf1df4ff87e.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin=anonymous></script><script>hljs.initHighlightingOnLoad();</script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js></script><script type=text/javascript>docsearch({
        apiKey: 'f7c62ddab40e653f67a6e15be761d951',
        indexName: 'fastify',
        inputSelector: '#algolia-search-input',
        algoliaOptions: { 'facetFilters': ["version:latest", "tags:docs"] },
        debug: false // Set debug to true if you want to inspect the dropdown
      });</script></body></html>