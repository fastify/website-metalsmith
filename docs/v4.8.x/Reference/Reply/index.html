<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Reply</title><meta name=description content="Fast and low overhead web framework, for Node.js"><link rel=apple-touch-icon sizes=57x57 href=/images/apple-icon-57x57.ed24c0a19503e080.png><link rel=apple-touch-icon sizes=60x60 href=/images/apple-icon-60x60.60c285c424d50738.png><link rel=apple-touch-icon sizes=72x72 href=/images/apple-icon-72x72.e49b27cfe1ab1461.png><link rel=apple-touch-icon sizes=76x76 href=/images/apple-icon-76x76.752f43fc91b8c1f7.png><link rel=apple-touch-icon sizes=114x114 href=/images/apple-icon-114x114.61739fa1d5a7059a.png><link rel=apple-touch-icon sizes=120x120 href=/images/apple-icon-120x120.7c25de37c5ce2ec1.png><link rel=apple-touch-icon sizes=144x144 href=/images/apple-icon-144x144.04d88fb27bd92cbe.png><link rel=apple-touch-icon sizes=152x152 href=/images/apple-icon-152x152.9364781175671626.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-icon-180x180.67579100928bfcd2.png><link rel=icon type=image/png sizes=192x192 href=/images/android-icon-192x192.37eb7f1ae3853740.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.1e22f0e774bc3cce.png><link rel=icon type=image/png sizes=96x96 href=/images/favicon-96x96.7e8a68b1b80c1799.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.e534ce05cb727f1a.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content=#ffffff><meta name=msapplication-TileImage content=/images/ms-icon-144x144.png><meta name=theme-color content=#ffffff><meta property=og:url content=https://www.fastify.io/docs/v4.8.x/Reference/Reply><meta property=og:type content=website><meta property=og:title content=Reply><meta property=og:description content="Fast and low overhead web framework, for Node.js"><meta property=og:image content=https://www.fastify.io/images/fastify-fb-share-image.07b6e6860853c758.png><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@fastifyjs><meta name=twitter:creator content=@fastifyjs><meta name=twitter:title content=Reply><meta name=twitter:description content="Fast and low overhead web framework, for Node.js"><meta name=twitter:image content=https://www.fastify.io/images/fastify-twitter-share-image.cd9f217b360af3e2.png><link rel=stylesheet href=/css/style.f4d6592b3a91c5ef.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/default.min.css integrity="sha512-kZqGbhf9JTB4bVJ0G8HCkqmaPcRgo88F0dneK30yku5Y/dep7CZfCnNml2Je/sY4lBoqoksXz4PtVXS4GHSUzQ==" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@alpha><meta name=robots content="noindex, nofollow"></head><body><nav id=main-navbar class=navbar><div class=navbar-brand><a class=navbar-item href=/ ><img src=/images/fastify-logo-menu.d13f8da7a965c800.png alt="Fastify: Fast and low overhead web framework, for Node.js" height=28 decoding=async> </a><a class="navbar-item is-hidden-desktop" href=https://github.com/fastify/fastify target=_blank rel=noopener><span class=icon style="color: #333;"><i class="fa fa-github"></i></span></a><div class="navbar-burger burger" data-target=mobileMenu><span></span> <span></span> <span></span></div></div><div class=navbar-menu id=mobileMenu><div class=navbar-start><a class=navbar-item href=/ >Home</a> <a class=navbar-item href=/docs/latest>Docs</a> <a class=navbar-item href=/ecosystem>Ecosystem</a> <a class=navbar-item href=/benchmarks>Benchmarks</a> <a class=navbar-item href=/contribute>Contribute</a> <a class=navbar-item href=https://medium.com/@fastifyjs/ >Blog</a> <a class=navbar-item href=https://github.com/fastify/help>Help</a></div><div class=navbar-end><span id=algolia-search-input class="control has-icons-left navbar-item"></span> <a class=navbar-item href=https://github.com/fastify/fastify target=_blank rel=noopener><span class="fa fa-github"></span>&nbsp;GitHub </a><a class=navbar-item href=https://twitter.com/fastifyjs target=_blank rel=noopener><span class="fa fa-twitter"></span>&nbsp;Twitter </a><a class=navbar-item rel=me href=https://fosstodon.org/@fastify target=_blank><span class="fa fa-hashtag"></span>&nbsp;Mastodon</a></div></div></nav><main class=page-content aria-label=Content><section class="hero is-primary" style="background-image: url(/images/bg-pattern-dark.3f8cda863b3bbf52.png)"><div class=hero-body><div class=container><h1 class=title>Documentation (v4.8.1)</h1></div></div></section><section class=section><div class=container><div class=columns><div class="column is-3 is-hidden-mobile sticky-container"><aside class="menu sticky" id=toc><ul class=menu-list></ul><p class=menu-label><a href=/docs/v4.8.x/Guides>Guides</a></p><ul class=menu-list><li style="text-transform: capitalize"><a title=Benchmarking href=/docs/v4.8.x/Guides/Benchmarking>Benchmarking</a></li><li style="text-transform: capitalize"><a title=Contributing href=/docs/v4.8.x/Guides/Contributing>Contributing</a></li><li style="text-transform: capitalize"><a title=Database href=/docs/v4.8.x/Guides/Database>Database</a></li><li style="text-transform: capitalize"><a title=Delay-Accepting-Requests href=/docs/v4.8.x/Guides/Delay-Accepting-Requests>Delay-Accepting-Requests</a></li><li style="text-transform: capitalize"><a title=Ecosystem href=/docs/v4.8.x/Guides/Ecosystem>Ecosystem</a></li><li style="text-transform: capitalize"><a title=Fluent-Schema href=/docs/v4.8.x/Guides/Fluent-Schema>Fluent-Schema</a></li><li style="text-transform: capitalize"><a title=Getting-Started href=/docs/v4.8.x/Guides/Getting-Started>Getting-Started</a></li><li style="text-transform: capitalize"><a title=Migration-Guide-V3 href=/docs/v4.8.x/Guides/Migration-Guide-V3>Migration-Guide-V3</a></li><li style="text-transform: capitalize"><a title=Migration-Guide-V4 href=/docs/v4.8.x/Guides/Migration-Guide-V4>Migration-Guide-V4</a></li><li style="text-transform: capitalize"><a title=Plugins-Guide href=/docs/v4.8.x/Guides/Plugins-Guide>Plugins-Guide</a></li><li style="text-transform: capitalize"><a title=Prototype-Poisoning href=/docs/v4.8.x/Guides/Prototype-Poisoning>Prototype-Poisoning</a></li><li style="text-transform: capitalize"><a title=Recommendations href=/docs/v4.8.x/Guides/Recommendations>Recommendations</a></li><li style="text-transform: capitalize"><a title=Serverless href=/docs/v4.8.x/Guides/Serverless>Serverless</a></li><li style="text-transform: capitalize"><a title=Style-Guide href=/docs/v4.8.x/Guides/Style-Guide>Style-Guide</a></li><li style="text-transform: capitalize"><a title=Testing href=/docs/v4.8.x/Guides/Testing>Testing</a></li><li style="text-transform: capitalize"><a title=Write-Plugin href=/docs/v4.8.x/Guides/Write-Plugin>Write-Plugin</a></li></ul><p class=menu-label><a href=/docs/v4.8.x/Reference>Reference</a></p><ul class=menu-list><li style="text-transform: capitalize"><a title=ContentTypeParser href=/docs/v4.8.x/Reference/ContentTypeParser>ContentTypeParser</a></li><li style="text-transform: capitalize"><a title=Decorators href=/docs/v4.8.x/Reference/Decorators>Decorators</a></li><li style="text-transform: capitalize"><a title=Encapsulation href=/docs/v4.8.x/Reference/Encapsulation>Encapsulation</a></li><li style="text-transform: capitalize"><a title=Errors href=/docs/v4.8.x/Reference/Errors>Errors</a></li><li style="text-transform: capitalize"><a title=HTTP2 href=/docs/v4.8.x/Reference/HTTP2>HTTP2</a></li><li style="text-transform: capitalize"><a title=Hooks href=/docs/v4.8.x/Reference/Hooks>Hooks</a></li><li style="text-transform: capitalize"><a title=LTS href=/docs/v4.8.x/Reference/LTS>LTS</a></li><li style="text-transform: capitalize"><a title=Lifecycle href=/docs/v4.8.x/Reference/Lifecycle>Lifecycle</a></li><li style="text-transform: capitalize"><a title=Logging href=/docs/v4.8.x/Reference/Logging>Logging</a></li><li style="text-transform: capitalize"><a title=Middleware href=/docs/v4.8.x/Reference/Middleware>Middleware</a></li><li style="text-transform: capitalize"><a title=Plugins href=/docs/v4.8.x/Reference/Plugins>Plugins</a></li><li style="text-transform: capitalize" id=doc-menu-section><a title=Reply class=is-active href=/docs/v4.8.x/Reference/Reply>Reply</a></li><li style="text-transform: capitalize"><a title=Request href=/docs/v4.8.x/Reference/Request>Request</a></li><li style="text-transform: capitalize"><a title=Routes href=/docs/v4.8.x/Reference/Routes>Routes</a></li><li style="text-transform: capitalize"><a title=Server href=/docs/v4.8.x/Reference/Server>Server</a></li><li style="text-transform: capitalize"><a title=Type-Providers href=/docs/v4.8.x/Reference/Type-Providers>Type-Providers</a></li><li style="text-transform: capitalize"><a title=TypeScript href=/docs/v4.8.x/Reference/TypeScript>TypeScript</a></li><li style="text-transform: capitalize"><a title=Validation-and-Serialization href=/docs/v4.8.x/Reference/Validation-and-Serialization>Validation-and-Serialization</a></li></ul><div class=content style="margin: .8em; border-top: 1px solid #ccc; padding: .8em 0 0 0">Docs version<div class=field><div class=control><div class=select><select onchange="if (this.value) window.location.href=this.value"><option value=/docs/latest>latest</option><option value=/docs/master>master</option><option value=/docs/v4.14.x>v4.14.x</option><option value=/docs/v4.13.x>v4.13.x</option><option value=/docs/v4.12.x>v4.12.x</option><option value=/docs/v4.11.x>v4.11.x</option><option value=/docs/v4.10.x>v4.10.x</option><option value=/docs/v4.9.x>v4.9.x</option><option selected value=/docs/v4.8.x>v4.8.x</option><option value=/docs/v4.7.x>v4.7.x</option><option value=/docs/v4.6.x>v4.6.x</option><option value=/docs/v4.5.x>v4.5.x</option><option value=/docs/v4.4.x>v4.4.x</option><option value=/docs/v4.3.x>v4.3.x</option><option value=/docs/v4.2.x>v4.2.x</option><option value=/docs/v4.1.x>v4.1.x</option><option value=/docs/v4.0.x>v4.0.x</option><option value=/docs/v3.29.x>v3.29.x</option><option value=/docs/v3.28.x>v3.28.x</option><option value=/docs/v3.27.x>v3.27.x</option><option value=/docs/v3.26.x>v3.26.x</option><option value=/docs/v3.25.x>v3.25.x</option><option value=/docs/v3.24.x>v3.24.x</option><option value=/docs/v3.23.x>v3.23.x</option><option value=/docs/v3.22.x>v3.22.x</option><option value=/docs/v3.21.x>v3.21.x</option><option value=/docs/v3.20.x>v3.20.x</option><option value=/docs/v3.19.x>v3.19.x</option><option value=/docs/v3.18.x>v3.18.x</option><option value=/docs/v3.17.x>v3.17.x</option><option value=/docs/v3.16.x>v3.16.x</option><option value=/docs/v3.15.x>v3.15.x</option><option value=/docs/v3.14.x>v3.14.x</option><option value=/docs/v3.13.x>v3.13.x</option><option value=/docs/v3.12.x>v3.12.x</option><option value=/docs/v3.11.x>v3.11.x</option><option value=/docs/v3.10.x>v3.10.x</option><option value=/docs/v3.9.x>v3.9.x</option><option value=/docs/v3.8.x>v3.8.x</option><option value=/docs/v3.7.x>v3.7.x</option><option value=/docs/v3.6.x>v3.6.x</option><option value=/docs/v3.5.x>v3.5.x</option><option value=/docs/v3.4.x>v3.4.x</option><option value=/docs/v3.3.x>v3.3.x</option><option value=/docs/v3.2.x>v3.2.x</option><option value=/docs/v3.1.x>v3.1.x</option><option value=/docs/v3.0.x>v3.0.x</option><option value=/docs/v2.15.x>v2.15.x</option><option value=/docs/v2.14.x>v2.14.x</option><option value=/docs/v2.13.x>v2.13.x</option><option value=/docs/v2.12.x>v2.12.x</option><option value=/docs/v2.11.x>v2.11.x</option><option value=/docs/v2.10.x>v2.10.x</option><option value=/docs/v2.9.x>v2.9.x</option><option value=/docs/v2.8.x>v2.8.x</option><option value=/docs/v2.7.x>v2.7.x</option><option value=/docs/v2.6.x>v2.6.x</option><option value=/docs/v2.5.x>v2.5.x</option><option value=/docs/v2.4.x>v2.4.x</option><option value=/docs/v2.3.x>v2.3.x</option><option value=/docs/v2.2.x>v2.2.x</option><option value=/docs/v2.1.x>v2.1.x</option><option value=/docs/v2.0.x>v2.0.x</option><option value=/docs/v1.14.x>v1.14.x</option><option value=/docs/v1.13.x>v1.13.x</option></select></div></div></div></div></aside></div><div class="column is-9"><nav class=breadcrumb><ul><li><a href=/ style="padding-left: 0">Fastify</a></li><li><a href=/docs/v4.8.x>Documentation</a></li><li><div class=field><div class=control><div class=select><select onchange="if (this.value) window.location.href=this.value" style="border: none;"><option value=/docs/latest>latest</option><option value=/docs/master>master</option><option value=/docs/v4.14.x>v4.14.x</option><option value=/docs/v4.13.x>v4.13.x</option><option value=/docs/v4.12.x>v4.12.x</option><option value=/docs/v4.11.x>v4.11.x</option><option value=/docs/v4.10.x>v4.10.x</option><option value=/docs/v4.9.x>v4.9.x</option><option selected value=/docs/v4.8.x>v4.8.x</option><option value=/docs/v4.7.x>v4.7.x</option><option value=/docs/v4.6.x>v4.6.x</option><option value=/docs/v4.5.x>v4.5.x</option><option value=/docs/v4.4.x>v4.4.x</option><option value=/docs/v4.3.x>v4.3.x</option><option value=/docs/v4.2.x>v4.2.x</option><option value=/docs/v4.1.x>v4.1.x</option><option value=/docs/v4.0.x>v4.0.x</option><option value=/docs/v3.29.x>v3.29.x</option><option value=/docs/v3.28.x>v3.28.x</option><option value=/docs/v3.27.x>v3.27.x</option><option value=/docs/v3.26.x>v3.26.x</option><option value=/docs/v3.25.x>v3.25.x</option><option value=/docs/v3.24.x>v3.24.x</option><option value=/docs/v3.23.x>v3.23.x</option><option value=/docs/v3.22.x>v3.22.x</option><option value=/docs/v3.21.x>v3.21.x</option><option value=/docs/v3.20.x>v3.20.x</option><option value=/docs/v3.19.x>v3.19.x</option><option value=/docs/v3.18.x>v3.18.x</option><option value=/docs/v3.17.x>v3.17.x</option><option value=/docs/v3.16.x>v3.16.x</option><option value=/docs/v3.15.x>v3.15.x</option><option value=/docs/v3.14.x>v3.14.x</option><option value=/docs/v3.13.x>v3.13.x</option><option value=/docs/v3.12.x>v3.12.x</option><option value=/docs/v3.11.x>v3.11.x</option><option value=/docs/v3.10.x>v3.10.x</option><option value=/docs/v3.9.x>v3.9.x</option><option value=/docs/v3.8.x>v3.8.x</option><option value=/docs/v3.7.x>v3.7.x</option><option value=/docs/v3.6.x>v3.6.x</option><option value=/docs/v3.5.x>v3.5.x</option><option value=/docs/v3.4.x>v3.4.x</option><option value=/docs/v3.3.x>v3.3.x</option><option value=/docs/v3.2.x>v3.2.x</option><option value=/docs/v3.1.x>v3.1.x</option><option value=/docs/v3.0.x>v3.0.x</option><option value=/docs/v2.15.x>v2.15.x</option><option value=/docs/v2.14.x>v2.14.x</option><option value=/docs/v2.13.x>v2.13.x</option><option value=/docs/v2.12.x>v2.12.x</option><option value=/docs/v2.11.x>v2.11.x</option><option value=/docs/v2.10.x>v2.10.x</option><option value=/docs/v2.9.x>v2.9.x</option><option value=/docs/v2.8.x>v2.8.x</option><option value=/docs/v2.7.x>v2.7.x</option><option value=/docs/v2.6.x>v2.6.x</option><option value=/docs/v2.5.x>v2.5.x</option><option value=/docs/v2.4.x>v2.4.x</option><option value=/docs/v2.3.x>v2.3.x</option><option value=/docs/v2.2.x>v2.2.x</option><option value=/docs/v2.1.x>v2.1.x</option><option value=/docs/v2.0.x>v2.0.x</option><option value=/docs/v1.14.x>v1.14.x</option><option value=/docs/v1.13.x>v1.13.x</option></select></div></div></div></li><div class=field><div class=control><div class=select><select onchange="if (this.value) window.location.href=this.value" style="border: none;"><option value=/docs/v4.8.x>Documentation</option><option value=/docs/v4.8.x/Guides>Guides</option><option value=/docs/v4.8.x/Guides/Benchmarking>Benchmarking</option><option value=/docs/v4.8.x/Guides/Contributing>Contributing</option><option value=/docs/v4.8.x/Guides/Database>Database</option><option value=/docs/v4.8.x/Guides/Delay-Accepting-Requests>Delay-Accepting-Requests</option><option value=/docs/v4.8.x/Guides/Ecosystem>Ecosystem</option><option value=/docs/v4.8.x/Guides/Fluent-Schema>Fluent-Schema</option><option value=/docs/v4.8.x/Guides/Getting-Started>Getting-Started</option><option value=/docs/v4.8.x/Guides/Migration-Guide-V3>Migration-Guide-V3</option><option value=/docs/v4.8.x/Guides/Migration-Guide-V4>Migration-Guide-V4</option><option value=/docs/v4.8.x/Guides/Plugins-Guide>Plugins-Guide</option><option value=/docs/v4.8.x/Guides/Prototype-Poisoning>Prototype-Poisoning</option><option value=/docs/v4.8.x/Guides/Recommendations>Recommendations</option><option value=/docs/v4.8.x/Guides/Serverless>Serverless</option><option value=/docs/v4.8.x/Guides/Style-Guide>Style-Guide</option><option value=/docs/v4.8.x/Guides/Testing>Testing</option><option value=/docs/v4.8.x/Guides/Write-Plugin>Write-Plugin</option><option value=/docs/v4.8.x/Reference>Reference</option><option value=/docs/v4.8.x/Reference/ContentTypeParser>ContentTypeParser</option><option value=/docs/v4.8.x/Reference/Decorators>Decorators</option><option value=/docs/v4.8.x/Reference/Encapsulation>Encapsulation</option><option value=/docs/v4.8.x/Reference/Errors>Errors</option><option value=/docs/v4.8.x/Reference/HTTP2>HTTP2</option><option value=/docs/v4.8.x/Reference/Hooks>Hooks</option><option value=/docs/v4.8.x/Reference/LTS>LTS</option><option value=/docs/v4.8.x/Reference/Lifecycle>Lifecycle</option><option value=/docs/v4.8.x/Reference/Logging>Logging</option><option value=/docs/v4.8.x/Reference/Middleware>Middleware</option><option value=/docs/v4.8.x/Reference/Plugins>Plugins</option><option selected value=/docs/v4.8.x/Reference/Reply>Reply</option><option value=/docs/v4.8.x/Reference/Request>Request</option><option value=/docs/v4.8.x/Reference/Routes>Routes</option><option value=/docs/v4.8.x/Reference/Server>Server</option><option value=/docs/v4.8.x/Reference/Type-Providers>Type-Providers</option><option value=/docs/v4.8.x/Reference/TypeScript>TypeScript</option><option value=/docs/v4.8.x/Reference/Validation-and-Serialization>Validation-and-Serialization</option></select></div></div></div></ul></nav><div id=doc-content class=content><h2 id=reply>Reply</h2><ul><li><a href=#reply>Reply</a><ul><li><a href=#introduction>Introduction</a></li><li><a href=#codestatuscode>.code(statusCode)</a></li><li><a href=#statuscode>.statusCode</a></li><li><a href=#server>.server</a></li><li><a href=#headerkey-value>.header(key, value)</a></li><li><a href=#headersobject>.headers(object)</a></li><li><a href=#getheaderkey>.getHeader(key)</a></li><li><a href=#getheaders>.getHeaders()</a><ul><li><a href=#set-cookie>set-cookie</a></li></ul></li><li><a href=#removeheaderkey>.removeHeader(key)</a></li><li><a href=#hasheaderkey>.hasHeader(key)</a></li><li><a href=#trailerkey-function>.trailer(key, function)</a></li><li><a href=#hastrailerkey>.hasTrailer(key)</a></li><li><a href=#removetrailerkey>.removeTrailer(key)</a></li><li><a href=#redirectcode--dest>.redirect([code ,] dest)</a></li><li><a href=#callnotfound>.callNotFound()</a></li><li><a href=#getresponsetime>.getResponseTime()</a></li><li><a href=#typecontenttype>.type(contentType)</a></li><li><a href=#getserializationfunctionschema--httpstatus>.getSerializationFunction(schema | httpStatus)</a></li><li><a href=#compileserializationschemaschema-httpstatus>.compileSerializationSchema(schema, httpStatus)</a></li><li><a href=#serializeinputdata-schema--httpstatus-httpstatus>.serializeInput(data, [schema | httpStatus], [httpStatus])</a></li><li><a href=#serializerfunc>.serializer(func)</a></li><li><a href=#raw>.raw</a></li><li><a href=#sent>.sent</a></li><li><a href=#hijack>.hijack()</a></li><li><a href=#senddata>.send(data)</a><ul><li><a href=#objects>Objects</a></li><li><a href=#strings>Strings</a></li><li><a href=#streams>Streams</a></li><li><a href=#buffers>Buffers</a></li><li><a href=#errors>Errors</a></li><li><a href=#type-of-the-final-payload>Type of the final payload</a></li><li><a href=#async-await-and-promises>Async-Await and Promises</a></li></ul></li><li><a href=#thenfulfilled-rejected>.then(fulfilled, rejected)</a></li></ul></li></ul><h3 id=introduction>Introduction</h3><p><a id=introduction></a></p><p>The second parameter of the handler function is <code>Reply</code>. Reply is a core Fastify object that exposes the following functions and properties:</p><ul><li><code>.code(statusCode)</code> - Sets the status code.</li><li><code>.status(statusCode)</code> - An alias for <code>.code(statusCode)</code>.</li><li><code>.statusCode</code> - Read and set the HTTP status code.</li><li><code>.server</code> - A reference to the fastify instance object.</li><li><code>.header(name, value)</code> - Sets a response header.</li><li><code>.headers(object)</code> - Sets all the keys of the object as response headers.</li><li><code>.getHeader(name)</code> - Retrieve value of already set header.</li><li><code>.getHeaders()</code> - Gets a shallow copy of all current response headers.</li><li><code>.removeHeader(key)</code> - Remove the value of a previously set header.</li><li><code>.hasHeader(name)</code> - Determine if a header has been set.</li><li><code>.trailer(key, function)</code> - Sets a response trailer.</li><li><code>.hasTrailer(key)</code> - Determine if a trailer has been set.</li><li><code>.removeTrailer(key)</code> - Remove the value of a previously set trailer.</li><li><code>.type(value)</code> - Sets the header <code>Content-Type</code>.</li><li><code>.redirect([code,] dest)</code> - Redirect to the specified url, the status code is optional (default to <code>302</code>).</li><li><code>.callNotFound()</code> - Invokes the custom not found handler.</li><li><code>.serialize(payload)</code> - Serializes the specified payload using the default JSON serializer or using the custom serializer (if one is set) and returns the serialized payload.</li><li><code>.getSerializationFunction(schema | httpStatus)</code> - Returns the serialization function for the specified schema or http status, if any of either are set.</li><li><code>.compileSerializationSchema(schema, httpStatus)</code> - Compiles the specified schema and returns a serialization function using the default (or customized) <code>SerializerCompiler</code>. The optional <code>httpStatus</code> is forwarded to the <code>SerializerCompiler</code> if provided, default to <code>undefined</code>.</li><li><code>.serializeInput(data, schema, [,httpStatus])</code> - Serializes the specified data using the specified schema and returns the serialized payload. If the optional <code>httpStatus</code> is provided, the function will use the serializer function given for that HTTP Status Code. Default to <code>undefined</code>.</li><li><code>.serializer(function)</code> - Sets a custom serializer for the payload.</li><li><code>.send(payload)</code> - Sends the payload to the user, could be a plain text, a buffer, JSON, stream, or an Error object.</li><li><code>.sent</code> - A boolean value that you can use if you need to know if <code>send</code> has already been called.</li><li><code>.hijack()</code> - interrupt the normal request lifecycle.</li><li><code>.raw</code> - The <a href=https://nodejs.org/dist/latest-v14.x/docs/api/http.html#http_class_http_serverresponse><code>http.ServerResponse</code></a> from Node core.</li><li><code>.log</code> - The logger instance of the incoming request.</li><li><code>.request</code> - The incoming request.</li><li><code>.context</code> - Access the <a href=.././Request>Request&#39;s context</a> property.</li></ul><pre><code class=language-js>fastify.get(&#39;/&#39;, options, function (request, reply) {
  // Your code
  reply
    .code(200)
    .header(&#39;Content-Type&#39;, &#39;application/json; charset=utf-8&#39;)
    .send({ hello: &#39;world&#39; })
})
</code></pre><p>Additionally, <code>Reply</code> provides access to the context of the request:</p><pre><code class=language-js>fastify.get(&#39;/&#39;, {config: {foo: &#39;bar&#39;}}, function (request, reply) {
  reply.send(&#39;handler config.foo = &#39; + reply.context.config.foo)
})
</code></pre><h3 id=codestatuscode>.code(statusCode)</h3><p><a id=code></a></p><p>If not set via <code>reply.code</code>, the resulting <code>statusCode</code> will be <code>200</code>.</p><h3 id=statuscode>.statusCode</h3><p><a id=statusCode></a></p><p>This property reads and sets the HTTP status code. It is an alias for <code>reply.code()</code> when used as a setter.</p><pre><code class=language-js>if (reply.statusCode &gt;= 299) {
  reply.statusCode = 500
}
</code></pre><h3 id=server>.server</h3><p><a id=server></a></p><p>The Fastify server instance, scoped to the current <a href=.././Encapsulation>encapsulation context</a>.</p><pre><code class=language-js>fastify.decorate(&#39;util&#39;, function util () {
  return &#39;foo&#39;
})

fastify.get(&#39;/&#39;, async function (req, rep) {
  return rep.server.util() // foo
})
</code></pre><h3 id=headerkey-value>.header(key, value)</h3><p><a id=header></a></p><p>Sets a response header. If the value is omitted or undefined, it is coerced to <code>&#39;&#39;</code>.</p><blockquote><p>Note: the header&#39;s value must be properly encoded using <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI><code>encodeURI</code></a> or similar modules such as <a href=https://www.npmjs.com/package/encodeurl><code>encodeurl</code></a>. Invalid characters will result in a 500 <code>TypeError</code> response.</p></blockquote><p>For more information, see <a href=https://nodejs.org/dist/latest-v14.x/docs/api/http.html#http_response_setheader_name_value><code>http.ServerResponse#setHeader</code></a>.</p><ul><li><h3 id=set-cookie>set-cookie</h3><p><a id=set-cookie></a></p><ul><li>When sending different values as a cookie with <code>set-cookie</code> as the key, every value will be sent as a cookie instead of replacing the previous value.</li></ul><pre><code class=language-js>reply.header(&#39;set-cookie&#39;, &#39;foo&#39;);
reply.header(&#39;set-cookie&#39;, &#39;bar&#39;);
</code></pre><ul><li><p>The browser will only consider the latest reference of a key for the <code>set-cookie</code> header. This is done to avoid parsing the <code>set-cookie</code> header when added to a reply and speeds up the serialization of the reply.</p></li><li><p>To reset the <code>set-cookie</code> header, you need to make an explicit call to <code>reply.removeHeader(&#39;set-cookie&#39;)</code>, read more about <code>.removeHeader(key)</code> <a href=#removeheaderkey>here</a>.</p></li></ul></li></ul><h3 id=headersobject>.headers(object)</h3><p><a id=headers></a></p><p>Sets all the keys of the object as response headers. <a href=#headerkey-value><code>.header</code></a> will be called under the hood.</p><pre><code class=language-js>reply.headers({
  &#39;x-foo&#39;: &#39;foo&#39;,
  &#39;x-bar&#39;: &#39;bar&#39;
})
</code></pre><h3 id=getheaderkey>.getHeader(key)</h3><p><a id=getHeader></a></p><p>Retrieves the value of a previously set header.</p><pre><code class=language-js>reply.header(&#39;x-foo&#39;, &#39;foo&#39;) // setHeader: key, value
reply.getHeader(&#39;x-foo&#39;) // &#39;foo&#39;
</code></pre><h3 id=getheaders>.getHeaders()</h3><p><a id=getHeaders></a></p><p>Gets a shallow copy of all current response headers, including those set via the raw <code>http.ServerResponse</code>. Note that headers set via Fastify take precedence over those set via <code>http.ServerResponse</code>.</p><pre><code class=language-js>reply.header(&#39;x-foo&#39;, &#39;foo&#39;)
reply.header(&#39;x-bar&#39;, &#39;bar&#39;)
reply.raw.setHeader(&#39;x-foo&#39;, &#39;foo2&#39;)
reply.getHeaders() // { &#39;x-foo&#39;: &#39;foo&#39;, &#39;x-bar&#39;: &#39;bar&#39; }
</code></pre><h3 id=removeheaderkey>.removeHeader(key)</h3><p><a id=getHeader></a></p><p>Remove the value of a previously set header.</p><pre><code class=language-js>reply.header(&#39;x-foo&#39;, &#39;foo&#39;)
reply.removeHeader(&#39;x-foo&#39;)
reply.getHeader(&#39;x-foo&#39;) // undefined
</code></pre><h3 id=hasheaderkey>.hasHeader(key)</h3><p><a id=hasHeader></a></p><p>Returns a boolean indicating if the specified header has been set.</p><h3 id=trailerkey-function>.trailer(key, function)</h3><p><a id=trailer></a></p><p>Sets a response trailer. Trailer is usually used when you need a header that requires heavy resources to be sent after the <code>data</code>, for example, <code>Server-Timing</code> and <code>Etag</code>. It can ensure the client receives the response data as soon as possible.</p><p><em>Note: The header <code>Transfer-Encoding: chunked</code> will be added once you use the trailer. It is a hard requirement for using trailer in Node.js.</em></p><p><em>Note: Currently, the computation function only supports synchronous function. That means <code>async-await</code> and <code>promise</code> are not supported.</em></p><pre><code class=language-js>reply.trailer(&#39;server-timing&#39;, function() {
  return &#39;db;dur=53, app;dur=47.2&#39;
})

const { createHash } = require(&#39;crypto&#39;)
// trailer function also recieve two argument
// @param {object} reply fastify reply
// @param {string|Buffer|null} payload payload that already sent, note that it will be null when stream is sent
reply.trailer(&#39;content-md5&#39;, function(reply, payload) {
  const hash = createHash(&#39;md5&#39;)
  hash.update(payload)
  return hash.disgest(&#39;hex&#39;)
})
</code></pre><h3 id=hastrailerkey>.hasTrailer(key)</h3><p><a id=hasTrailer></a></p><p>Returns a boolean indicating if the specified trailer has been set.</p><h3 id=removetrailerkey>.removeTrailer(key)</h3><p><a id=removeTrailer></a></p><p>Remove the value of a previously set trailer.</p><pre><code class=language-js>reply.trailer(&#39;server-timing&#39;, function() {
  return &#39;db;dur=53, app;dur=47.2&#39;
})
reply.removeTrailer(&#39;server-timing&#39;)
reply.getTrailer(&#39;server-timing&#39;) // undefined
</code></pre><h3 id=redirectcode--dest>.redirect([code ,] dest)</h3><p><a id=redirect></a></p><p>Redirects a request to the specified URL, the status code is optional, default to <code>302</code> (if status code is not already set by calling <code>code</code>).</p><blockquote><p>Note: the input URL must be properly encoded using <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI><code>encodeURI</code></a> or similar modules such as <a href=https://www.npmjs.com/package/encodeurl><code>encodeurl</code></a>. Invalid URLs will result in a 500 <code>TypeError</code> response.</p></blockquote><p>Example (no <code>reply.code()</code> call) sets status code to <code>302</code> and redirects to <code>/home</code></p><pre><code class=language-js>reply.redirect(&#39;/home&#39;)
</code></pre><p>Example (no <code>reply.code()</code> call) sets status code to <code>303</code> and redirects to <code>/home</code></p><pre><code class=language-js>reply.redirect(303, &#39;/home&#39;)
</code></pre><p>Example (<code>reply.code()</code> call) sets status code to <code>303</code> and redirects to <code>/home</code></p><pre><code class=language-js>reply.code(303).redirect(&#39;/home&#39;)
</code></pre><p>Example (<code>reply.code()</code> call) sets status code to <code>302</code> and redirects to <code>/home</code></p><pre><code class=language-js>reply.code(303).redirect(302, &#39;/home&#39;)
</code></pre><h3 id=callnotfound>.callNotFound()</h3><p><a id=call-not-found></a></p><p>Invokes the custom not found handler. Note that it will only call <code>preHandler</code> hook specified in <a href=.././Server#set-not-found-handler><code>setNotFoundHandler</code></a>.</p><pre><code class=language-js>reply.callNotFound()
</code></pre><h3 id=getresponsetime>.getResponseTime()</h3><p><a id=getResponseTime></a></p><p>Invokes the custom response time getter to calculate the amount of time passed since the request was started.</p><p>Note that unless this function is called in the <a href=.././Hooks#onresponse><code>onResponse</code> hook</a> it will always return <code>0</code>.</p><pre><code class=language-js>const milliseconds = reply.getResponseTime()
</code></pre><h3 id=typecontenttype>.type(contentType)</h3><p><a id=type></a></p><p>Sets the content type for the response. This is a shortcut for <code>reply.header(&#39;Content-Type&#39;, &#39;the/type&#39;)</code>.</p><pre><code class=language-js>reply.type(&#39;text/html&#39;)
</code></pre><p>If the <code>Content-Type</code> has a JSON subtype, and the charset parameter is not set, <code>utf-8</code> will be used as the charset by default.</p><h3 id=getserializationfunctionschema--httpstatus>.getSerializationFunction(schema | httpStatus)</h3><p><a id=getserializationfunction></a></p><p>By calling this function using a provided <code>schema</code> or <code>httpStatus</code>, it will return a <code>serialzation</code> function that can be used to serialize diverse inputs. It returns <code>undefined</code> if no serialization function was found using either of the provided inputs.</p><p>This heavily depends of the <code>schema#responses</code> attached to the route, or the serialization functions compiled by using <code>compileSerializationSchema</code>.</p><pre><code class=language-js>const serialize = reply
                  .getSerializationFunction({
                    type: &#39;object&#39;, 
                    properties: { 
                      foo: { 
                        type: &#39;string&#39; 
                      } 
                    } 
                  })
serialize({ foo: &#39;bar&#39; }) // &#39;{&quot;foo&quot;:&quot;bar&quot;}&#39;

// or

const serialize = reply
                  .getSerializationFunction(200)
serialize({ foo: &#39;bar&#39; }) // &#39;{&quot;foo&quot;:&quot;bar&quot;}&#39;
</code></pre><p>See <a href=#compileserializationschema>.compileSerializationSchema(schema, [httpStatus])</a> for more information on how to compile serialization schemas.</p><h3 id=compileserializationschemaschema-httpstatus>.compileSerializationSchema(schema, httpStatus)</h3><p><a id=compileserializationschema></a></p><p>This function will compile a serialization schema and return a function that can be used to serialize data. The function returned (a.k.a. <em>serialization function</em>) returned is compiled by using the provided <code>SerializerCompiler</code>. Also this is cached by using a <code>WeakMap</code> for reducing compilation calls.</p><p>The optional paramater <code>httpStatus</code>, if provided, is forwarded directly the <code>SerializerCompiler</code>, so it can be used to compile the serialization function if a custom <code>SerializerCompiler</code> is used.</p><p>This heavily depends of the <code>schema#responses</code> attached to the route, or the serialization functions compiled by using <code>compileSerializationSchema</code>.</p><pre><code class=language-js>const serialize = reply
                  .compileSerializationSchema({
                    type: &#39;object&#39;, 
                    properties: { 
                      foo: { 
                        type: &#39;string&#39; 
                      } 
                    } 
                  })
serialize({ foo: &#39;bar&#39; }) // &#39;{&quot;foo&quot;:&quot;bar&quot;}&#39;

// or

const serialize = reply
                  .compileSerializationSchema({
                    type: &#39;object&#39;, 
                    properties: { 
                      foo: { 
                        type: &#39;string&#39; 
                      } 
                    } 
                  }, 200)
serialize({ foo: &#39;bar&#39; }) // &#39;{&quot;foo&quot;:&quot;bar&quot;}&#39;
</code></pre><p>Note that you should be careful when using this function, as it will cache the compiled serialization functions based on the schema provided. If the schemas provided is mutated or changed, the serialization functions will not detect that the schema has been altered and for instance it will reuse the previously compiled serialization function based on the reference of the schema previously provided.</p><p>If there&#39;s a need to change the properties of a schema, always opt to create a totally new object, otherwise the implementation won&#39;t benefit from the cache mechanism.</p><p>:Using the following schema as example:</p><pre><code class=language-js>const schema1 = {
  type: &#39;object&#39;,
  properties: {
    foo: {
      type: &#39;string&#39;
    }
  }
}
</code></pre><p><em>Not</em></p><pre><code class=language-js>const serialize = reply.compileSerializationSchema(schema1)

// Later on...
schema1.properties.foo.type. = &#39;integer&#39;
const newSerialize = reply.compileSerializationSchema(schema1)

console.log(newSerialize === serialize) // true
</code></pre><p><em>Instead</em></p><pre><code class=language-js>const serialize = reply.compileSerializationSchema(schema1)

// Later on...
const newSchema = Object.assign({}, schema1)
newSchema.properties.foo.type = &#39;integer&#39;

const newSerialize = reply.compileSerializationSchema(newSchema)

console.log(newSerialize === serialize) // false
</code></pre><h3 id=serializeinputdata-schema--httpstatus-httpstatus>.serializeInput(data, [schema | httpStatus], [httpStatus])</h3><p><a id=serializeinput></a></p><p>This function will serialize the input data based on the provided schema, or http status code. If both provided, the <code>httpStatus</code> will take presedence.</p><p>If there is not a serialization function for a given <code>schema</code>, a new serialization function will be compiled forwarding the <code>httpStatus</code> if provided.</p><pre><code class=language-js>reply
  .serializeInput({ foo: &#39;bar&#39;}, {  
    type: &#39;object&#39;, 
    properties: { 
      foo: { 
        type: &#39;string&#39; 
      } 
    } 
  }) // &#39;{&quot;foo&quot;:&quot;bar&quot;}&#39;

// or

reply
  .serializeInput({ foo: &#39;bar&#39;}, {
    type: &#39;object&#39;, 
    properties: { 
      foo: { 
        type: &#39;string&#39; 
      } 
    } 
  }, 200) // &#39;{&quot;foo&quot;:&quot;bar&quot;}&#39;

// or

reply
  .serializeInput({ foo: &#39;bar&#39;}, 200) // &#39;{&quot;foo&quot;:&quot;bar&quot;}&#39;
</code></pre><p>See <a href=#compileserializationschema>.compileSerializationSchema(schema, [httpStatus])</a> for more information on how to compile serialization schemas.</p><h3 id=serializerfunc>.serializer(func)</h3><p><a id=serializer></a></p><p>By default, <code>.send()</code> will JSON-serialize any value that is not one of <code>Buffer</code>, <code>stream</code>, <code>string</code>, <code>undefined</code>, or <code>Error</code>. If you need to replace the default serializer with a custom serializer for a particular request, you can do so with the <code>.serializer()</code> utility. Be aware that if you are using a custom serializer, you must set a custom <code>&#39;Content-Type&#39;</code> header.</p><pre><code class=language-js>reply
  .header(&#39;Content-Type&#39;, &#39;application/x-protobuf&#39;)
  .serializer(protoBuf.serialize)
</code></pre><p>Note that you don&#39;t need to use this utility inside a <code>handler</code> because Buffers, streams, and strings (unless a serializer is set) are considered to already be serialized.</p><pre><code class=language-js>reply
  .header(&#39;Content-Type&#39;, &#39;application/x-protobuf&#39;)
  .send(protoBuf.serialize(data))
</code></pre><p>See <a href=#send><code>.send()</code></a> for more information on sending different types of values.</p><h3 id=raw>.raw</h3><p><a id=raw></a></p><p>This is the <a href=https://nodejs.org/dist/latest-v14.x/docs/api/http.html#http_class_http_serverresponse><code>http.ServerResponse</code></a> from Node core. Whilst you are using the Fastify <code>Reply</code> object, the use of <code>Reply.raw</code> functions is at your own risk as you are skipping all the Fastify logic of handling the HTTP response. e.g.:</p><pre><code class=language-js>app.get(&#39;/cookie-2&#39;, (req, reply) =&gt; {
  reply.setCookie(&#39;session&#39;, &#39;value&#39;, { secure: false }) // this will not be used

  // in this case we are using only the nodejs http server response object
  reply.raw.writeHead(200, { &#39;Content-Type&#39;: &#39;text/plain&#39; })
  reply.raw.write(&#39;ok&#39;)
  reply.raw.end()
})
</code></pre><p>Another example of the misuse of <code>Reply.raw</code> is explained in <a href=#getheaders>Reply</a>.</p><h3 id=sent>.sent</h3><p><a id=sent></a></p><p>As the name suggests, <code>.sent</code> is a property to indicate if a response has been sent via <code>reply.send()</code>. It will also be <code>true</code> in case <code>reply.hijack()</code> was used.</p><p>In case a route handler is defined as an async function or it returns a promise, it is possible to call <code>reply.hijack()</code> to indicate that the automatic invocation of <code>reply.send()</code> once the handler promise resolve should be skipped. By calling <code>reply.hijack()</code>, an application claims full responsibility for the low-level request and response. Moreover, hooks will not be invoked.</p><p><em>Modifying the <code>.sent</code> property directly is deprecated. Please use the aforementioned <code>.hijack()</code> method to achieve the same effect.</em></p><p><a name=hijack></a></p><h3 id=hijack>.hijack()</h3><p>Sometimes you might need to halt the execution of the normal request lifecycle and handle sending the response manually.</p><p>To achieve this, Fastify provides the <code>reply.hijack()</code> method that can be called during the request lifecycle (At any point before <code>reply.send()</code> is called), and allows you to prevent Fastify from sending the response, and from running the remaining hooks (and user handler if the reply was hijacked before).</p><pre><code class=language-js>app.get(&#39;/&#39;, (req, reply) =&gt; {
  reply.hijack()
  reply.raw.end(&#39;hello world&#39;)

  return Promise.resolve(&#39;this will be skipped&#39;)
})
</code></pre><p>If <code>reply.raw</code> is used to send a response back to the user, the <code>onResponse</code> hooks will still be executed.</p><h3 id=senddata>.send(data)</h3><p><a id=send></a></p><p>As the name suggests, <code>.send()</code> is the function that sends the payload to the end user.</p><h4 id=objects>Objects</h4><p><a id=send-object></a></p><p>As noted above, if you are sending JSON objects, <code>send</code> will serialize the object with <a href=https://www.npmjs.com/package/fast-json-stringify>fast-json-stringify</a> if you set an output schema, otherwise, <code>JSON.stringify()</code> will be used.</p><pre><code class=language-js>fastify.get(&#39;/json&#39;, options, function (request, reply) {
  reply.send({ hello: &#39;world&#39; })
})
</code></pre><h4 id=strings>Strings</h4><p><a id=send-string></a></p><p>If you pass a string to <code>send</code> without a <code>Content-Type</code>, it will be sent as <code>text/plain; charset=utf-8</code>. If you set the <code>Content-Type</code> header and pass a string to <code>send</code>, it will be serialized with the custom serializer if one is set, otherwise, it will be sent unmodified (unless the <code>Content-Type</code> header is set to <code>application/json; charset=utf-8</code>, in which case it will be JSON-serialized like an object â€” see the section above).</p><pre><code class=language-js>fastify.get(&#39;/json&#39;, options, function (request, reply) {
  reply.send(&#39;plain string&#39;)
})
</code></pre><h4 id=streams>Streams</h4><p><a id=send-streams></a></p><p><em>send</em> can also handle streams out of the box. If you are sending a stream and you have not set a <code>&#39;Content-Type&#39;</code> header, <em>send</em> will set it at <code>&#39;application/octet-stream&#39;</code>.</p><pre><code class=language-js>fastify.get(&#39;/streams&#39;, function (request, reply) {
  const fs = require(&#39;fs&#39;)
  const stream = fs.createReadStream(&#39;some-file&#39;, &#39;utf8&#39;)
  reply.send(stream)
})
</code></pre><h4 id=buffers>Buffers</h4><p><a id=send-buffers></a></p><p>If you are sending a buffer and you have not set a <code>&#39;Content-Type&#39;</code> header, <em>send</em> will set it to <code>&#39;application/octet-stream&#39;</code>.</p><pre><code class=language-js>const fs = require(&#39;fs&#39;)
fastify.get(&#39;/streams&#39;, function (request, reply) {
  fs.readFile(&#39;some-file&#39;, (err, fileBuffer) =&gt; {
    reply.send(err || fileBuffer)
  })
})
</code></pre><h4 id=errors>Errors</h4><p><a id=errors></a></p><p>If you pass to <em>send</em> an object that is an instance of <em>Error</em>, Fastify will automatically create an error structured as the following:</p><pre><code class=language-js>{
  error: String        // the HTTP error message
  code: String         // the Fastify error code
  message: String      // the user error message
  statusCode: Number   // the HTTP status code
}
</code></pre><p>You can add custom properties to the Error object, such as <code>headers</code>, that will be used to enhance the HTTP response.</p><p><em>Note: If you are passing an error to <code>send</code> and the statusCode is less than 400, Fastify will automatically set it at 500.</em></p><p>Tip: you can simplify errors by using the <a href=https://npm.im/http-errors><code>http-errors</code></a> module or <a href=https://github.com/fastify/fastify-sensible><code>@fastify/sensible</code></a> plugin to generate errors:</p><pre><code class=language-js>fastify.get(&#39;/&#39;, function (request, reply) {
  reply.send(httpErrors.Gone())
})
</code></pre><p>To customize the JSON error output you can do it by:</p><ul><li>setting a response JSON schema for the status code you need</li><li>add the additional properties to the <code>Error</code> instance</li></ul><p>Notice that if the returned status code is not in the response schema list, the default behaviour will be applied.</p><pre><code class=language-js>fastify.get(&#39;/&#39;, {
  schema: {
    response: {
      501: {
        type: &#39;object&#39;,
        properties: {
          statusCode: { type: &#39;number&#39; },
          code: { type: &#39;string&#39; },
          error: { type: &#39;string&#39; },
          message: { type: &#39;string&#39; },
          time: { type: &#39;string&#39; }
        }
      }
    }
  }
}, function (request, reply) {
  const error = new Error(&#39;This endpoint has not been implemented&#39;)
  error.time = &#39;it will be implemented in two weeks&#39;
  reply.code(501).send(error)
})
</code></pre><p>If you want to customize error handling, check out <a href=.././Server#seterrorhandler><code>setErrorHandler</code></a> API.</p><p><em>Note: you are responsible for logging when customizing the error handler</em></p><p>API:</p><pre><code class=language-js>fastify.setErrorHandler(function (error, request, reply) {
  request.log.warn(error)
  var statusCode = error.statusCode &gt;= 400 ? error.statusCode : 500
  reply
    .code(statusCode)
    .type(&#39;text/plain&#39;)
    .send(statusCode &gt;= 500 ? &#39;Internal server error&#39; : error.message)
})
</code></pre><p>The not found errors generated by the router will use the <a href=.././Server#setnotfoundhandler><code>setNotFoundHandler</code></a></p><p>API:</p><pre><code class=language-js>fastify.setNotFoundHandler(function (request, reply) {
  reply
    .code(404)
    .type(&#39;text/plain&#39;)
    .send(&#39;a custom not found&#39;)
})
</code></pre><h4 id=type-of-the-final-payload>Type of the final payload</h4><p><a id=payload-type></a></p><p>The type of the sent payload (after serialization and going through any <a href=.././Hooks#onsend><code>onSend</code> hooks</a>) must be one of the following types, otherwise, an error will be thrown:</p><ul><li><code>string</code></li><li><code>Buffer</code></li><li><code>stream</code></li><li><code>undefined</code></li><li><code>null</code></li></ul><h4 id=async-await-and-promises>Async-Await and Promises</h4><p><a id=async-await-promise></a></p><p>Fastify natively handles promises and supports async-await.</p><p><em>Note that in the following examples we are not using reply.send.</em></p><pre><code class=language-js>const { promisify } = require(&#39;util&#39;)
const delay = promisify(setTimeout)

fastify.get(&#39;/promises&#39;, options, function (request, reply) {
 return delay(200).then(() =&gt; { return { hello: &#39;world&#39; }})
})

fastify.get(&#39;/async-await&#39;, options, async function (request, reply) {
  await delay(200)
  return { hello: &#39;world&#39; }
})
</code></pre><p>Rejected promises default to a <code>500</code> HTTP status code. Reject the promise, or <code>throw</code> in an <code>async function</code>, with an object that has <code>statusCode</code> (or <code>status</code>) and <code>message</code> properties to modify the reply.</p><pre><code class=language-js>fastify.get(&#39;/teapot&#39;, async function (request, reply) {
  const err = new Error()
  err.statusCode = 418
  err.message = &#39;short and stout&#39;
  throw err
})

fastify.get(&#39;/botnet&#39;, async function (request, reply) {
  throw { statusCode: 418, message: &#39;short and stout&#39; }
  // will return to the client the same json
})
</code></pre><p>If you want to know more please review <a href=.././Routes#async-await>Routes#async-await</a>.</p><h3 id=thenfulfilled-rejected>.then(fulfilled, rejected)</h3><p><a id=then></a></p><p>As the name suggests, a <code>Reply</code> object can be awaited upon, i.e. <code>await reply</code> will wait until the reply is sent. The <code>await</code> syntax calls the <code>reply.then()</code>.</p><p><code>reply.then(fulfilled, rejected)</code> accepts two parameters:</p><ul><li><code>fulfilled</code> will be called when a response has been fully sent,</li><li><code>rejected</code> will be called if the underlying stream had an error, e.g. the socket has been destroyed.</li></ul><p>For more details, see:</p><ul><li><a href=https://github.com/fastify/fastify/issues/1864>https://github.com/fastify/fastify/issues/1864</a> for the discussion about this feature</li><li><a href=https://promisesaplus.com/ >https://promisesaplus.com/</a> for the definition of thenables</li><li><a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/then>https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/then</a> for the signature</li></ul></div><hr><nav class=level></nav></div></div></div></section><script>// dynamically creates a submenu for the current section based on the content headers
  var titles = document.querySelectorAll('#doc-content h3, #doc-content h4')
  var currentMenu = document.getElementById('doc-menu-section')
  if (titles.length && currentMenu) {
    var submenu = document.createElement('ul')
    titles.forEach(el => {
      var currentSubmenuItem = document.createElement('li')
      var currentSubmenuLink = document.createElement('a')
      currentSubmenuLink.href = '#' + el.id
      currentSubmenuLink.title = el.textContent
      currentSubmenuLink.append(document.createTextNode(el.textContent))
      currentSubmenuItem.append(currentSubmenuLink)
      submenu.append(currentSubmenuItem)
    })
    currentMenu.append(submenu)
  }

  // dynamically creates header anchor links
  var headers = document.querySelectorAll('#doc-content h3, #doc-content h4')
  headers.forEach(el => {
    var currentAnchorLink = document.createElement('a')
    currentAnchorLink.className = 'anchor'
    currentAnchorLink.href = "#" + el.id
    currentAnchorLink.append(document.createTextNode('Â¶'))
    el.insertBefore(currentAnchorLink, el.firstChild);
  })</script><script>const contentLoaded = document.addEventListener('DOMContentLoaded', setTOCHeight)
  const resize = window.addEventListener('resize', setTOCHeight)

  function setTOCHeight() {
    const docHeight = window.innerHeight
    const tocSidebar = document.querySelector('#toc') || 0

    const tocHeight = docHeight - tocSidebar.getBoundingClientRect().top

    document.documentElement.style
      .setProperty('--TOC-height', `${tocHeight}px`)
  }

  window.addEventListener('beforeunload', () => {
    document.removeEventListener(contentLoaded)
    window.removeEventListener(resize)
  })</script></main><footer class="grey is-primary footer"><div class=container><div class="content has-text-centered"><p>Fastify, Copyright &copy; 2016-2023 <a href=https://openjsf.org/ target=_blank rel=noopener>OpenJS Foundation</a> and <a href=https://github.com/fastify/fastify#team target=_blank rel=noopener>The Fastify team</a>, Licensed under <a href=https://github.com/fastify/fastify/blob/master/LICENSE target=_blank rel=noopener>MIT</a></p><a href=https://www.netlify.com><img src=https://www.netlify.com/img/global/badges/netlify-color-accent.svg alt="Deploys by Netlify" loading=lazy decoding=async></a><p><small>Icons by simpleicons.org</small></p></div></div></footer><script src=/js/main.1e1d476db6c0b326.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js integrity="sha512-s+tOYYcC3Jybgr9mVsdAxsRYlGNq4mlAurOrfNuGMQ/SCofNPu92tjE7YRZCsdEtWL1yGkqk15fU/ark206YTg==" crossorigin=anonymous></script><script>hljs.highlightAll();</script><script src=https://cdn.jsdelivr.net/npm/@docsearch/js@alpha></script><script type=text/javascript>docsearch({
        appId: 'DMPMC33PLU',
        apiKey: '12d46b3bfeee6511031cfe00778f3e45',
        indexName: 'fastify',
        container: '#algolia-search-input',
        algoliaOptions: { 'facetFilters': ["version:latest", "tags:docs"] }
      });</script></body></html>