<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Decorators</title><meta name=description content="Fast and low overhead web framework, for Node.js"><link rel=apple-touch-icon sizes=57x57 href=/images/apple-icon-57x57.ed24c0a19503e080.png><link rel=apple-touch-icon sizes=60x60 href=/images/apple-icon-60x60.60c285c424d50738.png><link rel=apple-touch-icon sizes=72x72 href=/images/apple-icon-72x72.e49b27cfe1ab1461.png><link rel=apple-touch-icon sizes=76x76 href=/images/apple-icon-76x76.752f43fc91b8c1f7.png><link rel=apple-touch-icon sizes=114x114 href=/images/apple-icon-114x114.61739fa1d5a7059a.png><link rel=apple-touch-icon sizes=120x120 href=/images/apple-icon-120x120.7c25de37c5ce2ec1.png><link rel=apple-touch-icon sizes=144x144 href=/images/apple-icon-144x144.04d88fb27bd92cbe.png><link rel=apple-touch-icon sizes=152x152 href=/images/apple-icon-152x152.9364781175671626.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-icon-180x180.67579100928bfcd2.png><link rel=icon type=image/png sizes=192x192 href=/images/android-icon-192x192.37eb7f1ae3853740.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.1e22f0e774bc3cce.png><link rel=icon type=image/png sizes=96x96 href=/images/favicon-96x96.7e8a68b1b80c1799.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.e534ce05cb727f1a.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content=#ffffff><meta name=msapplication-TileImage content=/images/ms-icon-144x144.png><meta name=theme-color content=#ffffff><meta property=og:url content=https://www.fastify.io/docs/v4.10.x/Reference/Decorators><meta property=og:type content=website><meta property=og:title content=Decorators><meta property=og:description content="Fast and low overhead web framework, for Node.js"><meta property=og:image content=https://www.fastify.io/images/fastify-fb-share-image.07b6e6860853c758.png><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@fastifyjs><meta name=twitter:creator content=@fastifyjs><meta name=twitter:title content=Decorators><meta name=twitter:description content="Fast and low overhead web framework, for Node.js"><meta name=twitter:image content=https://www.fastify.io/images/fastify-twitter-share-image.cd9f217b360af3e2.png><link rel=stylesheet href=/css/style.f4d6592b3a91c5ef.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/default.min.css integrity="sha512-kZqGbhf9JTB4bVJ0G8HCkqmaPcRgo88F0dneK30yku5Y/dep7CZfCnNml2Je/sY4lBoqoksXz4PtVXS4GHSUzQ==" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@alpha><meta name=robots content="noindex, nofollow"></head><body><nav id=main-navbar class=navbar><div class=navbar-brand><a class=navbar-item href=/ ><img src=/images/fastify-logo-menu.d13f8da7a965c800.png alt="Fastify: Fast and low overhead web framework, for Node.js" height=28 decoding=async> </a><a class="navbar-item is-hidden-desktop" href=https://github.com/fastify/fastify target=_blank rel=noopener><span class=icon style="color: #333;"><i class="fa fa-github"></i></span></a><div class="navbar-burger burger" data-target=mobileMenu><span></span> <span></span> <span></span></div></div><div class=navbar-menu id=mobileMenu><div class=navbar-start><a class=navbar-item href=/ >Home</a> <a class=navbar-item href=/docs/latest>Docs</a> <a class=navbar-item href=/ecosystem>Ecosystem</a> <a class=navbar-item href=/benchmarks>Benchmarks</a> <a class=navbar-item href=/contribute>Contribute</a> <a class=navbar-item href=https://medium.com/@fastifyjs/ >Blog</a> <a class=navbar-item href=https://github.com/fastify/help>Help</a></div><div class=navbar-end><span id=algolia-search-input class="control has-icons-left navbar-item"></span> <a class=navbar-item href=https://github.com/fastify/fastify target=_blank rel=noopener><span class="fa fa-github"></span>&nbsp;GitHub </a><a class=navbar-item href=https://twitter.com/fastifyjs target=_blank rel=noopener><span class="fa fa-twitter"></span>&nbsp;Twitter </a><a class=navbar-item rel=me href=https://fosstodon.org/@fastify target=_blank><span class="fa fa-hashtag"></span>&nbsp;Mastodon</a></div></div></nav><main class=page-content aria-label=Content><section class="hero is-primary" style="background-image: url(/images/bg-pattern-dark.3f8cda863b3bbf52.png)"><div class=hero-body><div class=container><h1 class=title>Documentation (v4.10.2)</h1></div></div></section><section class=section><div class=container><div class=columns><div class="column is-3 is-hidden-mobile sticky-container"><aside class="menu sticky" id=toc><ul class=menu-list></ul><p class=menu-label><a href=/docs/v4.10.x/Guides>Guides</a></p><ul class=menu-list><li style="text-transform: capitalize"><a title=Benchmarking href=/docs/v4.10.x/Guides/Benchmarking>Benchmarking</a></li><li style="text-transform: capitalize"><a title=Contributing href=/docs/v4.10.x/Guides/Contributing>Contributing</a></li><li style="text-transform: capitalize"><a title=Database href=/docs/v4.10.x/Guides/Database>Database</a></li><li style="text-transform: capitalize"><a title=Delay-Accepting-Requests href=/docs/v4.10.x/Guides/Delay-Accepting-Requests>Delay-Accepting-Requests</a></li><li style="text-transform: capitalize"><a title=Ecosystem href=/docs/v4.10.x/Guides/Ecosystem>Ecosystem</a></li><li style="text-transform: capitalize"><a title=Fluent-Schema href=/docs/v4.10.x/Guides/Fluent-Schema>Fluent-Schema</a></li><li style="text-transform: capitalize"><a title=Getting-Started href=/docs/v4.10.x/Guides/Getting-Started>Getting-Started</a></li><li style="text-transform: capitalize"><a title=Migration-Guide-V3 href=/docs/v4.10.x/Guides/Migration-Guide-V3>Migration-Guide-V3</a></li><li style="text-transform: capitalize"><a title=Migration-Guide-V4 href=/docs/v4.10.x/Guides/Migration-Guide-V4>Migration-Guide-V4</a></li><li style="text-transform: capitalize"><a title=Plugins-Guide href=/docs/v4.10.x/Guides/Plugins-Guide>Plugins-Guide</a></li><li style="text-transform: capitalize"><a title=Prototype-Poisoning href=/docs/v4.10.x/Guides/Prototype-Poisoning>Prototype-Poisoning</a></li><li style="text-transform: capitalize"><a title=Recommendations href=/docs/v4.10.x/Guides/Recommendations>Recommendations</a></li><li style="text-transform: capitalize"><a title=Serverless href=/docs/v4.10.x/Guides/Serverless>Serverless</a></li><li style="text-transform: capitalize"><a title=Style-Guide href=/docs/v4.10.x/Guides/Style-Guide>Style-Guide</a></li><li style="text-transform: capitalize"><a title=Testing href=/docs/v4.10.x/Guides/Testing>Testing</a></li><li style="text-transform: capitalize"><a title=Write-Plugin href=/docs/v4.10.x/Guides/Write-Plugin>Write-Plugin</a></li><li style="text-transform: capitalize"><a title=Write-Type-Provider href=/docs/v4.10.x/Guides/Write-Type-Provider>Write-Type-Provider</a></li></ul><p class=menu-label><a href=/docs/v4.10.x/Reference>Reference</a></p><ul class=menu-list><li style="text-transform: capitalize"><a title=ContentTypeParser href=/docs/v4.10.x/Reference/ContentTypeParser>ContentTypeParser</a></li><li style="text-transform: capitalize" id=doc-menu-section><a title=Decorators class=is-active href=/docs/v4.10.x/Reference/Decorators>Decorators</a></li><li style="text-transform: capitalize"><a title=Encapsulation href=/docs/v4.10.x/Reference/Encapsulation>Encapsulation</a></li><li style="text-transform: capitalize"><a title=Errors href=/docs/v4.10.x/Reference/Errors>Errors</a></li><li style="text-transform: capitalize"><a title=HTTP2 href=/docs/v4.10.x/Reference/HTTP2>HTTP2</a></li><li style="text-transform: capitalize"><a title=Hooks href=/docs/v4.10.x/Reference/Hooks>Hooks</a></li><li style="text-transform: capitalize"><a title=LTS href=/docs/v4.10.x/Reference/LTS>LTS</a></li><li style="text-transform: capitalize"><a title=Lifecycle href=/docs/v4.10.x/Reference/Lifecycle>Lifecycle</a></li><li style="text-transform: capitalize"><a title=Logging href=/docs/v4.10.x/Reference/Logging>Logging</a></li><li style="text-transform: capitalize"><a title=Middleware href=/docs/v4.10.x/Reference/Middleware>Middleware</a></li><li style="text-transform: capitalize"><a title=Plugins href=/docs/v4.10.x/Reference/Plugins>Plugins</a></li><li style="text-transform: capitalize"><a title=Reply href=/docs/v4.10.x/Reference/Reply>Reply</a></li><li style="text-transform: capitalize"><a title=Request href=/docs/v4.10.x/Reference/Request>Request</a></li><li style="text-transform: capitalize"><a title=Routes href=/docs/v4.10.x/Reference/Routes>Routes</a></li><li style="text-transform: capitalize"><a title=Server href=/docs/v4.10.x/Reference/Server>Server</a></li><li style="text-transform: capitalize"><a title=Type-Providers href=/docs/v4.10.x/Reference/Type-Providers>Type-Providers</a></li><li style="text-transform: capitalize"><a title=TypeScript href=/docs/v4.10.x/Reference/TypeScript>TypeScript</a></li><li style="text-transform: capitalize"><a title=Validation-and-Serialization href=/docs/v4.10.x/Reference/Validation-and-Serialization>Validation-and-Serialization</a></li></ul><div class=content style="margin: .8em; border-top: 1px solid #ccc; padding: .8em 0 0 0">Docs version<div class=field><div class=control><div class=select><select onchange="if (this.value) window.location.href=this.value"><option value=/docs/latest>latest</option><option value=/docs/master>master</option><option value=/docs/v4.12.x>v4.12.x</option><option value=/docs/v4.11.x>v4.11.x</option><option selected value=/docs/v4.10.x>v4.10.x</option><option value=/docs/v4.9.x>v4.9.x</option><option value=/docs/v4.8.x>v4.8.x</option><option value=/docs/v4.7.x>v4.7.x</option><option value=/docs/v4.6.x>v4.6.x</option><option value=/docs/v4.5.x>v4.5.x</option><option value=/docs/v4.4.x>v4.4.x</option><option value=/docs/v4.3.x>v4.3.x</option><option value=/docs/v4.2.x>v4.2.x</option><option value=/docs/v4.1.x>v4.1.x</option><option value=/docs/v4.0.x>v4.0.x</option><option value=/docs/v3.29.x>v3.29.x</option><option value=/docs/v3.28.x>v3.28.x</option><option value=/docs/v3.27.x>v3.27.x</option><option value=/docs/v3.26.x>v3.26.x</option><option value=/docs/v3.25.x>v3.25.x</option><option value=/docs/v3.24.x>v3.24.x</option><option value=/docs/v3.23.x>v3.23.x</option><option value=/docs/v3.22.x>v3.22.x</option><option value=/docs/v3.21.x>v3.21.x</option><option value=/docs/v3.20.x>v3.20.x</option><option value=/docs/v3.19.x>v3.19.x</option><option value=/docs/v3.18.x>v3.18.x</option><option value=/docs/v3.17.x>v3.17.x</option><option value=/docs/v3.16.x>v3.16.x</option><option value=/docs/v3.15.x>v3.15.x</option><option value=/docs/v3.14.x>v3.14.x</option><option value=/docs/v3.13.x>v3.13.x</option><option value=/docs/v3.12.x>v3.12.x</option><option value=/docs/v3.11.x>v3.11.x</option><option value=/docs/v3.10.x>v3.10.x</option><option value=/docs/v3.9.x>v3.9.x</option><option value=/docs/v3.8.x>v3.8.x</option><option value=/docs/v3.7.x>v3.7.x</option><option value=/docs/v3.6.x>v3.6.x</option><option value=/docs/v3.5.x>v3.5.x</option><option value=/docs/v3.4.x>v3.4.x</option><option value=/docs/v3.3.x>v3.3.x</option><option value=/docs/v3.2.x>v3.2.x</option><option value=/docs/v3.1.x>v3.1.x</option><option value=/docs/v3.0.x>v3.0.x</option><option value=/docs/v2.15.x>v2.15.x</option><option value=/docs/v2.14.x>v2.14.x</option><option value=/docs/v2.13.x>v2.13.x</option><option value=/docs/v2.12.x>v2.12.x</option><option value=/docs/v2.11.x>v2.11.x</option><option value=/docs/v2.10.x>v2.10.x</option><option value=/docs/v2.9.x>v2.9.x</option><option value=/docs/v2.8.x>v2.8.x</option><option value=/docs/v2.7.x>v2.7.x</option><option value=/docs/v2.6.x>v2.6.x</option><option value=/docs/v2.5.x>v2.5.x</option><option value=/docs/v2.4.x>v2.4.x</option><option value=/docs/v2.3.x>v2.3.x</option><option value=/docs/v2.2.x>v2.2.x</option><option value=/docs/v2.1.x>v2.1.x</option><option value=/docs/v2.0.x>v2.0.x</option><option value=/docs/v1.14.x>v1.14.x</option><option value=/docs/v1.13.x>v1.13.x</option></select></div></div></div></div></aside></div><div class="column is-9"><nav class=breadcrumb><ul><li><a href=/ style="padding-left: 0">Fastify</a></li><li><a href=/docs/v4.10.x>Documentation</a></li><li><div class=field><div class=control><div class=select><select onchange="if (this.value) window.location.href=this.value" style="border: none;"><option value=/docs/latest>latest</option><option value=/docs/master>master</option><option value=/docs/v4.12.x>v4.12.x</option><option value=/docs/v4.11.x>v4.11.x</option><option selected value=/docs/v4.10.x>v4.10.x</option><option value=/docs/v4.9.x>v4.9.x</option><option value=/docs/v4.8.x>v4.8.x</option><option value=/docs/v4.7.x>v4.7.x</option><option value=/docs/v4.6.x>v4.6.x</option><option value=/docs/v4.5.x>v4.5.x</option><option value=/docs/v4.4.x>v4.4.x</option><option value=/docs/v4.3.x>v4.3.x</option><option value=/docs/v4.2.x>v4.2.x</option><option value=/docs/v4.1.x>v4.1.x</option><option value=/docs/v4.0.x>v4.0.x</option><option value=/docs/v3.29.x>v3.29.x</option><option value=/docs/v3.28.x>v3.28.x</option><option value=/docs/v3.27.x>v3.27.x</option><option value=/docs/v3.26.x>v3.26.x</option><option value=/docs/v3.25.x>v3.25.x</option><option value=/docs/v3.24.x>v3.24.x</option><option value=/docs/v3.23.x>v3.23.x</option><option value=/docs/v3.22.x>v3.22.x</option><option value=/docs/v3.21.x>v3.21.x</option><option value=/docs/v3.20.x>v3.20.x</option><option value=/docs/v3.19.x>v3.19.x</option><option value=/docs/v3.18.x>v3.18.x</option><option value=/docs/v3.17.x>v3.17.x</option><option value=/docs/v3.16.x>v3.16.x</option><option value=/docs/v3.15.x>v3.15.x</option><option value=/docs/v3.14.x>v3.14.x</option><option value=/docs/v3.13.x>v3.13.x</option><option value=/docs/v3.12.x>v3.12.x</option><option value=/docs/v3.11.x>v3.11.x</option><option value=/docs/v3.10.x>v3.10.x</option><option value=/docs/v3.9.x>v3.9.x</option><option value=/docs/v3.8.x>v3.8.x</option><option value=/docs/v3.7.x>v3.7.x</option><option value=/docs/v3.6.x>v3.6.x</option><option value=/docs/v3.5.x>v3.5.x</option><option value=/docs/v3.4.x>v3.4.x</option><option value=/docs/v3.3.x>v3.3.x</option><option value=/docs/v3.2.x>v3.2.x</option><option value=/docs/v3.1.x>v3.1.x</option><option value=/docs/v3.0.x>v3.0.x</option><option value=/docs/v2.15.x>v2.15.x</option><option value=/docs/v2.14.x>v2.14.x</option><option value=/docs/v2.13.x>v2.13.x</option><option value=/docs/v2.12.x>v2.12.x</option><option value=/docs/v2.11.x>v2.11.x</option><option value=/docs/v2.10.x>v2.10.x</option><option value=/docs/v2.9.x>v2.9.x</option><option value=/docs/v2.8.x>v2.8.x</option><option value=/docs/v2.7.x>v2.7.x</option><option value=/docs/v2.6.x>v2.6.x</option><option value=/docs/v2.5.x>v2.5.x</option><option value=/docs/v2.4.x>v2.4.x</option><option value=/docs/v2.3.x>v2.3.x</option><option value=/docs/v2.2.x>v2.2.x</option><option value=/docs/v2.1.x>v2.1.x</option><option value=/docs/v2.0.x>v2.0.x</option><option value=/docs/v1.14.x>v1.14.x</option><option value=/docs/v1.13.x>v1.13.x</option></select></div></div></div></li><div class=field><div class=control><div class=select><select onchange="if (this.value) window.location.href=this.value" style="border: none;"><option value=/docs/v4.10.x>Documentation</option><option value=/docs/v4.10.x/Guides>Guides</option><option value=/docs/v4.10.x/Guides/Benchmarking>Benchmarking</option><option value=/docs/v4.10.x/Guides/Contributing>Contributing</option><option value=/docs/v4.10.x/Guides/Database>Database</option><option value=/docs/v4.10.x/Guides/Delay-Accepting-Requests>Delay-Accepting-Requests</option><option value=/docs/v4.10.x/Guides/Ecosystem>Ecosystem</option><option value=/docs/v4.10.x/Guides/Fluent-Schema>Fluent-Schema</option><option value=/docs/v4.10.x/Guides/Getting-Started>Getting-Started</option><option value=/docs/v4.10.x/Guides/Migration-Guide-V3>Migration-Guide-V3</option><option value=/docs/v4.10.x/Guides/Migration-Guide-V4>Migration-Guide-V4</option><option value=/docs/v4.10.x/Guides/Plugins-Guide>Plugins-Guide</option><option value=/docs/v4.10.x/Guides/Prototype-Poisoning>Prototype-Poisoning</option><option value=/docs/v4.10.x/Guides/Recommendations>Recommendations</option><option value=/docs/v4.10.x/Guides/Serverless>Serverless</option><option value=/docs/v4.10.x/Guides/Style-Guide>Style-Guide</option><option value=/docs/v4.10.x/Guides/Testing>Testing</option><option value=/docs/v4.10.x/Guides/Write-Plugin>Write-Plugin</option><option value=/docs/v4.10.x/Guides/Write-Type-Provider>Write-Type-Provider</option><option value=/docs/v4.10.x/Reference>Reference</option><option value=/docs/v4.10.x/Reference/ContentTypeParser>ContentTypeParser</option><option selected value=/docs/v4.10.x/Reference/Decorators>Decorators</option><option value=/docs/v4.10.x/Reference/Encapsulation>Encapsulation</option><option value=/docs/v4.10.x/Reference/Errors>Errors</option><option value=/docs/v4.10.x/Reference/HTTP2>HTTP2</option><option value=/docs/v4.10.x/Reference/Hooks>Hooks</option><option value=/docs/v4.10.x/Reference/LTS>LTS</option><option value=/docs/v4.10.x/Reference/Lifecycle>Lifecycle</option><option value=/docs/v4.10.x/Reference/Logging>Logging</option><option value=/docs/v4.10.x/Reference/Middleware>Middleware</option><option value=/docs/v4.10.x/Reference/Plugins>Plugins</option><option value=/docs/v4.10.x/Reference/Reply>Reply</option><option value=/docs/v4.10.x/Reference/Request>Request</option><option value=/docs/v4.10.x/Reference/Routes>Routes</option><option value=/docs/v4.10.x/Reference/Server>Server</option><option value=/docs/v4.10.x/Reference/Type-Providers>Type-Providers</option><option value=/docs/v4.10.x/Reference/TypeScript>TypeScript</option><option value=/docs/v4.10.x/Reference/Validation-and-Serialization>Validation-and-Serialization</option></select></div></div></div></ul></nav><div id=doc-content class=content><h2 id=decorators>Decorators</h2><p>The decorators API allows customization of the core Fastify objects, such as the server instance itself and any request and reply objects used during the HTTP request lifecycle. The decorators API can be used to attach any type of property to the core objects, e.g. functions, plain objects, or native types.</p><p>This API is <em>synchronous</em>. Attempting to define a decoration asynchronously could result in the Fastify instance booting before the decoration completes its initialization. To avoid this issue, and register an asynchronous decoration, the <code>register</code> API, in combination with <code>fastify-plugin</code>, must be used instead. To learn more, see the <a href=.././Plugins>Plugins</a> documentation.</p><p>Decorating core objects with this API allows the underlying JavaScript engine to optimize the handling of server, request, and reply objects. This is accomplished by defining the shape of all such object instances before they are instantiated and used. As an example, the following is not recommended because it will change the shape of objects during their lifecycle:</p><pre><code class=language-js>// Bad example! Continue reading.

// Attach a user property to the incoming request before the request
// handler is invoked.
fastify.addHook(&#39;preHandler&#39;, function (req, reply, done) {
  req.user = &#39;Bob Dylan&#39;
  done()
})

// Use the attached user property in the request handler.
fastify.get(&#39;/&#39;, function (req, reply) {
  reply.send(`Hello, ${req.user}`)
})
</code></pre><p>Since the above example mutates the request object after it has already been instantiated, the JavaScript engine must deoptimize access to the request object. By using the decoration API this deoptimization is avoided:</p><pre><code class=language-js>// Decorate request with a &#39;user&#39; property
fastify.decorateRequest(&#39;user&#39;, &#39;&#39;)

// Update our property
fastify.addHook(&#39;preHandler&#39;, (req, reply, done) =&gt; {
  req.user = &#39;Bob Dylan&#39;
  done()
})
// And finally access it
fastify.get(&#39;/&#39;, (req, reply) =&gt; {
  reply.send(`Hello, ${req.user}!`)
})
</code></pre><p>Note that it is important to keep the initial shape of a decorated field as close as possible to the value intended to be set dynamically in the future. Initialize a decorator as a <code>&#39;&#39;</code> if the intended value is a string, and as <code>null</code> if it will be an object or a function.</p><p>Remember this example works only with value types as reference types will be shared amongst all requests. See <a href=#decorate-request>decorateRequest</a>.</p><p>See <a href=https://mathiasbynens.be/notes/shapes-ics>JavaScript engine fundamentals: Shapes and Inline Caches</a> for more information on this topic.</p><h3 id=usage>Usage</h3><p><a id=usage></a></p><h4 id=decoratename-value-dependencies><code>decorate(name, value, [dependencies])</code></h4><p><a id=decorate></a></p><p>This method is used to customize the Fastify <a href=.././Server>server</a> instance.</p><p>For example, to attach a new method to the server instance:</p><pre><code class=language-js>fastify.decorate(&#39;utility&#39;, function () {
  // Something very useful
})
</code></pre><p>As mentioned above, non-function values can be attached:</p><pre><code class=language-js>fastify.decorate(&#39;conf&#39;, {
  db: &#39;some.db&#39;,
  port: 3000
})
</code></pre><p>To access decorated properties, use the name provided to the decoration API:</p><pre><code class=language-js>fastify.utility()

console.log(fastify.conf.db)
</code></pre><p>The decorated <a href=.././Server>Fastify server</a> is bound to <code>this</code> in route <a href=.././Routes>route</a> handlers:</p><pre><code class=language-js>fastify.decorate(&#39;db&#39;, new DbConnection())

fastify.get(&#39;/&#39;, async function (request, reply) {
  // using return
  return { hello: await this.db.query(&#39;world&#39;) }
  
  // or
  // using reply.send()
  reply.send({ hello: await this.db.query(&#39;world&#39;) })
  await reply
})
</code></pre><p>The <code>dependencies</code> parameter is an optional list of decorators that the decorator being defined relies upon. This list is simply a list of string names of other decorators. In the following example, the &quot;utility&quot; decorator depends upon &quot;greet&quot; and &quot;hi&quot; decorators:</p><pre><code class=language-js>async function greetDecorator (fastify, opts) {
  fastify.decorate(&#39;greet&#39;, () =&gt; {
    return &#39;greet message&#39;
  })
}

async function hiDecorator (fastify, opts) {
  fastify.decorate(&#39;hi&#39;, () =&gt; {
    return &#39;hi message&#39;
  })
}

async function utilityDecorator (fastify, opts) {
  fastify.decorate(&#39;utility&#39;, () =&gt; {
    return `${fastify.greet()} | ${fastify.hi()}`
  })
}

fastify.register(fastifyPlugin(greetDecorator, { name: &#39;greet&#39; }))
fastify.register(fastifyPlugin(hiDecorator, { name: &#39;hi&#39; }))
fastify.register(fastifyPlugin(utilityDecorator, { dependencies: [&#39;greet&#39;, &#39;hi&#39;] }))

fastify.get(&#39;/&#39;, function (req, reply) {
  // Response: {&quot;hello&quot;:&quot;greet message | hi message&quot;}
  reply.send({ hello: fastify.utility() })
})

fastify.listen({ port: 3000 }, (err, address) =&gt; {
  if (err) throw err
})
</code></pre><p>Note: using an arrow function will break the binding of <code>this</code> to the <code>FastifyInstance</code>.</p><p>If a dependency is not satisfied, the <code>decorate</code> method will throw an exception. The dependency check is performed before the server instance is booted. Thus, it cannot occur during runtime.</p><h4 id=decoratereplyname-value-dependencies><code>decorateReply(name, value, [dependencies])</code></h4><p><a id=decorate-reply></a></p><p>As the name suggests, this API is used to add new methods/properties to the core <code>Reply</code> object:</p><pre><code class=language-js>fastify.decorateReply(&#39;utility&#39;, function () {
  // Something very useful
})
</code></pre><p>Note: using an arrow function will break the binding of <code>this</code> to the Fastify <code>Reply</code> instance.</p><p>Note: using <code>decorateReply</code> will emit a warning if used with a reference type:</p><pre><code class=language-js>// Don&#39;t do this
fastify.decorateReply(&#39;foo&#39;, { bar: &#39;fizz&#39;})
</code></pre><p>In this example, the reference of the object is shared with all the requests: <strong>any mutation will impact all requests, potentially creating security vulnerabilities or memory leaks</strong>. To achieve proper encapsulation across requests configure a new value for each incoming request in the <a href=.././Hooks#onrequest><code>&#39;onRequest&#39;</code> hook</a>. Example:</p><pre><code class=language-js>const fp = require(&#39;fastify-plugin&#39;)

async function myPlugin (app) {
  app.decorateRequest(&#39;foo&#39;, null)
  app.addHook(&#39;onRequest&#39;, async (req, reply) =&gt; {
    req.foo = { bar: 42 }
  })
}

module.exports = fp(myPlugin)
</code></pre><p>See <a href=#decorate><code>decorate</code></a> for information about the <code>dependencies</code> parameter.</p><h4 id=decoraterequestname-value-dependencies><code>decorateRequest(name, value, [dependencies])</code></h4><p><a id=decorate-request></a></p><p>As above with <a href=#decorate-reply><code>decorateReply</code></a>, this API is used add new methods/properties to the core <code>Request</code> object:</p><pre><code class=language-js>fastify.decorateRequest(&#39;utility&#39;, function () {
  // something very useful
})
</code></pre><p>Note: using an arrow function will break the binding of <code>this</code> to the Fastify <code>Request</code> instance.</p><p>Note: using <code>decorateRequest</code> will emit a warning if used with a reference type:</p><pre><code class=language-js>// Don&#39;t do this
fastify.decorateRequest(&#39;foo&#39;, { bar: &#39;fizz&#39;})
</code></pre><p>In this example, the reference of the object is shared with all the requests: <strong>any mutation will impact all requests, potentially creating security vulnerabilities or memory leaks</strong>.</p><p>To achieve proper encapsulation across requests configure a new value for each incoming request in the <a href=.././Hooks#onrequest><code>&#39;onRequest&#39;</code> hook</a>. Example:</p><pre><code class=language-js>const fp = require(&#39;fastify-plugin&#39;)

async function myPlugin (app) {
  app.decorateRequest(&#39;foo&#39;, null)
  app.addHook(&#39;onRequest&#39;, async (req, reply) =&gt; {
    req.foo = { bar: 42 }
  })
}

module.exports = fp(myPlugin)
</code></pre><p>See <a href=#decorate><code>decorate</code></a> for information about the <code>dependencies</code> parameter.</p><h4 id=hasdecoratorname><code>hasDecorator(name)</code></h4><p><a id=has-decorator></a></p><p>Used to check for the existence of a server instance decoration:</p><pre><code class=language-js>fastify.hasDecorator(&#39;utility&#39;)
</code></pre><h4 id=hasrequestdecorator>hasRequestDecorator</h4><p><a id=has-request-decorator></a></p><p>Used to check for the existence of a Request decoration:</p><pre><code class=language-js>fastify.hasRequestDecorator(&#39;utility&#39;)
</code></pre><h4 id=hasreplydecorator>hasReplyDecorator</h4><p><a id=has-reply-decorator></a></p><p>Used to check for the existence of a Reply decoration:</p><pre><code class=language-js>fastify.hasReplyDecorator(&#39;utility&#39;)
</code></pre><h3 id=decorators-and-encapsulation>Decorators and Encapsulation</h3><p><a id=decorators-encapsulation></a></p><p>Defining a decorator (using <code>decorate</code>, <code>decorateRequest</code>, or <code>decorateReply</code>) with the same name more than once in the same <strong>encapsulated</strong> context will throw an exception.</p><p>As an example, the following will throw:</p><pre><code class=language-js>const server = require(&#39;fastify&#39;)()

server.decorateReply(&#39;view&#39;, function (template, args) {
  // Amazing view rendering engine
})

server.get(&#39;/&#39;, (req, reply) =&gt; {
  reply.view(&#39;/index.html&#39;, { hello: &#39;world&#39; })
})

// Somewhere else in our codebase, we define another
// view decorator. This throws.
server.decorateReply(&#39;view&#39;, function (template, args) {
  // Another rendering engine
})

server.listen({ port: 3000 })
</code></pre><p>But this will not:</p><pre><code class=language-js>const server = require(&#39;fastify&#39;)()

server.decorateReply(&#39;view&#39;, function (template, args) {
  // Amazing view rendering engine.
})

server.register(async function (server, opts) {
  // We add a view decorator to the current encapsulated
  // plugin. This will not throw as outside of this encapsulated
  // plugin view is the old one, while inside it is the new one.
  server.decorateReply(&#39;view&#39;, function (template, args) {
    // Another rendering engine
  })

  server.get(&#39;/&#39;, (req, reply) =&gt; {
    reply.view(&#39;/index.page&#39;, { hello: &#39;world&#39; })
  })
}, { prefix: &#39;/bar&#39; })

server.listen({ port: 3000 })
</code></pre><h3 id=getters-and-setters>Getters and Setters</h3><p><a id=getters-setters></a></p><p>Decorators accept special &quot;getter/setter&quot; objects. These objects have functions named <code>getter</code> and <code>setter</code> (though the <code>setter</code> function is optional). This allows defining properties via decorators, for example:</p><pre><code class=language-js>fastify.decorate(&#39;foo&#39;, {
  getter () {
    return &#39;a getter&#39;
  }
})
</code></pre><p>Will define the <code>foo</code> property on the Fastify instance:</p><pre><code class=language-js>console.log(fastify.foo) // &#39;a getter&#39;
</code></pre></div><hr><nav class=level></nav></div></div></div></section><script>// dynamically creates a submenu for the current section based on the content headers
  var titles = document.querySelectorAll('#doc-content h3, #doc-content h4')
  var currentMenu = document.getElementById('doc-menu-section')
  if (titles.length && currentMenu) {
    var submenu = document.createElement('ul')
    titles.forEach(el => {
      var currentSubmenuItem = document.createElement('li')
      var currentSubmenuLink = document.createElement('a')
      currentSubmenuLink.href = '#' + el.id
      currentSubmenuLink.title = el.textContent
      currentSubmenuLink.append(document.createTextNode(el.textContent))
      currentSubmenuItem.append(currentSubmenuLink)
      submenu.append(currentSubmenuItem)
    })
    currentMenu.append(submenu)
  }

  // dynamically creates header anchor links
  var headers = document.querySelectorAll('#doc-content h3, #doc-content h4')
  headers.forEach(el => {
    var currentAnchorLink = document.createElement('a')
    currentAnchorLink.className = 'anchor'
    currentAnchorLink.href = "#" + el.id
    currentAnchorLink.append(document.createTextNode('¶'))
    el.insertBefore(currentAnchorLink, el.firstChild);
  })</script><script>const contentLoaded = document.addEventListener('DOMContentLoaded', setTOCHeight)
  const resize = window.addEventListener('resize', setTOCHeight)

  function setTOCHeight() {
    const docHeight = window.innerHeight
    const tocSidebar = document.querySelector('#toc') || 0

    const tocHeight = docHeight - tocSidebar.getBoundingClientRect().top

    document.documentElement.style
      .setProperty('--TOC-height', `${tocHeight}px`)
  }

  window.addEventListener('beforeunload', () => {
    document.removeEventListener(contentLoaded)
    window.removeEventListener(resize)
  })</script></main><footer class="grey is-primary footer"><div class=container><div class="content has-text-centered"><p>Fastify, Copyright &copy; 2016-2023 <a href=https://openjsf.org/ target=_blank rel=noopener>OpenJS Foundation</a> and <a href=https://github.com/fastify/fastify#team target=_blank rel=noopener>The Fastify team</a>, Licensed under <a href=https://github.com/fastify/fastify/blob/master/LICENSE target=_blank rel=noopener>MIT</a></p><a href=https://www.netlify.com><img src=https://www.netlify.com/img/global/badges/netlify-color-accent.svg alt="Deploys by Netlify" loading=lazy decoding=async></a><p><small>Icons by simpleicons.org</small></p></div></div></footer><script src=/js/main.1e1d476db6c0b326.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js integrity="sha512-s+tOYYcC3Jybgr9mVsdAxsRYlGNq4mlAurOrfNuGMQ/SCofNPu92tjE7YRZCsdEtWL1yGkqk15fU/ark206YTg==" crossorigin=anonymous></script><script>hljs.highlightAll();</script><script src=https://cdn.jsdelivr.net/npm/@docsearch/js@alpha></script><script type=text/javascript>docsearch({
        appId: 'DMPMC33PLU',
        apiKey: '12d46b3bfeee6511031cfe00778f3e45',
        indexName: 'fastify',
        container: '#algolia-search-input',
        algoliaOptions: { 'facetFilters': ["version:latest", "tags:docs"] }
      });</script></body></html>