<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Server</title><meta name=description content="Fast and low overhead web framework, for Node.js"><link rel=apple-touch-icon sizes=57x57 href=/images/apple-icon-57x57.ed24c0a19503e080.png><link rel=apple-touch-icon sizes=60x60 href=/images/apple-icon-60x60.60c285c424d50738.png><link rel=apple-touch-icon sizes=72x72 href=/images/apple-icon-72x72.e49b27cfe1ab1461.png><link rel=apple-touch-icon sizes=76x76 href=/images/apple-icon-76x76.752f43fc91b8c1f7.png><link rel=apple-touch-icon sizes=114x114 href=/images/apple-icon-114x114.61739fa1d5a7059a.png><link rel=apple-touch-icon sizes=120x120 href=/images/apple-icon-120x120.7c25de37c5ce2ec1.png><link rel=apple-touch-icon sizes=144x144 href=/images/apple-icon-144x144.04d88fb27bd92cbe.png><link rel=apple-touch-icon sizes=152x152 href=/images/apple-icon-152x152.9364781175671626.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-icon-180x180.67579100928bfcd2.png><link rel=icon type=image/png sizes=192x192 href=/images/android-icon-192x192.37eb7f1ae3853740.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.1e22f0e774bc3cce.png><link rel=icon type=image/png sizes=96x96 href=/images/favicon-96x96.7e8a68b1b80c1799.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.e534ce05cb727f1a.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content=#ffffff><meta name=msapplication-TileImage content=/images/ms-icon-144x144.png><meta name=theme-color content=#ffffff><meta property=og:url content=https://www.fastify.io/docs/v2.2.x/Server><meta property=og:type content=website><meta property=og:title content=Server><meta property=og:description content="Fast and low overhead web framework, for Node.js"><meta property=og:image content=https://www.fastify.io/images/fastify-fb-share-image.07b6e6860853c758.png><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@fastifyjs><meta name=twitter:creator content=@fastifyjs><meta name=twitter:title content=Server><meta name=twitter:description content="Fast and low overhead web framework, for Node.js"><meta name=twitter:image content=https://www.fastify.io/images/fastify-twitter-share-image.cd9f217b360af3e2.png><link rel=stylesheet href=/css/style.f4d6592b3a91c5ef.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/default.min.css integrity="sha512-kZqGbhf9JTB4bVJ0G8HCkqmaPcRgo88F0dneK30yku5Y/dep7CZfCnNml2Je/sY4lBoqoksXz4PtVXS4GHSUzQ==" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@alpha><meta name=robots content="noindex, nofollow"></head><body><nav id=main-navbar class=navbar><div class=navbar-brand><a class=navbar-item href=/ ><img src=/images/fastify-logo-menu.d13f8da7a965c800.png alt="Fastify: Fast and low overhead web framework, for Node.js" height=28 decoding=async> </a><a class="navbar-item is-hidden-desktop" href=https://github.com/fastify/fastify target=_blank rel=noopener><span class=icon style="color: #333;"><i class="fa fa-github"></i></span></a><div class="navbar-burger burger" data-target=mobileMenu><span></span> <span></span> <span></span></div></div><div class=navbar-menu id=mobileMenu><div class=navbar-start><a class=navbar-item href=/ >Home</a> <a class=navbar-item href=/docs/latest>Docs</a> <a class=navbar-item href=/ecosystem>Ecosystem</a> <a class=navbar-item href=/benchmarks>Benchmarks</a> <a class=navbar-item href=/contribute>Contribute</a> <a class=navbar-item href=https://medium.com/@fastifyjs/ >Blog</a> <a class=navbar-item href=https://github.com/fastify/help>Help</a></div><div class=navbar-end><span id=algolia-search-input class="control has-icons-left navbar-item"></span> <a class=navbar-item href=https://github.com/fastify/fastify target=_blank rel=noopener><span class="fa fa-github"></span>&nbsp;GitHub </a><a class=navbar-item href=https://twitter.com/fastifyjs target=_blank rel=noopener><span class="fa fa-twitter"></span>&nbsp;Twitter </a><a class=navbar-item rel=me href=https://fosstodon.org/@fastify target=_blank><span class="fa fa-hashtag"></span>&nbsp;Mastodon</a></div></div></nav><main class=page-content aria-label=Content><section class="hero is-primary" style="background-image: url(/images/bg-pattern-dark.3f8cda863b3bbf52.png)"><div class=hero-body><div class=container><h1 class=title>Documentation (v2.2.0)</h1></div></div></section><section class=section><div class=container><div class=columns><div class="column is-3 is-hidden-mobile sticky-container"><aside class="menu sticky" id=toc><ul class=menu-list><li style="text-transform: capitalize"><a title=Benchmarking href=/docs/v2.2.x/Benchmarking>Benchmarking</a></li><li style="text-transform: capitalize"><a title=ContentTypeParser href=/docs/v2.2.x/ContentTypeParser>ContentTypeParser</a></li><li style="text-transform: capitalize"><a title=Decorators href=/docs/v2.2.x/Decorators>Decorators</a></li><li style="text-transform: capitalize"><a title=Ecosystem href=/docs/v2.2.x/Ecosystem>Ecosystem</a></li><li style="text-transform: capitalize"><a title=Errors href=/docs/v2.2.x/Errors>Errors</a></li><li style="text-transform: capitalize"><a title=Fluent-Schema href=/docs/v2.2.x/Fluent-Schema>Fluent-Schema</a></li><li style="text-transform: capitalize"><a title=Getting-Started href=/docs/v2.2.x/Getting-Started>Getting-Started</a></li><li style="text-transform: capitalize"><a title=HTTP2 href=/docs/v2.2.x/HTTP2>HTTP2</a></li><li style="text-transform: capitalize"><a title=Hooks href=/docs/v2.2.x/Hooks>Hooks</a></li><li style="text-transform: capitalize"><a title=LTS href=/docs/v2.2.x/LTS>LTS</a></li><li style="text-transform: capitalize"><a title=Lifecycle href=/docs/v2.2.x/Lifecycle>Lifecycle</a></li><li style="text-transform: capitalize"><a title=Logging href=/docs/v2.2.x/Logging>Logging</a></li><li style="text-transform: capitalize"><a title=Middlewares href=/docs/v2.2.x/Middlewares>Middlewares</a></li><li style="text-transform: capitalize"><a title=Plugins-Guide href=/docs/v2.2.x/Plugins-Guide>Plugins-Guide</a></li><li style="text-transform: capitalize"><a title=Plugins href=/docs/v2.2.x/Plugins>Plugins</a></li><li style="text-transform: capitalize"><a title=Reply href=/docs/v2.2.x/Reply>Reply</a></li><li style="text-transform: capitalize"><a title=Request href=/docs/v2.2.x/Request>Request</a></li><li style="text-transform: capitalize"><a title=Routes href=/docs/v2.2.x/Routes>Routes</a></li><li style="text-transform: capitalize" id=doc-menu-section><a title=Server class=is-active href=/docs/v2.2.x/Server>Server</a></li><li style="text-transform: capitalize"><a title=Testing href=/docs/v2.2.x/Testing>Testing</a></li><li style="text-transform: capitalize"><a title=TypeScript href=/docs/v2.2.x/TypeScript>TypeScript</a></li><li style="text-transform: capitalize"><a title=Validation-and-Serialization href=/docs/v2.2.x/Validation-and-Serialization>Validation-and-Serialization</a></li><li style="text-transform: capitalize"><a title=Write-Plugin href=/docs/v2.2.x/Write-Plugin>Write-Plugin</a></li></ul><div class=content style="margin: .8em; border-top: 1px solid #ccc; padding: .8em 0 0 0">Docs version<div class=field><div class=control><div class=select><select onchange="if (this.value) window.location.href=this.value"><option value=/docs/latest>latest</option><option value=/docs/master>master</option><option value=/docs/v4.12.x>v4.12.x</option><option value=/docs/v4.11.x>v4.11.x</option><option value=/docs/v4.10.x>v4.10.x</option><option value=/docs/v4.9.x>v4.9.x</option><option value=/docs/v4.8.x>v4.8.x</option><option value=/docs/v4.7.x>v4.7.x</option><option value=/docs/v4.6.x>v4.6.x</option><option value=/docs/v4.5.x>v4.5.x</option><option value=/docs/v4.4.x>v4.4.x</option><option value=/docs/v4.3.x>v4.3.x</option><option value=/docs/v4.2.x>v4.2.x</option><option value=/docs/v4.1.x>v4.1.x</option><option value=/docs/v4.0.x>v4.0.x</option><option value=/docs/v3.29.x>v3.29.x</option><option value=/docs/v3.28.x>v3.28.x</option><option value=/docs/v3.27.x>v3.27.x</option><option value=/docs/v3.26.x>v3.26.x</option><option value=/docs/v3.25.x>v3.25.x</option><option value=/docs/v3.24.x>v3.24.x</option><option value=/docs/v3.23.x>v3.23.x</option><option value=/docs/v3.22.x>v3.22.x</option><option value=/docs/v3.21.x>v3.21.x</option><option value=/docs/v3.20.x>v3.20.x</option><option value=/docs/v3.19.x>v3.19.x</option><option value=/docs/v3.18.x>v3.18.x</option><option value=/docs/v3.17.x>v3.17.x</option><option value=/docs/v3.16.x>v3.16.x</option><option value=/docs/v3.15.x>v3.15.x</option><option value=/docs/v3.14.x>v3.14.x</option><option value=/docs/v3.13.x>v3.13.x</option><option value=/docs/v3.12.x>v3.12.x</option><option value=/docs/v3.11.x>v3.11.x</option><option value=/docs/v3.10.x>v3.10.x</option><option value=/docs/v3.9.x>v3.9.x</option><option value=/docs/v3.8.x>v3.8.x</option><option value=/docs/v3.7.x>v3.7.x</option><option value=/docs/v3.6.x>v3.6.x</option><option value=/docs/v3.5.x>v3.5.x</option><option value=/docs/v3.4.x>v3.4.x</option><option value=/docs/v3.3.x>v3.3.x</option><option value=/docs/v3.2.x>v3.2.x</option><option value=/docs/v3.1.x>v3.1.x</option><option value=/docs/v3.0.x>v3.0.x</option><option value=/docs/v2.15.x>v2.15.x</option><option value=/docs/v2.14.x>v2.14.x</option><option value=/docs/v2.13.x>v2.13.x</option><option value=/docs/v2.12.x>v2.12.x</option><option value=/docs/v2.11.x>v2.11.x</option><option value=/docs/v2.10.x>v2.10.x</option><option value=/docs/v2.9.x>v2.9.x</option><option value=/docs/v2.8.x>v2.8.x</option><option value=/docs/v2.7.x>v2.7.x</option><option value=/docs/v2.6.x>v2.6.x</option><option value=/docs/v2.5.x>v2.5.x</option><option value=/docs/v2.4.x>v2.4.x</option><option value=/docs/v2.3.x>v2.3.x</option><option selected value=/docs/v2.2.x>v2.2.x</option><option value=/docs/v2.1.x>v2.1.x</option><option value=/docs/v2.0.x>v2.0.x</option><option value=/docs/v1.14.x>v1.14.x</option><option value=/docs/v1.13.x>v1.13.x</option></select></div></div></div></div></aside></div><div class="column is-9"><nav class=breadcrumb><ul><li><a href=/ style="padding-left: 0">Fastify</a></li><li><a href=/docs/v2.2.x>Documentation</a></li><li><div class=field><div class=control><div class=select><select onchange="if (this.value) window.location.href=this.value" style="border: none;"><option value=/docs/latest>latest</option><option value=/docs/master>master</option><option value=/docs/v4.12.x>v4.12.x</option><option value=/docs/v4.11.x>v4.11.x</option><option value=/docs/v4.10.x>v4.10.x</option><option value=/docs/v4.9.x>v4.9.x</option><option value=/docs/v4.8.x>v4.8.x</option><option value=/docs/v4.7.x>v4.7.x</option><option value=/docs/v4.6.x>v4.6.x</option><option value=/docs/v4.5.x>v4.5.x</option><option value=/docs/v4.4.x>v4.4.x</option><option value=/docs/v4.3.x>v4.3.x</option><option value=/docs/v4.2.x>v4.2.x</option><option value=/docs/v4.1.x>v4.1.x</option><option value=/docs/v4.0.x>v4.0.x</option><option value=/docs/v3.29.x>v3.29.x</option><option value=/docs/v3.28.x>v3.28.x</option><option value=/docs/v3.27.x>v3.27.x</option><option value=/docs/v3.26.x>v3.26.x</option><option value=/docs/v3.25.x>v3.25.x</option><option value=/docs/v3.24.x>v3.24.x</option><option value=/docs/v3.23.x>v3.23.x</option><option value=/docs/v3.22.x>v3.22.x</option><option value=/docs/v3.21.x>v3.21.x</option><option value=/docs/v3.20.x>v3.20.x</option><option value=/docs/v3.19.x>v3.19.x</option><option value=/docs/v3.18.x>v3.18.x</option><option value=/docs/v3.17.x>v3.17.x</option><option value=/docs/v3.16.x>v3.16.x</option><option value=/docs/v3.15.x>v3.15.x</option><option value=/docs/v3.14.x>v3.14.x</option><option value=/docs/v3.13.x>v3.13.x</option><option value=/docs/v3.12.x>v3.12.x</option><option value=/docs/v3.11.x>v3.11.x</option><option value=/docs/v3.10.x>v3.10.x</option><option value=/docs/v3.9.x>v3.9.x</option><option value=/docs/v3.8.x>v3.8.x</option><option value=/docs/v3.7.x>v3.7.x</option><option value=/docs/v3.6.x>v3.6.x</option><option value=/docs/v3.5.x>v3.5.x</option><option value=/docs/v3.4.x>v3.4.x</option><option value=/docs/v3.3.x>v3.3.x</option><option value=/docs/v3.2.x>v3.2.x</option><option value=/docs/v3.1.x>v3.1.x</option><option value=/docs/v3.0.x>v3.0.x</option><option value=/docs/v2.15.x>v2.15.x</option><option value=/docs/v2.14.x>v2.14.x</option><option value=/docs/v2.13.x>v2.13.x</option><option value=/docs/v2.12.x>v2.12.x</option><option value=/docs/v2.11.x>v2.11.x</option><option value=/docs/v2.10.x>v2.10.x</option><option value=/docs/v2.9.x>v2.9.x</option><option value=/docs/v2.8.x>v2.8.x</option><option value=/docs/v2.7.x>v2.7.x</option><option value=/docs/v2.6.x>v2.6.x</option><option value=/docs/v2.5.x>v2.5.x</option><option value=/docs/v2.4.x>v2.4.x</option><option value=/docs/v2.3.x>v2.3.x</option><option selected value=/docs/v2.2.x>v2.2.x</option><option value=/docs/v2.1.x>v2.1.x</option><option value=/docs/v2.0.x>v2.0.x</option><option value=/docs/v1.14.x>v1.14.x</option><option value=/docs/v1.13.x>v1.13.x</option></select></div></div></div></li><div class=field><div class=control><div class=select><select onchange="if (this.value) window.location.href=this.value" style="border: none;"><option value=/docs/v2.2.x>Documentation</option><option value=/docs/v2.2.x/Benchmarking>Benchmarking</option><option value=/docs/v2.2.x/ContentTypeParser>ContentTypeParser</option><option value=/docs/v2.2.x/Decorators>Decorators</option><option value=/docs/v2.2.x/Ecosystem>Ecosystem</option><option value=/docs/v2.2.x/Errors>Errors</option><option value=/docs/v2.2.x/Fluent-Schema>Fluent-Schema</option><option value=/docs/v2.2.x/Getting-Started>Getting-Started</option><option value=/docs/v2.2.x/HTTP2>HTTP2</option><option value=/docs/v2.2.x/Hooks>Hooks</option><option value=/docs/v2.2.x/LTS>LTS</option><option value=/docs/v2.2.x/Lifecycle>Lifecycle</option><option value=/docs/v2.2.x/Logging>Logging</option><option value=/docs/v2.2.x/Middlewares>Middlewares</option><option value=/docs/v2.2.x/Plugins-Guide>Plugins-Guide</option><option value=/docs/v2.2.x/Plugins>Plugins</option><option value=/docs/v2.2.x/Reply>Reply</option><option value=/docs/v2.2.x/Request>Request</option><option value=/docs/v2.2.x/Routes>Routes</option><option selected value=/docs/v2.2.x/Server>Server</option><option value=/docs/v2.2.x/Testing>Testing</option><option value=/docs/v2.2.x/TypeScript>TypeScript</option><option value=/docs/v2.2.x/Validation-and-Serialization>Validation-and-Serialization</option><option value=/docs/v2.2.x/Write-Plugin>Write-Plugin</option></select></div></div></div></ul></nav><div id=doc-content class=content><p><a name=factory></a></p><h2 id=factory>Factory</h2><p>The Fastify module exports a factory function that is used to create new <a href=/docs/v2.2.x/Server><code><b>Fastify server</b></code></a> instances. This factory function accepts an options object which is used to customize the resulting instance. This document describes the properties available in that options object.</p><p><a name=factory-http2></a></p><h3 id=http2><code>http2</code></h3><p>If <code>true</code> Node.js core&#39;s <a href=https://nodejs.org/dist/latest-v8.x/docs/api/http2.html>HTTP/2</a> module is used for binding the socket.</p><ul><li>Default: <code>false</code></li></ul><p><a name=factory-https></a></p><h3 id=https><code>https</code></h3><p>An object used to configure the server&#39;s listening socket for TLS. The options are the same as the Node.js core <a href=https://nodejs.org/dist/latest-v8.x/docs/api/https.html#https_https_createserver_options_requestlistener><code>createServer</code> method</a>. When this property is <code>null</code>, the socket will not be configured for TLS.</p><p>This option also applies when the <a href=/docs/v2.2.x/Server#factory-http2><code><b>http2</b></code> </a>option is set.</p><ul><li>Default: <code>null</code></li></ul><p><a name=factory-ignore-slash></a></p><h3 id=ignoretrailingslash><code>ignoreTrailingSlash</code></h3><p>Fastify uses <a href=https://github.com/delvedor/find-my-way>find-my-way</a> to handle routing. This option may be set to <code>true</code> to ignore trailing slashes in routes. This option applies to <em>all</em> route registrations for the resulting server instance.</p><ul><li>Default: <code>false</code></li></ul><pre><code class=language-js>const fastify = require(&#39;fastify&#39;)({
  ignoreTrailingSlash: true
})

// registers both &quot;/foo&quot; and &quot;/foo/&quot;
fastify.get(&#39;/foo/&#39;, function (req, reply) {
  res.send(&#39;foo&#39;)
})

// registers both &quot;/bar&quot; and &quot;/bar/&quot;
fastify.get(&#39;/bar&#39;, function (req, reply) {
  res.send(&#39;bar&#39;)
})
</code></pre><p><a name=factory-max-param-length></a></p><h3 id=maxparamlength><code>maxParamLength</code></h3><p>You can set a custom length for parameters in parametric (standard, regex and multi) routes by using <code>maxParamLength</code> option, the default value is 100 characters.<br>This can be useful especially if you have some regex based route, protecting you against <a href=https://www.owasp.org/index.php/Regular_expression_Denial_of_Service_-_ReDoS>DoS attacks</a>.<br><em>If the maximum length limit is reached, the not found route will be invoked.</em></p><p><a name=factory-body-limit></a></p><h3 id=bodylimit><code>bodyLimit</code></h3><p>Defines the maximum payload, in bytes, the server is allowed to accept.</p><ul><li>Default: <code>1048576</code> (1MiB)</li></ul><p><a name=factory-on-proto-poisoning></a></p><h3 id=onprotopoisoning><code>onProtoPoisoning</code></h3><p>Defines what action the framework must take when parsing a JSON object with <code>__proto__</code>. This functionality is provided by <a href=https://github.com/hapijs/bourne>bourne</a>. See <a href=https://hueniverse.com/a-tale-of-prototype-poisoning-2610fa170061>https://hueniverse.com/a-tale-of-prototype-poisoning-2610fa170061</a> for more details about prototype poisoning attacks.</p><p>Possible values are <code>&#39;error&#39;</code>, <code>&#39;remove&#39;</code> and <code>&#39;ignore&#39;</code>.</p><ul><li>Default: <code>&#39;error&#39;</code></li></ul><p><a name=factory-logger></a></p><h3 id=logger><code>logger</code></h3><p>Fastify includes built-in logging via the <a href=https://getpino.io/ >Pino</a> logger. This property is used to configure the internal logger instance.</p><p>The possible values this property may have are:</p><ul><li><p>Default: <code>false</code>. The logger is disabled. All logging methods will point to a null logger <a href=https://npm.im/abstract-logging>abstract-logging</a> instance.</p></li><li><p><code>pinoInstance</code>: a previously instantiated instance of Pino. The internal logger will point to this instance.</p></li><li><p><code>object</code>: a standard Pino <a href=https://github.com/pinojs/pino/blob/c77d8ec5ce/docs/API.md#constructor>options object</a>. This will be passed directly to the Pino constructor. If the following properties are not present on the object, they will be added accordingly:</p><ul><li><code>genReqId</code>: a synchronous function that will be used to generate identifiers for incoming requests. The default function generates sequential identifiers.</li><li><code>level</code>: the minimum logging level. If not set, it will be set to <code>&#39;info&#39;</code>.</li><li><code>serializers</code>: a hash of serialization functions. By default, serializers are added for <code>req</code> (incoming request objects), <code>res</code> (outgoing repsonse objets), and <code>err</code> (standard <code>Error</code> objects). When a log method receives an object with any of these properties then the respective serializer will be used for that property. For example:<pre><code class=language-js>fastify.get(&#39;/foo&#39;, function (req, res) {
  req.log.info({req}) // log the serialized request object
  res.send(&#39;foo&#39;)
})
</code></pre>Any user supplied serializer will override the default serializer of the corresponding property.</li></ul></li></ul><p><a name=custom-http-server></a></p><h3 id=serverfactory><code>serverFactory</code></h3><p>You can pass a custom http server to Fastify by using the <code>serverFactory</code> option.<br><code>serverFactory</code> is a function that takes an <code>handler</code> parameter, which takes the <code>request</code> and <code>response</code> objects as parameters, and an options object, which is the same you have passed to Fastify.</p><pre><code class=language-js>const serverFactory = (handler, opts) =&gt; {
  const server = http.createServer((req, res) =&gt; {
    handler(req, res)
  })

  return server
}

const fastify = Fastify({ serverFactory, modifyCoreObjects: false })

fastify.get(&#39;/&#39;, (req, reply) =&gt; {
  reply.send({ hello: &#39;world&#39; })
})

fastify.listen(3000)
</code></pre><p>Internally Fastify uses the API of Node core http server, so if you are using a custom server you must be sure to have the same API exposed. If not, you can enhance the server instance inside the <code>serverFactory</code> function before the <code>return</code> statement.<br><em>Note that we have also added <code>modifyCoreObjects: false</code> because in some serverless environments such as Google Cloud Functions, some Node.js core properties are not writable.</em></p><p><a name=factory-case-sensitive></a></p><h3 id=casesensitive><code>caseSensitive</code></h3><p>By default, value equal to <code>true</code>, routes are registered as case sensitive. That is, <code>/foo</code> is not equivalent to <code>/Foo</code>. When set to <code>false</code>, routes are registered in a fashion such that <code>/foo</code> is equivalent to <code>/Foo</code> which is equivalent to <code>/FOO</code>.</p><p>By setting <code>caseSensitive</code> to <code>false</code>, all paths will be matched as lowercase, but the route parameters or wildcards will maintain their original letter casing.</p><pre><code class=language-js>fastify.get(&#39;/user/:username&#39;, (request, reply) =&gt; {
  // Given the URL: /USER/NodeJS
  console.log(request.params.username) // -&gt; &#39;NodeJS&#39;
})
</code></pre><p>Please note this setting this option to <code>false</code> goes against <a href=https://tools.ietf.org/html/rfc3986#section-6.2.2.1>RFC3986</a>.</p><p><a name=factory-request-id-header></a></p><h3 id=requestidheader><code>requestIdHeader</code></h3><p>The header name used to know the request id. See <a href=/docs/v2.2.x/Logging.md#logging-request-id>the request id</a> section.</p><ul><li>Default: <code>&#39;request-id&#39;</code></li></ul><p><a name=factory-gen-request-id></a></p><h3 id=genreqid><code>genReqId</code></h3><p>Function for generating the request id. It will receive the incoming request as a parameter.</p><ul><li>Default: <code>value of &#39;request-id&#39; if provided or monotonically increasing integers</code></li></ul><p>Especially in distributed systems, you may want to override the default id generation behaviour as shown below. For generating <code>UUID</code>s you may want to checkout <a href=https://github.com/mcollina/hyperid>hyperid</a></p><pre><code class=language-js>let i = 0
const fastify = require(&#39;fastify&#39;)({
  genReqId: function (req) { return req.headers[&#39;request-id&#39;] || i++ }
})
</code></pre><p><strong>Note: genReqId will be called even when the &#39;request-id&#39; header is supplied. It is possible to default to that value if provided before generating a new value, as per the example above.</strong></p><p><a name=factory-trust-proxy></a></p><h3 id=trustproxy><code>trustProxy</code></h3><p>By enabling the <code>trustProxy</code> option, Fastify will have knowledge that it&#39;s sitting behind a proxy and that the <code>X-Forwarded-*</code> header fields may be trusted, which otherwise may be easily spoofed.</p><pre><code class=language-js>const fastify = Fastify({ trustProxy: true })
</code></pre><ul><li>Default: <code>false</code></li><li><code>true/false</code>: Trust all proxies (<code>true</code>) or do not trust any proxies (<code>false</code>).</li><li><code>string</code>: Trust only given IP/CIDR (e.g. <code>&#39;127.0.0.1&#39;</code>). May be a list of comma separated values (e.g. <code>&#39;127.0.0.1,192.168.1.1/24&#39;</code>).</li><li><code>Array&lt;string&gt;</code>: Trust only given IP/CIDR list (e.g. <code>[&#39;127.0.0.1&#39;]</code>).</li><li><code>number</code>: Trust the nth hop from the front-facing proxy server as the client.</li><li><code>Function</code>: Custom trust function that takes <code>address</code> as first arg<pre><code class=language-js>function myTrustFn(address, hop) {
  return address === &#39;1.2.3.4&#39; || hop === 1
}
</code></pre></li></ul><p>For more examples refer to <a href=https://www.npmjs.com/package/proxy-addr>proxy-addr</a> package.</p><p>You may access the <code>ip</code>, <code>ips</code>, and <code>hostname</code> values on the <a href=/docs/v2.2.x/v2.2.x/Request><code>request</code></a> object.</p><pre><code class=language-js>fastify.get(&#39;/&#39;, (request, reply) =&gt; {
  console.log(request.ip)
  console.log(request.ips)
  console.log(request.hostname)
})
</code></pre><p><a name=plugin-timeout></a></p><h3 id=plugintimeout><code>pluginTimeout</code></h3><p>The maximum amount of time in <em>milliseconds</em> in which a plugin can load. If not, <a href=/docs/v2.2.x/Server.md#ready><code>ready</code></a> will complete with an <code>Error</code> with code <code>&#39;ERR_AVVIO_PLUGIN_TIMEOUT&#39;</code>.</p><ul><li>Default: <code>10000</code></li></ul><p><a name=factory-querystring-parser></a></p><h3 id=querystringparser><code>querystringParser</code></h3><p>The default query string parser that Fastify uses is the Node.js&#39;s core <code>querystring</code> module.<br>You can change this default setting by passing the option <code>querystringParser</code> and use a custom one, such as <a href=https://www.npmjs.com/package/qs><code>qs</code></a>.</p><pre><code class=language-js>const qs = require(&#39;qs&#39;)
const fastify = require(&#39;fastify&#39;)({
  querystringParser: str =&gt; qs.parse(str)
})
</code></pre><p><a name=versioning></a></p><h3 id=versioning><code>versioning</code></h3><p>By default you can version your routes with <a href=/docs/v2.2.x/Routes.md#version>semver versioning</a>, which is provided by <code>find-my-way</code>. There is still an option to provide custom versioning strategy. You can find more information in the <a href=https://github.com/delvedor/find-my-way#versioned-routes>find-my-way</a> documentation.</p><pre><code class=language-js>const versioning = {
  storage: function () {
    let versions = {}
    return {
      get: (version) =&gt; { return versions[version] || null },
      set: (version, store) =&gt; { versions[version] = store },
      del: (version) =&gt; { delete versions[version] },
      empty: () =&gt; { versions = {} }
    }
  },
  deriveVersion: (req, ctx) =&gt; {
    return req.headers[&#39;accept&#39;]
  }
}

const fastify = require(&#39;fastify&#39;)({
  versioning
})
</code></pre><p><a name=factory-modify-core-objects></a></p><h3 id=modifycoreobjects><code>modifyCoreObjects</code></h3><ul><li>Default: <code>true</code></li></ul><p>By default, Fastify will add the <code>ip</code>, <code>ips</code>, <code>hostname</code>, and <code>log</code> properties to Node&#39;s raw request object (see <a href=/docs/v2.2.x/v2.2.x/Request><code>Request</code></a>) and the <code>log</code> property to Node&#39;s raw response object. Set to <code>false</code> to prevent these properties from being added to the Node core objects.</p><pre><code class=language-js>const fastify = Fastify({ modifyCoreObjects: true }) // the default

fastify.get(&#39;/&#39;, (request, reply) =&gt; {
  console.log(request.raw.ip)
  console.log(request.raw.ips)
  console.log(request.raw.hostname)
  request.raw.log(&#39;Hello&#39;)
  reply.res.log(&#39;World&#39;)
})
</code></pre><p>Disable this option could help in serverless environments such as Google Cloud Functions, where <code>ip</code> and <code>ips</code> are not writable properties.</p><p><strong>Note that these properties are deprecated and will be removed in the next major version of Fastify along with this option.</strong> It is recommended to use the same properties on Fastify&#39;s <a href=/docs/v2.2.x/v2.2.x/Request><code>Request</code></a> and <a href=/docs/v2.2.x/v2.2.x/Reply><code>Reply</code></a> objects instead.</p><pre><code class=language-js>const fastify = Fastify({ modifyCoreObjects: false })

fastify.get(&#39;/&#39;, (request, reply) =&gt; {
  console.log(request.ip)
  console.log(request.ips)
  console.log(request.hostname)
  request.log(&#39;Hello&#39;)
  reply.log(&#39;World&#39;)
})
</code></pre><h2 id=instance>Instance</h2><h3 id=server-methods>Server Methods</h3><p><a name=server></a></p><h4 id=server>server</h4><p><code>fastify.server</code>: The Node core <a href=https://nodejs.org/api/http.html#http_class_http_server>server</a> object as returned by the <a href=/docs/v2.2.x/v2.2.x/Server><strong><code>Fastify factory function</code></strong></a>.</p><p><a name=after></a></p><h4 id=after>after</h4><p>Invoked when the current plugin and all the plugins that have been registered within it have finished loading. It is always executed before the method <code>fastify.ready</code>.</p><pre><code class=language-js>fastify
  .register((instance, opts, next) =&gt; {
    console.log(&#39;Current plugin&#39;)
    next()
  })
  .after(err =&gt; {
    console.log(&#39;After current plugin&#39;)
  })
  .register((instance, opts, next) =&gt; {
    console.log(&#39;Next plugin&#39;)
    next()
  })
  .ready(err =&gt; {
    console.log(&#39;Everything has been loaded&#39;)
  })
</code></pre><p><a name=ready></a></p><h4 id=ready>ready</h4><p>Function called when all the plugins have been loaded. It takes an error parameter if something went wrong.</p><pre><code class=language-js>fastify.ready(err =&gt; {
  if (err) throw err
})
</code></pre><p>If it is called without any arguments, it will return a <code>Promise</code>:</p><pre><code class=language-js>fastify.ready().then(() =&gt; {
  console.log(&#39;successfully booted!&#39;)
}, (err) =&gt; {
  console.log(&#39;an error happened&#39;, err)
})
</code></pre><p><a name=listen></a></p><h4 id=listen>listen</h4><p>Starts the server on the given port after all the plugins are loaded, internally waits for the <code>.ready()</code> event. The callback is the same as the Node core. By default, the server will listen on the address resolved by <code>localhost</code> when no specific address is provided (<code>127.0.0.1</code> or <code>::1</code> depending on the operating system). If listening on any available interface is desired, then specifying <code>0.0.0.0</code> for the address will listen on all IPv4 address. Using <code>::</code> for the address will listen on all IPv6 addresses, and, depending on OS, may also listen on all IPv4 addresses. Be careful when deciding to listen on all interfaces; it comes with inherent <a href=https://web.archive.org/web/20170831174611/https://snyk.io/blog/mongodb-hack-and-secure-defaults/ >security risks</a>.</p><pre><code class=language-js>fastify.listen(3000, (err, address) =&gt; {
  if (err) {
    fastify.log.error(err)
    process.exit(1)
  }
})
</code></pre><p>Specifying an address is also supported:</p><pre><code class=language-js>fastify.listen(3000, &#39;127.0.0.1&#39;, (err, address) =&gt; {
  if (err) {
    fastify.log.error(err)
    process.exit(1)
  }
})
</code></pre><p>Specifying a backlog queue size is also supported:</p><pre><code class=language-js>fastify.listen(3000, &#39;127.0.0.1&#39;, 511, (err, address) =&gt; {
  if (err) {
    fastify.log.error(err)
    process.exit(1)
  }
})
</code></pre><p>Specifying options is also supported, the object is same as <a href=https://nodejs.org/api/net.html#net_server_listen_options_callback>options</a> in the Node.js server listen:</p><pre><code class=language-js>fastify.listen({ port: 3000, host: &#39;127.0.0.1&#39;, backlog: 511 }, (err) =&gt; {
  if (err) {
    fastify.log.error(err)
    process.exit(1)
  }
})
</code></pre><p>If no callback is provided a Promise is returned:</p><pre><code class=language-js>fastify.listen(3000)
  .then((address) =&gt; console.log(`server listening on ${address}`))
  .catch(err =&gt; {
    console.log(&#39;Error starting server:&#39;, err)
    process.exit(1)
  })
</code></pre><p>Specifying an address without a callback is also supported:</p><pre><code class=language-js>fastify.listen(3000, &#39;127.0.0.1&#39;)
  .then((address) =&gt; console.log(`server listening on ${address}`))
  .catch(err =&gt; {
    console.log(&#39;Error starting server:&#39;, err)
    process.exit(1)
  })
</code></pre><p>Specifying options without a callback is also supported:</p><pre><code class=language-js>fastify.listen({ port: 3000, host: &#39;127.0.0.1&#39;, backlog: 511 })
  .then((address) =&gt; console.log(`server listening on ${address}`))
  .catch(err =&gt; {
    console.log(&#39;Error starting server:&#39;, err)
    process.exit(1)
  })
</code></pre><p>When deploying to a Docker, and potentially other, containers, it is advisable to listen on <code>0.0.0.0</code> because they do not default to exposing mapped ports to <code>localhost</code>:</p><pre><code class=language-js>fastify.listen(3000, &#39;0.0.0.0&#39;, (err, address) =&gt; {
  if (err) {
    fastify.log.error(err)
    process.exit(1)
  }
})
</code></pre><p>If the <code>port</code> is omitted (or is set to zero), a random available port is automatically chosen (later available via <code>fastify.server.address().port</code>).</p><p>The default options of listen are:</p><pre><code class=language-js>fastify.listen({
  port: 0,
  host: &#39;localhost&#39;,
  exclusive: false,
  readableAll: false,
  writableAll: false,
  ipv6Only: false
}, (err) =&gt; {})
</code></pre><p><a name=route></a></p><h4 id=route>route</h4><p>Method to add routes to the server, it also has shorthand functions, check <a href=/docs/v2.2.x/v2.2.x/Routes>here</a>.</p><p><a name=close></a></p><h4 id=close>close</h4><p><code>fastify.close(callback)</code>: call this function to close the server instance and run the <a href=/docs/v2.2.x/Hooks.md#on-close><code>&#39;onClose&#39;</code></a> hook.<br>Calling <code>close</code> will also cause the server to respond to every new incoming request with a <code>503</code> error and destroy that request.</p><p><a name=decorate></a></p><h4 id=decorate>decorate*</h4><p>Function useful if you need to decorate the fastify instance, Reply or Request, check <a href=/docs/v2.2.x/v2.2.x/Decorators>here</a>.</p><p><a name=register></a></p><h4 id=register>register</h4><p>Fastify allows the user to extend its functionality with plugins. A plugin can be a set of routes, a server decorator or whatever, check <a href=/docs/v2.2.x/v2.2.x/Plugins>here</a>.</p><p><a name=use></a></p><h4 id=use>use</h4><p>Function to add middlewares to Fastify, check <a href=/docs/v2.2.x/v2.2.x/Middlewares>here</a>.</p><p><a name=addHook></a></p><h4 id=addhook>addHook</h4><p>Function to add a specific hook in the lifecycle of Fastify, check <a href=/docs/v2.2.x/v2.2.x/Hooks>here</a>.</p><p><a name=prefix></a></p><h4 id=prefix>prefix</h4><p>The full path that will be prefixed to a route.</p><p>Example:</p><pre><code class=language-js>fastify.register(function (instance, opts, next) {
  instance.get(&#39;/foo&#39;, function (request, reply) {
    // Will log &quot;prefix: /v1&quot;
    request.log.info(&#39;prefix: %s&#39;, instance.prefix)
    reply.send({ prefix: instance.prefix })
  })

  instance.register(function (instance, opts, next) {
    instance.get(&#39;/bar&#39;, function (request, reply) {
      // Will log &quot;prefix: /v1/v2&quot;
      request.log.info(&#39;prefix: %s&#39;, instance.prefix)
      reply.send({ prefix: instance.prefix })
    })

    next()
  }, { prefix: &#39;/v2&#39; })

  next()
}, { prefix: &#39;/v1&#39; })
</code></pre><p><a name=log></a></p><h4 id=log>log</h4><p>The logger instance, check <a href=/docs/v2.2.x/v2.2.x/Logging>here</a>.</p><p><a name=inject></a></p><h4 id=inject>inject</h4><p>Fake http injection (for testing purposes) <a href=/docs/v2.2.x/Testing.md#inject>here</a>.</p><p><a name=add-schema></a></p><h4 id=addschema>addSchema</h4><p><code>fastify.addSchema(schemaObj)</code>, adds a shared schema to the Fastify instance. This allows you to reuse it everywhere in your application just by writing the schema id that you need.<br>To learn more, see <a href=/docs/v2.2.x/Validation-and-Serialization.md#shared-schema>shared schema example</a> in the <a href=/docs/v2.2.x/v2.2.x/Validation-and-Serialization>Validation and Serialization</a> documentation.</p><p><a name=set-schema-compiler></a></p><h4 id=setschemacompiler>setSchemaCompiler</h4><p>Set the schema compiler for all routes <a href=/docs/v2.2.x/Validation-and-Serialization.md#schema-compiler>here</a>.</p><p><a name=schema-compiler></a></p><h4 id=schemacompiler>schemaCompiler</h4><p>This property can be used to set the schema compiler, it is a shortcut for the <code>setSchemaCompiler</code> method, and get the schema compiler back for all routes.</p><p><a name=set-not-found-handler></a></p><h4 id=setnotfoundhandler>setNotFoundHandler</h4><p><code>fastify.setNotFoundHandler(handler(request, reply))</code>: set the 404 handler. This call is encapsulated by prefix, so different plugins can set different not found handlers if a different <a href=/docs/v2.2.x/Plugins.md#route-prefixing-option><code>prefix</code> option</a> is passed to <code>fastify.register()</code>. The handler is treated like a regular route handler so requests will go through the full <a href=/docs/v2.2.x/Lifecycle.md#lifecycle>Fastify lifecycle</a>.</p><p>You can also register a <a href=https://www.fastify.io/docs/latest/Hooks/#route-hooks><code>preValidation</code></a> and <a href=https://www.fastify.io/docs/latest/Hooks/#route-hooks>preHandler</a> hook for the 404 handler.</p><pre><code class=language-js>fastify.setNotFoundHandler({
  preValidation: (req, reply, next) =&gt; {
    // your code
    next()
  },
  preHandler: (req, reply, next) =&gt; {
    // your code
    next()
  }
}, function (request, reply) {
    // Default not found handler with preValidation and preHandler hooks
})

fastify.register(function (instance, options, next) {
  instance.setNotFoundHandler(function (request, reply) {
    // Handle not found request without preValidation and preHandler hooks
    // to URLs that begin with &#39;/v1&#39;
  })
  next()
}, { prefix: &#39;/v1&#39; })
</code></pre><p><a name=set-error-handler></a></p><h4 id=seterrorhandler>setErrorHandler</h4><p><code>fastify.setErrorHandler(handler(error, request, reply))</code>: Set a function that will be called whenever an error happens. The handler is fully encapsulated, so different plugins can set different error handlers. <em>async-await</em> is supported as well.<br><em>Note: If the error <code>statusCode</code> is less than 400, Fastify will automatically set it at 500 before calling the error handler.</em></p><pre><code class=language-js>fastify.setErrorHandler(function (error, request, reply) {
  // Log error
  // Send error response
})
</code></pre><p>Fastify is provided with a default function that is called if no error handler is set and that logs the error with respect to its <code>statusCode</code>:</p><pre><code class=language-js>var statusCode = error.statusCode
if (statusCode &gt;= 500) {
  log.error(error)
} else if (statusCode &gt;= 400) {
  log.info(error)
} else {
  log.error(error)
}
</code></pre><p><a name=print-routes></a></p><h4 id=printroutes>printRoutes</h4><p><code>fastify.printRoutes()</code>: Prints the representation of the internal radix tree used by the router, useful for debugging.<br><em>Remember to call it inside or after a <code>ready</code> call.</em></p><pre><code class=language-js>fastify.get(&#39;/test&#39;, () =&gt; {})
fastify.get(&#39;/test/hello&#39;, () =&gt; {})
fastify.get(&#39;/hello/world&#39;, () =&gt; {})

fastify.ready(() =&gt; {
  console.log(fastify.printRoutes())
  // └── /
  //   ├── test (GET)
  //   │   └── /hello (GET)
  //   └── hello/world (GET)
})
</code></pre><p><a name=initial-config></a></p><h4 id=initialconfig>initialConfig</h4><p><code>fastify.initialConfig</code>: Exposes a frozen read-only object registering the initial options passed down by the user to the fastify instance.</p><p>Currently the properties that can be exposed are:</p><ul><li>bodyLimit</li><li>caseSensitive</li><li>http2</li><li>https (it will return <code>false</code>/<code>true</code> or <code>{ allowHTTP1: true/false }</code> if explicitly passed)</li><li>ignoreTrailingSlash</li><li>maxParamLength</li><li>onProtoPoisoning</li><li>pluginTimeout</li><li>requestIdHeader</li></ul><pre><code class=language-js>const { readFileSync } = require(&#39;fs&#39;)
const Fastify = require(&#39;fastify&#39;)

const fastify = Fastify({
  https: {
    allowHTTP1: true,
    key: readFileSync(&#39;./fastify.key&#39;),
    cert: readFileSync(&#39;./fastify.cert&#39;)
  },
  logger: { level: &#39;trace&#39;},
  ignoreTrailingSlash: true,
  maxParamLength: 200,
  caseSensitive: true,
  trustProxy: &#39;127.0.0.1,192.168.1.1/24&#39;,
})

console.log(fastify.initialConfig)
/*
will log :
{
  caseSensitive: true,
  https: { allowHTTP1: true },
  ignoreTrailingSlash: true,
  maxParamLength: 200
}
*/

fastify.register(async (instance, opts) =&gt; {
  instance.get(&#39;/&#39;, async (request, reply) =&gt; {
    return instance.initialConfig
    /*
    will return :
    {
      caseSensitive: true,
      https: { allowHTTP1: true },
      ignoreTrailingSlash: true,
      maxParamLength: 200
    }
    */
  })

  instance.get(&#39;/error&#39;, async (request, reply) =&gt; {
    // will throw an error because initialConfig is read-only
    // and can not be modified
    instance.initialConfig.https.allowHTTP1 = false

    return instance.initialConfig
  })
})

// Start listening.
fastify.listen(3000, (err) =&gt; {
  if (err) {
    fastify.log.error(err)
    process.exit(1)
  }
})
</code></pre></div><hr><nav class=level></nav></div></div></div></section><script>// dynamically creates a submenu for the current section based on the content headers
  var titles = document.querySelectorAll('#doc-content h3, #doc-content h4')
  var currentMenu = document.getElementById('doc-menu-section')
  if (titles.length && currentMenu) {
    var submenu = document.createElement('ul')
    titles.forEach(el => {
      var currentSubmenuItem = document.createElement('li')
      var currentSubmenuLink = document.createElement('a')
      currentSubmenuLink.href = '#' + el.id
      currentSubmenuLink.title = el.textContent
      currentSubmenuLink.append(document.createTextNode(el.textContent))
      currentSubmenuItem.append(currentSubmenuLink)
      submenu.append(currentSubmenuItem)
    })
    currentMenu.append(submenu)
  }

  // dynamically creates header anchor links
  var headers = document.querySelectorAll('#doc-content h3, #doc-content h4')
  headers.forEach(el => {
    var currentAnchorLink = document.createElement('a')
    currentAnchorLink.className = 'anchor'
    currentAnchorLink.href = "#" + el.id
    currentAnchorLink.append(document.createTextNode('¶'))
    el.insertBefore(currentAnchorLink, el.firstChild);
  })</script><script>const contentLoaded = document.addEventListener('DOMContentLoaded', setTOCHeight)
  const resize = window.addEventListener('resize', setTOCHeight)

  function setTOCHeight() {
    const docHeight = window.innerHeight
    const tocSidebar = document.querySelector('#toc') || 0

    const tocHeight = docHeight - tocSidebar.getBoundingClientRect().top

    document.documentElement.style
      .setProperty('--TOC-height', `${tocHeight}px`)
  }

  window.addEventListener('beforeunload', () => {
    document.removeEventListener(contentLoaded)
    window.removeEventListener(resize)
  })</script></main><footer class="grey is-primary footer"><div class=container><div class="content has-text-centered"><p>Fastify, Copyright &copy; 2016-2023 <a href=https://openjsf.org/ target=_blank rel=noopener>OpenJS Foundation</a> and <a href=https://github.com/fastify/fastify#team target=_blank rel=noopener>The Fastify team</a>, Licensed under <a href=https://github.com/fastify/fastify/blob/master/LICENSE target=_blank rel=noopener>MIT</a></p><a href=https://www.netlify.com><img src=https://www.netlify.com/img/global/badges/netlify-color-accent.svg alt="Deploys by Netlify" loading=lazy decoding=async></a><p><small>Icons by simpleicons.org</small></p></div></div></footer><script src=/js/main.1e1d476db6c0b326.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js integrity="sha512-s+tOYYcC3Jybgr9mVsdAxsRYlGNq4mlAurOrfNuGMQ/SCofNPu92tjE7YRZCsdEtWL1yGkqk15fU/ark206YTg==" crossorigin=anonymous></script><script>hljs.highlightAll();</script><script src=https://cdn.jsdelivr.net/npm/@docsearch/js@alpha></script><script type=text/javascript>docsearch({
        appId: 'DMPMC33PLU',
        apiKey: '12d46b3bfeee6511031cfe00778f3e45',
        indexName: 'fastify',
        container: '#algolia-search-input',
        algoliaOptions: { 'facetFilters': ["version:latest", "tags:docs"] }
      });</script></body></html>