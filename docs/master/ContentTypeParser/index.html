<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Content Type Parser</title>
  <meta name="description" content="Fast and low overhead web framework, for Node.js">

  <link rel="apple-touch-icon" sizes="57x57" href="/images/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/images/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/images/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.5.1/css/bulma.min.css" integrity="sha256-CDVQJfU+jJGU/oyDzvnzuGXbv0rz+SyBsPQwyn7x/jQ=" crossorigin="anonymous" />
  <link rel="stylesheet" href="/css/style.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" integrity="sha256-Zd1icfZ72UBmsId/mUcagrmN7IN5Qkrvh75ICHIQVTk=" crossorigin="anonymous" />

  

  
</head>


  <body>
    <nav id="main-navbar" class="navbar">
  <div class="navbar-brand">
    <a class="navbar-item" href="/">
      <img src="/images/fastify-logo-menu.png" alt="Fastify: Fast and low overhead web framework, for Node.js" height="28">
    </a>

    <a class="navbar-item is-hidden-desktop" href="https://github.com/fastify/fastify" target="_blank">
      <span class="icon" style="color: #333;">
        <i class="fa fa-github"></i>
      </span>
    </a>

    <div class="navbar-burger burger" data-target="mobileMenu">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>

  <div class="navbar-menu" id="mobileMenu">
    <div class="navbar-start">
      <a class="navbar-item " href="/">Home</a>
      <a class="navbar-item " href="/docs/latest">Docs</a>
      <a class="navbar-item " href="/ecosystem">Ecosystem</a>
      <a class="navbar-item " href="/benchmarks">Benchmarks</a>
      <a class="navbar-item " href="https://github.com/fastify/help">Help</a>
    </div>

    <div class="navbar-end">
      <a class="navbar-item" href="https://github.com/fastify/fastify" target="_blank">
        <span class="fa fa-github"> </span>&nbsp;Github
      </a>
      <a class="navbar-item" href="https://twitter.com/fastifyjs" target="_blank">
        <span class="fa fa-twitter"> </span>&nbsp;Twitter
      </a>
    </div>
  </div>
</nav>


    <main class="page-content" aria-label="Content">
      
<section class="hero is-primary" style="background-image: url('/images/bg-pattern-bright.png')">
  <div class="hero-body">
      <div class="container">
        <h1 class="title">
          Documentation
        </h1>
      </div>
  </div>
</section>

<div class="container">
  <section class="section">
    <div class="columns">

      <div class="column is-3 is-hidden-mobile" data-sticky-container>
        <aside class="menu sticky">
          <p class="menu-label">
            Table of contents
          </p>
          <ul class="menu-list">
            
              <li >
                <a  href="/docs/master/Getting-Started">Getting Started</a>
              </li>
            
              <li >
                <a  href="/docs/master/Server-Methods">Server Methods</a>
              </li>
            
              <li >
                <a  href="/docs/master/Routes">Routes</a>
              </li>
            
              <li >
                <a  href="/docs/master/Logging">Logging</a>
              </li>
            
              <li >
                <a  href="/docs/master/Middlewares">Middlewares</a>
              </li>
            
              <li >
                <a  href="/docs/master/Hooks">Hooks</a>
              </li>
            
              <li >
                <a  href="/docs/master/Decorators">Decorators</a>
              </li>
            
              <li >
                <a  href="/docs/master/Validation-and-Serialization">Validation and Serialization</a>
              </li>
            
              <li >
                <a  href="/docs/master/Lifecycle">Lifecycle</a>
              </li>
            
              <li >
                <a  href="/docs/master/Reply">Reply</a>
              </li>
            
              <li >
                <a  href="/docs/master/Request">Request</a>
              </li>
            
              <li id="doc-menu-section">
                <a class="is-active" href="/docs/master/ContentTypeParser">Content Type Parser</a>
              </li>
            
              <li >
                <a  href="/docs/master/Plugins">Plugins</a>
              </li>
            
              <li >
                <a  href="/docs/master/Testing">Testing</a>
              </li>
            
              <li >
                <a  href="/docs/master/Benchmarking">Benchmarking</a>
              </li>
            
              <li >
                <a  href="/docs/master/Plugins-Guide">Plugins Guide</a>
              </li>
            
              <li >
                <a  href="/docs/master/HTTP2">HTTP2</a>
              </li>
            
              <li >
                <a  href="/docs/master/LTS">Long Term Support</a>
              </li>
            
          </ul>
          <div class="content" style="margin: .8em; border-top: 1px solid #ccc; padding: .8em 0 0 0">
            Docs version
            <div class="field">
              <div class="control">
                <div class="select">
                  <select onchange="if (this.value) window.location.href=this.value">
                    
                      
                        
                        
                          <option selected="selected" value="/docs/master">master</option>
                      
                    
                      
                        
                        
                          
                        
                          <option  value="/docs/v1.5.x">v1.5.x</option>
                      
                    
                      
                        
                        
                          <option  value="/docs/v1.4.x">v1.4.x</option>
                      
                    
                      
                        
                        
                          <option  value="/docs/v1.3.x">v1.3.x</option>
                      
                    
                      
                        
                        
                          <option  value="/docs/v1.2.x">v1.2.x</option>
                      
                    
                      
                        
                        
                          <option  value="/docs/v1.1.x">v1.1.x</option>
                      
                    
                      
                        
                        
                          <option  value="/docs/v1.0.x">v1.0.x</option>
                      
                    
                      
                        
                        
                          <option  value="/docs/v0.43.x">v0.43.x</option>
                      
                    
                      
                        
                        
                          <option  value="/docs/v0.42.x">v0.42.x</option>
                      
                    
                      
                        
                        
                          <option  value="/docs/v0.41.x">v0.41.x</option>
                      
                    
                      
                        
                        
                          <option  value="/docs/v0.40.x">v0.40.x</option>
                      
                    
                      
                        
                        
                          <option  value="/docs/v0.39.x">v0.39.x</option>
                      
                    
                      
                        
                        
                          <option  value="/docs/v0.38.x">v0.38.x</option>
                      
                    
                      
                        
                        
                          <option  value="/docs/v0.37.x">v0.37.x</option>
                      
                    
                      
                        
                        
                          <option  value="/docs/v0.36.x">v0.36.x</option>
                      
                    
                      
                        
                        
                          <option  value="/docs/v0.35.x">v0.35.x</option>
                      
                    
                      
                        
                        
                          <option  value="/docs/v0.34.x">v0.34.x</option>
                      
                    
                      
                    
                  </select>
                </div>
              </div>
            </div>
          </div>
        </aside>
      </div>

      <div class="column">
        <nav class="breadcrumb">
          <ul>
            <li><a href="/" style="padding-left: 0">Fastify</a></li>
            <li><a href="/docs/">Documentation</a></li>
            <li>
              <div class="field">
                <div class="control">
                  <div class="select">
                    <select onchange="if (this.value) window.location.href=this.value" style="border: none;">
                      
                        
                          
                          <option selected="selected" value="/docs/master">master</option>
                        
                      
                        
                          
                          <option  value="/docs/v1.5.x">v1.5.x</option>
                        
                      
                        
                          
                          <option  value="/docs/v1.4.x">v1.4.x</option>
                        
                      
                        
                          
                          <option  value="/docs/v1.3.x">v1.3.x</option>
                        
                      
                        
                          
                          <option  value="/docs/v1.2.x">v1.2.x</option>
                        
                      
                        
                          
                          <option  value="/docs/v1.1.x">v1.1.x</option>
                        
                      
                        
                          
                          <option  value="/docs/v1.0.x">v1.0.x</option>
                        
                      
                        
                          
                          <option  value="/docs/v0.43.x">v0.43.x</option>
                        
                      
                        
                          
                          <option  value="/docs/v0.42.x">v0.42.x</option>
                        
                      
                        
                          
                          <option  value="/docs/v0.41.x">v0.41.x</option>
                        
                      
                        
                          
                          <option  value="/docs/v0.40.x">v0.40.x</option>
                        
                      
                        
                          
                          <option  value="/docs/v0.39.x">v0.39.x</option>
                        
                      
                        
                          
                          <option  value="/docs/v0.38.x">v0.38.x</option>
                        
                      
                        
                          
                          <option  value="/docs/v0.37.x">v0.37.x</option>
                        
                      
                        
                          
                          <option  value="/docs/v0.36.x">v0.36.x</option>
                        
                      
                        
                          
                          <option  value="/docs/v0.35.x">v0.35.x</option>
                        
                      
                        
                          
                          <option  value="/docs/v0.34.x">v0.34.x</option>
                        
                      
                        
                      
                    </select>
                  </div>
                </div>
              </div>
            </li>
            <li class="is-active"><a>Content Type Parser</a></li>
          </ul>
        </nav>

        <div id="doc-content" class="content">
          <h2 id="content-type-parser">Content Type Parser</h2>
<p>Natively, Fastify only supports the <code>&#39;application/json&#39;</code> content type. The default charset is <code>utf-8</code>. If you need to support different content types, you can use the <code>addContentTypeParser</code> API. <em>The default JSON parser can be changed.</em></p>
<p>As with the other APIs, <code>addContentTypeParser</code> is encapsulated in the scope in which it is declared. This means that if you declare it in the root scope it will be available everywhere, while if you declare it inside a register it will be available only in that scope and its children.</p>
<p>Fastify adds automatically the parsed request payload to the <a href="/docs/master/Request">Fastify request</a> object, you can reach it with <code>request.body</code>.</p>
<h3 id="usage">Usage</h3>
<pre><code class="lang-js">fastify.addContentTypeParser(&#39;application/jsoff&#39;, function (req, done) {
  jsoffParser(req, function (err, body) {
    done(err, body)
  })
})
// async also supported in Node versions &gt;= 8.0.0
fastify.addContentTypeParser(&#39;application/jsoff&#39;, async function (req) {
  var res = await new Promise((resolve, reject) =&gt; resolve(req))
  return res
})
</code></pre>
<p>You can also use the <code>hasContentTypeParser</code> API to find if a specific content type parser already exists.</p>
<pre><code class="lang-js">if (!fastify.hasContentTypeParser(&#39;application/jsoff&#39;)){
  fastify.addContentTypeParser(&#39;application/jsoff&#39;, function (req, done) {
    //code to parse request body /payload for given content type
  })
}
</code></pre>
<h4 id="body-parser">Body Parser</h4>
<p>You can parse the body of the request in two ways. The first one is shown above: you add a custom content type parser and handle the request stream. In the second one you should pass a <code>parseAs</code> option to the <code>addContentTypeParser</code> API, where you declare how you want to get the body, it could be <code>&#39;string&#39;</code> or <code>&#39;buffer&#39;</code>. If you use the <code>parseAs</code> option Fastify will internally handle the stream and perform some checks, such as the <a href="/docs/master/Factory#factory-body-limit">maximum size</a> of the body and the content length. If the limit is exceeded the custom parser will not be invoked.</p>
<pre><code class="lang-js">fastify.addContentTypeParser(&#39;application/json&#39;, { parseAs: &#39;string&#39; }, function (req, body, done) {
  try {
    var json = JSON.parse(body)
    done(null, json)
  } catch (err) {
    err.statusCode = 400
    done(err, undefined)
  }
})
</code></pre>
<p>As you can see, now the function signature is <code>(req, body, done)</code> instead of <code>(req, done)</code>.</p>
<p>See <a href="https://github.com/fastify/fastify/blob/master/examples/parser.js"><code>example/parser.js</code></a> for an example.</p>
<h5 id="custom-parser-options">Custom Parser Options</h5>
<ul>
<li><code>parseAs</code> (string): Either <code>&#39;string&#39;</code> or <code>&#39;buffer&#39;</code> to designate how the incoming data should be collected. Default: <code>&#39;buffer&#39;</code>.</li>
<li><code>bodyLimit</code> (number): The maximum payload size, in bytes, that the custom parser will accept. Defaults to the global body limit passed to the <a href="/docs/master/Factory#bodylimit"><code>Fastify factory function</code></a>.</li>
</ul>
<h4 id="catch-all">Catch All</h4>
<p>There are some cases where you need to catch all requests regardless of their content type. With Fastify, you just need to add the <code>&#39;*&#39;</code> content type.</p>
<pre><code class="lang-js">fastify.addContentTypeParser(&#39;*&#39;, function (req, done) {
  var data = &#39;&#39;
  req.on(&#39;data&#39;, chunk =&gt; { data += chunk })
  req.on(&#39;end&#39;, () =&gt; {
    done(null, data)
  })
})
</code></pre>
<p>In this way, all of the requests that do not have a corresponding content type parser will be handled by the specified function.</p>

        </div>

        <hr/>
        <nav class="level">
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            <div class="level-left">
              <div class="level-item">
                
                  
                  
                  <a href="/docs/master/Request" class="button prev">≪ Request</a>
                
              </div>
            </div>
            <div class="level-right">
              <div class="level-item">
                
                  
                  
                  <a href="/docs/master/Plugins" class="button next">Plugins ≫</a>
                
              </div>
            </div>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        </nav>
      </div>
    </div>
  </section>

  <script>
    // dynamically creates a submenu for the current section based on the content headers
    var titles = document.querySelectorAll('#doc-content h3, #doc-content h4')
    var currentMenu = document.getElementById('doc-menu-section')
    if (titles.length && currentMenu) {
      var submenu = document.createElement('ul')
      titles.forEach(el => {
        var currentSubmenuItem = document.createElement('li')
        var currentSubmenuLink = document.createElement('a')
        currentSubmenuLink.href = '#' + el.id
        currentSubmenuLink.append(document.createTextNode(el.textContent))
        currentSubmenuItem.append(currentSubmenuLink)
        submenu.append(currentSubmenuItem)
      })
      currentMenu.append(submenu)
    }

    // dynamically creates header anchor links
    var headers = document.querySelectorAll('#doc-content h3, #doc-content h4')
    headers.forEach(el => {
      var currentAnchorLink = document.createElement('a')
      currentAnchorLink.className = 'anchor'
      currentAnchorLink.href = "#" + el.id
      currentAnchorLink.append(document.createTextNode('¶'))
      el.insertBefore(currentAnchorLink, el.firstChild);
    })
  </script>
</div>

    </main>

    <footer class="grey is-primary footer">
  <div class="container">
    <div class="content has-text-centered">
    
      <p><em>Found a typo or want to improve this page?</em> <a href="https://github.com/fastify/fastify/blob/master/docs/ContentTypeParser.md">Submit a PR on GitHub</a></p>
    
      <p>Fastify, Copyright &copy; 2016-2017 Matteo Collina and the <a href="https://github.com/fastify/fastify#team" target="_blank">Fastify team</a>, Licensed under <a href="https://github.com/fastify/fastify/blob/master/LICENSE" target="_blank">MIT</a></p>
    </div>
  </div>
</footer>


    <script src="/js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
  </body>

</html>
