<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>ContentTypeParser</title><meta name=description content="Fast and low overhead web framework, for Node.js"><link rel=apple-touch-icon sizes=57x57 href=/images/apple-icon-57x57.ed24c0a19503e080.png><link rel=apple-touch-icon sizes=60x60 href=/images/apple-icon-60x60.60c285c424d50738.png><link rel=apple-touch-icon sizes=72x72 href=/images/apple-icon-72x72.e49b27cfe1ab1461.png><link rel=apple-touch-icon sizes=76x76 href=/images/apple-icon-76x76.752f43fc91b8c1f7.png><link rel=apple-touch-icon sizes=114x114 href=/images/apple-icon-114x114.61739fa1d5a7059a.png><link rel=apple-touch-icon sizes=120x120 href=/images/apple-icon-120x120.7c25de37c5ce2ec1.png><link rel=apple-touch-icon sizes=144x144 href=/images/apple-icon-144x144.04d88fb27bd92cbe.png><link rel=apple-touch-icon sizes=152x152 href=/images/apple-icon-152x152.9364781175671626.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-icon-180x180.67579100928bfcd2.png><link rel=icon type=image/png sizes=192x192 href=/images/android-icon-192x192.37eb7f1ae3853740.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.1e22f0e774bc3cce.png><link rel=icon type=image/png sizes=96x96 href=/images/favicon-96x96.7e8a68b1b80c1799.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.e534ce05cb727f1a.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content=#ffffff><meta name=msapplication-TileImage content=/images/ms-icon-144x144.png><meta name=theme-color content=#ffffff><meta property=og:url content=https://www.fastify.io/docs/master/Reference/ContentTypeParser><meta property=og:type content=website><meta property=og:title content=ContentTypeParser><meta property=og:description content="Fast and low overhead web framework, for Node.js"><meta property=og:image content=https://www.fastify.io/images/fastify-fb-share-image.07b6e6860853c758.png><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@fastifyjs><meta name=twitter:creator content=@fastifyjs><meta name=twitter:title content=ContentTypeParser><meta name=twitter:description content="Fast and low overhead web framework, for Node.js"><meta name=twitter:image content=https://www.fastify.io/images/fastify-twitter-share-image.cd9f217b360af3e2.png><link rel=stylesheet href=/css/style.f4d6592b3a91c5ef.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/default.min.css integrity="sha512-kZqGbhf9JTB4bVJ0G8HCkqmaPcRgo88F0dneK30yku5Y/dep7CZfCnNml2Je/sY4lBoqoksXz4PtVXS4GHSUzQ==" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@alpha><meta name=robots content="noindex, nofollow"></head><body><nav id=main-navbar class=navbar><div class=navbar-brand><a class=navbar-item href=/ ><img src=/images/fastify-logo-menu.d13f8da7a965c800.png alt="Fastify: Fast and low overhead web framework, for Node.js" height=28 decoding=async> </a><a class="navbar-item is-hidden-desktop" href=https://github.com/fastify/fastify target=_blank rel=noopener><span class=icon style="color: #333;"><i class="fa fa-github"></i></span></a><div class="navbar-burger burger" data-target=mobileMenu><span></span> <span></span> <span></span></div></div><div class=navbar-menu id=mobileMenu><div class=navbar-start><a class=navbar-item href=/ >Home</a> <a class=navbar-item href=/docs/latest>Docs</a> <a class=navbar-item href=/ecosystem>Ecosystem</a> <a class=navbar-item href=/benchmarks>Benchmarks</a> <a class=navbar-item href=/contribute>Contribute</a> <a class=navbar-item href=https://medium.com/@fastifyjs/ >Blog</a> <a class=navbar-item href=https://github.com/fastify/help>Help</a></div><div class=navbar-end><span id=algolia-search-input class="control has-icons-left navbar-item"></span> <a class=navbar-item href=https://github.com/fastify/fastify target=_blank rel=noopener><span class="fa fa-github"></span>&nbsp;GitHub </a><a class=navbar-item href=https://twitter.com/fastifyjs target=_blank rel=noopener><span class="fa fa-twitter"></span>&nbsp;Twitter </a><a class=navbar-item rel=me href=https://fosstodon.org/@fastify target=_blank><span class="fa fa-hashtag"></span>&nbsp;Mastodon</a></div></div></nav><main class=page-content aria-label=Content><section class="hero is-primary" style="background-image: url(/images/bg-pattern-dark.3f8cda863b3bbf52.png)"><div class=hero-body><div class=container><h1 class=title>Documentation (master)</h1></div></div></section><section class=section><div class=container><div class=columns><div class="column is-3 is-hidden-mobile sticky-container"><aside class="menu sticky" id=toc><ul class=menu-list></ul><p class=menu-label><a href=/docs/master/Guides>Guides</a></p><ul class=menu-list><li style="text-transform: capitalize"><a title=Benchmarking href=/docs/master/Guides/Benchmarking>Benchmarking</a></li><li style="text-transform: capitalize"><a title=Contributing href=/docs/master/Guides/Contributing>Contributing</a></li><li style="text-transform: capitalize"><a title=Database href=/docs/master/Guides/Database>Database</a></li><li style="text-transform: capitalize"><a title=Delay-Accepting-Requests href=/docs/master/Guides/Delay-Accepting-Requests>Delay-Accepting-Requests</a></li><li style="text-transform: capitalize"><a title=Detecting-When-Clients-Abort href=/docs/master/Guides/Detecting-When-Clients-Abort>Detecting-When-Clients-Abort</a></li><li style="text-transform: capitalize"><a title=Ecosystem href=/docs/master/Guides/Ecosystem>Ecosystem</a></li><li style="text-transform: capitalize"><a title=Fluent-Schema href=/docs/master/Guides/Fluent-Schema>Fluent-Schema</a></li><li style="text-transform: capitalize"><a title=Getting-Started href=/docs/master/Guides/Getting-Started>Getting-Started</a></li><li style="text-transform: capitalize"><a title=Migration-Guide-V3 href=/docs/master/Guides/Migration-Guide-V3>Migration-Guide-V3</a></li><li style="text-transform: capitalize"><a title=Migration-Guide-V4 href=/docs/master/Guides/Migration-Guide-V4>Migration-Guide-V4</a></li><li style="text-transform: capitalize"><a title=Plugins-Guide href=/docs/master/Guides/Plugins-Guide>Plugins-Guide</a></li><li style="text-transform: capitalize"><a title=Prototype-Poisoning href=/docs/master/Guides/Prototype-Poisoning>Prototype-Poisoning</a></li><li style="text-transform: capitalize"><a title=Recommendations href=/docs/master/Guides/Recommendations>Recommendations</a></li><li style="text-transform: capitalize"><a title=Serverless href=/docs/master/Guides/Serverless>Serverless</a></li><li style="text-transform: capitalize"><a title=Style-Guide href=/docs/master/Guides/Style-Guide>Style-Guide</a></li><li style="text-transform: capitalize"><a title=Testing href=/docs/master/Guides/Testing>Testing</a></li><li style="text-transform: capitalize"><a title=Write-Plugin href=/docs/master/Guides/Write-Plugin>Write-Plugin</a></li><li style="text-transform: capitalize"><a title=Write-Type-Provider href=/docs/master/Guides/Write-Type-Provider>Write-Type-Provider</a></li></ul><p class=menu-label><a href=/docs/master/Reference>Reference</a></p><ul class=menu-list><li style="text-transform: capitalize" id=doc-menu-section><a title=ContentTypeParser class=is-active href=/docs/master/Reference/ContentTypeParser>ContentTypeParser</a></li><li style="text-transform: capitalize"><a title=Decorators href=/docs/master/Reference/Decorators>Decorators</a></li><li style="text-transform: capitalize"><a title=Encapsulation href=/docs/master/Reference/Encapsulation>Encapsulation</a></li><li style="text-transform: capitalize"><a title=Errors href=/docs/master/Reference/Errors>Errors</a></li><li style="text-transform: capitalize"><a title=HTTP2 href=/docs/master/Reference/HTTP2>HTTP2</a></li><li style="text-transform: capitalize"><a title=Hooks href=/docs/master/Reference/Hooks>Hooks</a></li><li style="text-transform: capitalize"><a title=LTS href=/docs/master/Reference/LTS>LTS</a></li><li style="text-transform: capitalize"><a title=Lifecycle href=/docs/master/Reference/Lifecycle>Lifecycle</a></li><li style="text-transform: capitalize"><a title=Logging href=/docs/master/Reference/Logging>Logging</a></li><li style="text-transform: capitalize"><a title=Middleware href=/docs/master/Reference/Middleware>Middleware</a></li><li style="text-transform: capitalize"><a title=Plugins href=/docs/master/Reference/Plugins>Plugins</a></li><li style="text-transform: capitalize"><a title=Reply href=/docs/master/Reference/Reply>Reply</a></li><li style="text-transform: capitalize"><a title=Request href=/docs/master/Reference/Request>Request</a></li><li style="text-transform: capitalize"><a title=Routes href=/docs/master/Reference/Routes>Routes</a></li><li style="text-transform: capitalize"><a title=Server href=/docs/master/Reference/Server>Server</a></li><li style="text-transform: capitalize"><a title=Type-Providers href=/docs/master/Reference/Type-Providers>Type-Providers</a></li><li style="text-transform: capitalize"><a title=TypeScript href=/docs/master/Reference/TypeScript>TypeScript</a></li><li style="text-transform: capitalize"><a title=Validation-and-Serialization href=/docs/master/Reference/Validation-and-Serialization>Validation-and-Serialization</a></li></ul><div class=content style="margin: .8em; border-top: 1px solid #ccc; padding: .8em 0 0 0">Docs version<div class=field><div class=control><div class=select><select onchange="if (this.value) window.location.href=this.value"><option value=/docs/latest>latest</option><option selected value=/docs/master>master</option><option value=/docs/v4.12.x>v4.12.x</option><option value=/docs/v4.11.x>v4.11.x</option><option value=/docs/v4.10.x>v4.10.x</option><option value=/docs/v4.9.x>v4.9.x</option><option value=/docs/v4.8.x>v4.8.x</option><option value=/docs/v4.7.x>v4.7.x</option><option value=/docs/v4.6.x>v4.6.x</option><option value=/docs/v4.5.x>v4.5.x</option><option value=/docs/v4.4.x>v4.4.x</option><option value=/docs/v4.3.x>v4.3.x</option><option value=/docs/v4.2.x>v4.2.x</option><option value=/docs/v4.1.x>v4.1.x</option><option value=/docs/v4.0.x>v4.0.x</option><option value=/docs/v3.29.x>v3.29.x</option><option value=/docs/v3.28.x>v3.28.x</option><option value=/docs/v3.27.x>v3.27.x</option><option value=/docs/v3.26.x>v3.26.x</option><option value=/docs/v3.25.x>v3.25.x</option><option value=/docs/v3.24.x>v3.24.x</option><option value=/docs/v3.23.x>v3.23.x</option><option value=/docs/v3.22.x>v3.22.x</option><option value=/docs/v3.21.x>v3.21.x</option><option value=/docs/v3.20.x>v3.20.x</option><option value=/docs/v3.19.x>v3.19.x</option><option value=/docs/v3.18.x>v3.18.x</option><option value=/docs/v3.17.x>v3.17.x</option><option value=/docs/v3.16.x>v3.16.x</option><option value=/docs/v3.15.x>v3.15.x</option><option value=/docs/v3.14.x>v3.14.x</option><option value=/docs/v3.13.x>v3.13.x</option><option value=/docs/v3.12.x>v3.12.x</option><option value=/docs/v3.11.x>v3.11.x</option><option value=/docs/v3.10.x>v3.10.x</option><option value=/docs/v3.9.x>v3.9.x</option><option value=/docs/v3.8.x>v3.8.x</option><option value=/docs/v3.7.x>v3.7.x</option><option value=/docs/v3.6.x>v3.6.x</option><option value=/docs/v3.5.x>v3.5.x</option><option value=/docs/v3.4.x>v3.4.x</option><option value=/docs/v3.3.x>v3.3.x</option><option value=/docs/v3.2.x>v3.2.x</option><option value=/docs/v3.1.x>v3.1.x</option><option value=/docs/v3.0.x>v3.0.x</option><option value=/docs/v2.15.x>v2.15.x</option><option value=/docs/v2.14.x>v2.14.x</option><option value=/docs/v2.13.x>v2.13.x</option><option value=/docs/v2.12.x>v2.12.x</option><option value=/docs/v2.11.x>v2.11.x</option><option value=/docs/v2.10.x>v2.10.x</option><option value=/docs/v2.9.x>v2.9.x</option><option value=/docs/v2.8.x>v2.8.x</option><option value=/docs/v2.7.x>v2.7.x</option><option value=/docs/v2.6.x>v2.6.x</option><option value=/docs/v2.5.x>v2.5.x</option><option value=/docs/v2.4.x>v2.4.x</option><option value=/docs/v2.3.x>v2.3.x</option><option value=/docs/v2.2.x>v2.2.x</option><option value=/docs/v2.1.x>v2.1.x</option><option value=/docs/v2.0.x>v2.0.x</option><option value=/docs/v1.14.x>v1.14.x</option><option value=/docs/v1.13.x>v1.13.x</option></select></div></div></div></div></aside></div><div class="column is-9"><nav class=breadcrumb><ul><li><a href=/ style="padding-left: 0">Fastify</a></li><li><a href=/docs/master>Documentation</a></li><li><div class=field><div class=control><div class=select><select onchange="if (this.value) window.location.href=this.value" style="border: none;"><option value=/docs/latest>latest</option><option selected value=/docs/master>master</option><option value=/docs/v4.12.x>v4.12.x</option><option value=/docs/v4.11.x>v4.11.x</option><option value=/docs/v4.10.x>v4.10.x</option><option value=/docs/v4.9.x>v4.9.x</option><option value=/docs/v4.8.x>v4.8.x</option><option value=/docs/v4.7.x>v4.7.x</option><option value=/docs/v4.6.x>v4.6.x</option><option value=/docs/v4.5.x>v4.5.x</option><option value=/docs/v4.4.x>v4.4.x</option><option value=/docs/v4.3.x>v4.3.x</option><option value=/docs/v4.2.x>v4.2.x</option><option value=/docs/v4.1.x>v4.1.x</option><option value=/docs/v4.0.x>v4.0.x</option><option value=/docs/v3.29.x>v3.29.x</option><option value=/docs/v3.28.x>v3.28.x</option><option value=/docs/v3.27.x>v3.27.x</option><option value=/docs/v3.26.x>v3.26.x</option><option value=/docs/v3.25.x>v3.25.x</option><option value=/docs/v3.24.x>v3.24.x</option><option value=/docs/v3.23.x>v3.23.x</option><option value=/docs/v3.22.x>v3.22.x</option><option value=/docs/v3.21.x>v3.21.x</option><option value=/docs/v3.20.x>v3.20.x</option><option value=/docs/v3.19.x>v3.19.x</option><option value=/docs/v3.18.x>v3.18.x</option><option value=/docs/v3.17.x>v3.17.x</option><option value=/docs/v3.16.x>v3.16.x</option><option value=/docs/v3.15.x>v3.15.x</option><option value=/docs/v3.14.x>v3.14.x</option><option value=/docs/v3.13.x>v3.13.x</option><option value=/docs/v3.12.x>v3.12.x</option><option value=/docs/v3.11.x>v3.11.x</option><option value=/docs/v3.10.x>v3.10.x</option><option value=/docs/v3.9.x>v3.9.x</option><option value=/docs/v3.8.x>v3.8.x</option><option value=/docs/v3.7.x>v3.7.x</option><option value=/docs/v3.6.x>v3.6.x</option><option value=/docs/v3.5.x>v3.5.x</option><option value=/docs/v3.4.x>v3.4.x</option><option value=/docs/v3.3.x>v3.3.x</option><option value=/docs/v3.2.x>v3.2.x</option><option value=/docs/v3.1.x>v3.1.x</option><option value=/docs/v3.0.x>v3.0.x</option><option value=/docs/v2.15.x>v2.15.x</option><option value=/docs/v2.14.x>v2.14.x</option><option value=/docs/v2.13.x>v2.13.x</option><option value=/docs/v2.12.x>v2.12.x</option><option value=/docs/v2.11.x>v2.11.x</option><option value=/docs/v2.10.x>v2.10.x</option><option value=/docs/v2.9.x>v2.9.x</option><option value=/docs/v2.8.x>v2.8.x</option><option value=/docs/v2.7.x>v2.7.x</option><option value=/docs/v2.6.x>v2.6.x</option><option value=/docs/v2.5.x>v2.5.x</option><option value=/docs/v2.4.x>v2.4.x</option><option value=/docs/v2.3.x>v2.3.x</option><option value=/docs/v2.2.x>v2.2.x</option><option value=/docs/v2.1.x>v2.1.x</option><option value=/docs/v2.0.x>v2.0.x</option><option value=/docs/v1.14.x>v1.14.x</option><option value=/docs/v1.13.x>v1.13.x</option></select></div></div></div></li><div class=field><div class=control><div class=select><select onchange="if (this.value) window.location.href=this.value" style="border: none;"><option value=/docs/master>Documentation</option><option value=/docs/master/Guides>Guides</option><option value=/docs/master/Guides/Benchmarking>Benchmarking</option><option value=/docs/master/Guides/Contributing>Contributing</option><option value=/docs/master/Guides/Database>Database</option><option value=/docs/master/Guides/Delay-Accepting-Requests>Delay-Accepting-Requests</option><option value=/docs/master/Guides/Detecting-When-Clients-Abort>Detecting-When-Clients-Abort</option><option value=/docs/master/Guides/Ecosystem>Ecosystem</option><option value=/docs/master/Guides/Fluent-Schema>Fluent-Schema</option><option value=/docs/master/Guides/Getting-Started>Getting-Started</option><option value=/docs/master/Guides/Migration-Guide-V3>Migration-Guide-V3</option><option value=/docs/master/Guides/Migration-Guide-V4>Migration-Guide-V4</option><option value=/docs/master/Guides/Plugins-Guide>Plugins-Guide</option><option value=/docs/master/Guides/Prototype-Poisoning>Prototype-Poisoning</option><option value=/docs/master/Guides/Recommendations>Recommendations</option><option value=/docs/master/Guides/Serverless>Serverless</option><option value=/docs/master/Guides/Style-Guide>Style-Guide</option><option value=/docs/master/Guides/Testing>Testing</option><option value=/docs/master/Guides/Write-Plugin>Write-Plugin</option><option value=/docs/master/Guides/Write-Type-Provider>Write-Type-Provider</option><option value=/docs/master/Reference>Reference</option><option selected value=/docs/master/Reference/ContentTypeParser>ContentTypeParser</option><option value=/docs/master/Reference/Decorators>Decorators</option><option value=/docs/master/Reference/Encapsulation>Encapsulation</option><option value=/docs/master/Reference/Errors>Errors</option><option value=/docs/master/Reference/HTTP2>HTTP2</option><option value=/docs/master/Reference/Hooks>Hooks</option><option value=/docs/master/Reference/LTS>LTS</option><option value=/docs/master/Reference/Lifecycle>Lifecycle</option><option value=/docs/master/Reference/Logging>Logging</option><option value=/docs/master/Reference/Middleware>Middleware</option><option value=/docs/master/Reference/Plugins>Plugins</option><option value=/docs/master/Reference/Reply>Reply</option><option value=/docs/master/Reference/Request>Request</option><option value=/docs/master/Reference/Routes>Routes</option><option value=/docs/master/Reference/Server>Server</option><option value=/docs/master/Reference/Type-Providers>Type-Providers</option><option value=/docs/master/Reference/TypeScript>TypeScript</option><option value=/docs/master/Reference/Validation-and-Serialization>Validation-and-Serialization</option></select></div></div></div></ul></nav><div id=doc-content class=content><h2 id=content-type-parser><code>Content-Type</code> Parser</h2><p>Natively, Fastify only supports <code>&#39;application/json&#39;</code> and <code>&#39;text/plain&#39;</code> content types. If the content type is not one of these, an <code>FST_ERR_CTP_INVALID_MEDIA_TYPE</code> error will be thrown.</p><p>The default charset is <code>utf-8</code>. If you need to support different content types, you can use the <code>addContentTypeParser</code> API. <em>The default JSON and/or plain text parser can be changed or removed.</em></p><p><em>Note: If you decide to specify your own content type with the <code>Content-Type</code> header, UTF-8 will not be the default. Be sure to include UTF-8 like this <code>text/html; charset=utf-8</code>.</em></p><p>As with the other APIs, <code>addContentTypeParser</code> is encapsulated in the scope in which it is declared. This means that if you declare it in the root scope it will be available everywhere, while if you declare it inside a plugin it will be available only in that scope and its children.</p><p>Fastify automatically adds the parsed request payload to the <a href=.././Request>Fastify request</a> object which you can access with <code>request.body</code>.</p><p>Note that for <code>GET</code> and <code>HEAD</code> requests the payload is never parsed. For <code>OPTIONS</code> and <code>DELETE</code> requests the payload is only parsed if the content type is given in the content-type header. If it is not given, the <a href=#catch-all>catch-all</a> parser is not executed as with <code>POST</code>, <code>PUT</code> and <code>PATCH</code>, but the payload is simply not parsed.</p><h3 id=usage>Usage</h3><pre><code class=language-js>fastify.addContentTypeParser(&#39;application/jsoff&#39;, function (request, payload, done) {
  jsoffParser(payload, function (err, body) {
    done(err, body)
  })
})

// Handle multiple content types with the same function
fastify.addContentTypeParser([&#39;text/xml&#39;, &#39;application/xml&#39;], function (request, payload, done) {
  xmlParser(payload, function (err, body) {
    done(err, body)
  })
})

// Async is also supported in Node versions &gt;= 8.0.0
fastify.addContentTypeParser(&#39;application/jsoff&#39;, async function (request, payload) {
  var res = await jsoffParserAsync(payload)

  return res
})

// Handle all content types that matches RegExp
fastify.addContentTypeParser(/^image\/.*/, function (request, payload, done) {
  imageParser(payload, function (err, body) {
    done(err, body)
  })
})

// Can use default JSON/Text parser for different content Types
fastify.addContentTypeParser(&#39;text/json&#39;, { parseAs: &#39;string&#39; }, fastify.getDefaultJsonParser(&#39;ignore&#39;, &#39;ignore&#39;))
</code></pre><p>Fastify first tries to match a content-type parser with a <code>string</code> value before trying to find a matching <code>RegExp</code>. If you provide overlapping content types, Fastify tries to find a matching content type by starting with the last one passed and ending with the first one. So if you want to specify a general content type more precisely, first specify the general content type and then the more specific one, like in the example below.</p><pre><code class=language-js>// Here only the second content type parser is called because its value also matches the first one
fastify.addContentTypeParser(&#39;application/vnd.custom+xml&#39;, (request, body, done) =&gt; {} )
fastify.addContentTypeParser(&#39;application/vnd.custom&#39;, (request, body, done) =&gt; {} )

// Here the desired behavior is achieved because fastify first tries to match the
// `application/vnd.custom+xml` content type parser
fastify.addContentTypeParser(&#39;application/vnd.custom&#39;, (request, body, done) =&gt; {} )
fastify.addContentTypeParser(&#39;application/vnd.custom+xml&#39;, (request, body, done) =&gt; {} )
</code></pre><p>Besides the <code>addContentTypeParser</code> API there are further APIs that can be used. These are <code>hasContentTypeParser</code>, <code>removeContentTypeParser</code> and <code>removeAllContentTypeParsers</code>.</p><h4 id=hascontenttypeparser>hasContentTypeParser</h4><p>You can use the <code>hasContentTypeParser</code> API to find if a specific content type parser already exists.</p><pre><code class=language-js>if (!fastify.hasContentTypeParser(&#39;application/jsoff&#39;)){
  fastify.addContentTypeParser(&#39;application/jsoff&#39;, function (request, payload, done) {
    jsoffParser(payload, function (err, body) {
      done(err, body)
    })
  })
}
</code></pre><p>=======</p><h4 id=removecontenttypeparser>removeContentTypeParser</h4><p>With <code>removeContentTypeParser</code> a single or an array of content types can be removed. The method supports <code>string</code> and <code>RegExp</code> content types.</p><pre><code class=language-js>fastify.addContentTypeParser(&#39;text/xml&#39;, function (request, payload, done) {
  xmlParser(payload, function (err, body) {
    done(err, body)
  })
})

// Removes the both built-in content type parsers so that only the content type parser for text/html is available
fastify.removeContentTypeParser([&#39;application/json&#39;, &#39;text/plain&#39;])
</code></pre><h4 id=removeallcontenttypeparsers>removeAllContentTypeParsers</h4><p>In the example from just above, it is noticeable that we need to specify each content type that we want to remove. To solve this problem Fastify provides the <code>removeAllContentTypeParsers</code> API. This can be used to remove all currently existing content type parsers. In the example below we achieve the same as in the example above except that we do not need to specify each content type to delete. Just like <code>removeContentTypeParser</code>, this API supports encapsulation. The API is especially useful if you want to register a <a href=#catch-all>catch-all content type parser</a> that should be executed for every content type and the built-in parsers should be ignored as well.</p><pre><code class=language-js>fastify.removeAllContentTypeParsers()

fastify.addContentTypeParser(&#39;text/xml&#39;, function (request, payload, done) {
  xmlParser(payload, function (err, body) {
    done(err, body)
  })
})
</code></pre><p><strong>Notice</strong>: The old syntaxes <code>function(req, done)</code> and <code>async function(req)</code> for the parser are still supported but they are deprecated.</p><h4 id=body-parser>Body Parser</h4><p>You can parse the body of a request in two ways. The first one is shown above: you add a custom content type parser and handle the request stream. In the second one, you should pass a <code>parseAs</code> option to the <code>addContentTypeParser</code> API, where you declare how you want to get the body. It could be of type <code>&#39;string&#39;</code> or <code>&#39;buffer&#39;</code>. If you use the <code>parseAs</code> option, Fastify will internally handle the stream and perform some checks, such as the <a href=.././Server#factory-body-limit>maximum size</a> of the body and the content length. If the limit is exceeded the custom parser will not be invoked.</p><pre><code class=language-js>fastify.addContentTypeParser(&#39;application/json&#39;, { parseAs: &#39;string&#39; }, function (req, body, done) {
  try {
    var json = JSON.parse(body)
    done(null, json)
  } catch (err) {
    err.statusCode = 400
    done(err, undefined)
  }
})
</code></pre><p>See <a href=https://github.com/fastify/fastify/blob/main/examples/parser.js><code>example/parser.js</code></a> for an example.</p><h5 id=custom-parser-options>Custom Parser Options</h5><ul><li><code>parseAs</code> (string): Either <code>&#39;string&#39;</code> or <code>&#39;buffer&#39;</code> to designate how the incoming data should be collected. Default: <code>&#39;buffer&#39;</code>.</li><li><code>bodyLimit</code> (number): The maximum payload size, in bytes, that the custom parser will accept. Defaults to the global body limit passed to the <a href=.././Server#bodylimit><code>Fastify factory function</code></a>.</li></ul><h4 id=catch-all>Catch-All</h4><p>There are some cases where you need to catch all requests regardless of their content type. With Fastify, you can just use the <code>&#39;*&#39;</code> content type.</p><pre><code class=language-js>fastify.addContentTypeParser(&#39;*&#39;, function (request, payload, done) {
  var data = &#39;&#39;
  payload.on(&#39;data&#39;, chunk =&gt; { data += chunk })
  payload.on(&#39;end&#39;, () =&gt; {
    done(null, data)
  })
})
</code></pre><p>Using this, all requests that do not have a corresponding content type parser will be handled by the specified function.</p><p>This is also useful for piping the request stream. You can define a content parser like:</p><pre><code class=language-js>fastify.addContentTypeParser(&#39;*&#39;, function (request, payload, done) {
  done()
})
</code></pre><p>and then access the core HTTP request directly for piping it where you want:</p><pre><code class=language-js>app.post(&#39;/hello&#39;, (request, reply) =&gt; {
  reply.send(request.raw)
})
</code></pre><p>Here is a complete example that logs incoming <a href=https://jsonlines.org/ >json line</a> objects:</p><pre><code class=language-js>const split2 = require(&#39;split2&#39;)
const pump = require(&#39;pump&#39;)

fastify.addContentTypeParser(&#39;*&#39;, (request, payload, done) =&gt; {
  done(null, pump(payload, split2(JSON.parse)))
})

fastify.route({
  method: &#39;POST&#39;,
  url: &#39;/api/log/jsons&#39;,
  handler: (req, res) =&gt; {
    req.body.on(&#39;data&#39;, d =&gt; console.log(d)) // log every incoming object
  }
})
</code></pre><p>For piping file uploads you may want to check out <a href=https://github.com/fastify/fastify-multipart>this plugin</a>.</p><p>If you want the content type parser to be executed on all content types and not only on those that don&#39;t have a specific one, you should call the <code>removeAllContentTypeParsers</code> method first.</p><pre><code class=language-js>// Without this call, the request body with the content type application/json would be processed by the built-in JSON parser
fastify.removeAllContentTypeParsers()

fastify.addContentTypeParser(&#39;*&#39;, function (request, payload, done) {
  var data = &#39;&#39;
  payload.on(&#39;data&#39;, chunk =&gt; { data += chunk })
  payload.on(&#39;end&#39;, () =&gt; {
    done(null, data)
  })
})
</code></pre></div><hr><nav class=level></nav></div></div></div></section><script>// dynamically creates a submenu for the current section based on the content headers
  var titles = document.querySelectorAll('#doc-content h3, #doc-content h4')
  var currentMenu = document.getElementById('doc-menu-section')
  if (titles.length && currentMenu) {
    var submenu = document.createElement('ul')
    titles.forEach(el => {
      var currentSubmenuItem = document.createElement('li')
      var currentSubmenuLink = document.createElement('a')
      currentSubmenuLink.href = '#' + el.id
      currentSubmenuLink.title = el.textContent
      currentSubmenuLink.append(document.createTextNode(el.textContent))
      currentSubmenuItem.append(currentSubmenuLink)
      submenu.append(currentSubmenuItem)
    })
    currentMenu.append(submenu)
  }

  // dynamically creates header anchor links
  var headers = document.querySelectorAll('#doc-content h3, #doc-content h4')
  headers.forEach(el => {
    var currentAnchorLink = document.createElement('a')
    currentAnchorLink.className = 'anchor'
    currentAnchorLink.href = "#" + el.id
    currentAnchorLink.append(document.createTextNode('¶'))
    el.insertBefore(currentAnchorLink, el.firstChild);
  })</script><script>const contentLoaded = document.addEventListener('DOMContentLoaded', setTOCHeight)
  const resize = window.addEventListener('resize', setTOCHeight)

  function setTOCHeight() {
    const docHeight = window.innerHeight
    const tocSidebar = document.querySelector('#toc') || 0

    const tocHeight = docHeight - tocSidebar.getBoundingClientRect().top

    document.documentElement.style
      .setProperty('--TOC-height', `${tocHeight}px`)
  }

  window.addEventListener('beforeunload', () => {
    document.removeEventListener(contentLoaded)
    window.removeEventListener(resize)
  })</script></main><footer class="grey is-primary footer"><div class=container><div class="content has-text-centered"><p><em>Found a typo or want to improve this page?</em> <a href=https://github.com/fastify/fastify/blob/master/docs/ContentTypeParser.md>Submit a PR on GitHub</a></p><p>Fastify, Copyright &copy; 2016-2023 <a href=https://openjsf.org/ target=_blank rel=noopener>OpenJS Foundation</a> and <a href=https://github.com/fastify/fastify#team target=_blank rel=noopener>The Fastify team</a>, Licensed under <a href=https://github.com/fastify/fastify/blob/master/LICENSE target=_blank rel=noopener>MIT</a></p><a href=https://www.netlify.com><img src=https://www.netlify.com/img/global/badges/netlify-color-accent.svg alt="Deploys by Netlify" loading=lazy decoding=async></a><p><small>Icons by simpleicons.org</small></p></div></div></footer><script src=/js/main.1e1d476db6c0b326.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js integrity="sha512-s+tOYYcC3Jybgr9mVsdAxsRYlGNq4mlAurOrfNuGMQ/SCofNPu92tjE7YRZCsdEtWL1yGkqk15fU/ark206YTg==" crossorigin=anonymous></script><script>hljs.highlightAll();</script><script src=https://cdn.jsdelivr.net/npm/@docsearch/js@alpha></script><script type=text/javascript>docsearch({
        appId: 'DMPMC33PLU',
        apiKey: '12d46b3bfeee6511031cfe00778f3e45',
        indexName: 'fastify',
        container: '#algolia-search-input',
        algoliaOptions: { 'facetFilters': ["version:latest", "tags:docs"] }
      });</script></body></html>