<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Serverless</title><meta name=description content="Fast and low overhead web framework, for Node.js"><link rel=apple-touch-icon sizes=57x57 href=/images/apple-icon-57x57.ed24c0a19503e080.png><link rel=apple-touch-icon sizes=60x60 href=/images/apple-icon-60x60.60c285c424d50738.png><link rel=apple-touch-icon sizes=72x72 href=/images/apple-icon-72x72.e49b27cfe1ab1461.png><link rel=apple-touch-icon sizes=76x76 href=/images/apple-icon-76x76.752f43fc91b8c1f7.png><link rel=apple-touch-icon sizes=114x114 href=/images/apple-icon-114x114.61739fa1d5a7059a.png><link rel=apple-touch-icon sizes=120x120 href=/images/apple-icon-120x120.7c25de37c5ce2ec1.png><link rel=apple-touch-icon sizes=144x144 href=/images/apple-icon-144x144.04d88fb27bd92cbe.png><link rel=apple-touch-icon sizes=152x152 href=/images/apple-icon-152x152.9364781175671626.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-icon-180x180.67579100928bfcd2.png><link rel=icon type=image/png sizes=192x192 href=/images/android-icon-192x192.37eb7f1ae3853740.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.1e22f0e774bc3cce.png><link rel=icon type=image/png sizes=96x96 href=/images/favicon-96x96.7e8a68b1b80c1799.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.e534ce05cb727f1a.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content=#ffffff><meta name=msapplication-TileImage content=/images/ms-icon-144x144.png><meta name=theme-color content=#ffffff><meta property=og:url content=https://www.fastify.io/docs/v4.12.x/Guides/Serverless><meta property=og:type content=website><meta property=og:title content=Serverless><meta property=og:description content="Fast and low overhead web framework, for Node.js"><meta property=og:image content=https://www.fastify.io/images/fastify-fb-share-image.07b6e6860853c758.png><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@fastifyjs><meta name=twitter:creator content=@fastifyjs><meta name=twitter:title content=Serverless><meta name=twitter:description content="Fast and low overhead web framework, for Node.js"><meta name=twitter:image content=https://www.fastify.io/images/fastify-twitter-share-image.cd9f217b360af3e2.png><link rel=stylesheet href=/css/style.f4d6592b3a91c5ef.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/default.min.css integrity="sha512-kZqGbhf9JTB4bVJ0G8HCkqmaPcRgo88F0dneK30yku5Y/dep7CZfCnNml2Je/sY4lBoqoksXz4PtVXS4GHSUzQ==" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@alpha><meta name=robots content="noindex, nofollow"></head><body><nav id=main-navbar class=navbar><div class=navbar-brand><a class=navbar-item href=/ ><img src=/images/fastify-logo-menu.d13f8da7a965c800.png alt="Fastify: Fast and low overhead web framework, for Node.js" height=28 decoding=async> </a><a class="navbar-item is-hidden-desktop" href=https://github.com/fastify/fastify target=_blank rel=noopener><span class=icon style="color: #333;"><i class="fa fa-github"></i></span></a><div class="navbar-burger burger" data-target=mobileMenu><span></span> <span></span> <span></span></div></div><div class=navbar-menu id=mobileMenu><div class=navbar-start><a class=navbar-item href=/ >Home</a> <a class=navbar-item href=/docs/latest>Docs</a> <a class=navbar-item href=/ecosystem>Ecosystem</a> <a class=navbar-item href=/benchmarks>Benchmarks</a> <a class=navbar-item href=/contribute>Contribute</a> <a class=navbar-item href=https://medium.com/@fastifyjs/ >Blog</a> <a class=navbar-item href=https://github.com/fastify/help>Help</a></div><div class=navbar-end><span id=algolia-search-input class="control has-icons-left navbar-item"></span> <a class=navbar-item href=https://github.com/fastify/fastify target=_blank rel=noopener><span class="fa fa-github"></span>&nbsp;GitHub </a><a class=navbar-item href=https://twitter.com/fastifyjs target=_blank rel=noopener><span class="fa fa-twitter"></span>&nbsp;Twitter </a><a class=navbar-item rel=me href=https://fosstodon.org/@fastify target=_blank><span class="fa fa-hashtag"></span>&nbsp;Mastodon</a></div></div></nav><main class=page-content aria-label=Content><section class="hero is-primary" style="background-image: url(/images/bg-pattern-dark.3f8cda863b3bbf52.png)"><div class=hero-body><div class=container><h1 class=title>Documentation (v4.12.0)</h1></div></div></section><section class=section><div class=container><div class=columns><div class="column is-3 is-hidden-mobile sticky-container"><aside class="menu sticky" id=toc><ul class=menu-list></ul><p class=menu-label><a href=/docs/v4.12.x/Guides>Guides</a></p><ul class=menu-list><li style="text-transform: capitalize"><a title=Benchmarking href=/docs/v4.12.x/Guides/Benchmarking>Benchmarking</a></li><li style="text-transform: capitalize"><a title=Contributing href=/docs/v4.12.x/Guides/Contributing>Contributing</a></li><li style="text-transform: capitalize"><a title=Database href=/docs/v4.12.x/Guides/Database>Database</a></li><li style="text-transform: capitalize"><a title=Delay-Accepting-Requests href=/docs/v4.12.x/Guides/Delay-Accepting-Requests>Delay-Accepting-Requests</a></li><li style="text-transform: capitalize"><a title=Ecosystem href=/docs/v4.12.x/Guides/Ecosystem>Ecosystem</a></li><li style="text-transform: capitalize"><a title=Fluent-Schema href=/docs/v4.12.x/Guides/Fluent-Schema>Fluent-Schema</a></li><li style="text-transform: capitalize"><a title=Getting-Started href=/docs/v4.12.x/Guides/Getting-Started>Getting-Started</a></li><li style="text-transform: capitalize"><a title=Migration-Guide-V3 href=/docs/v4.12.x/Guides/Migration-Guide-V3>Migration-Guide-V3</a></li><li style="text-transform: capitalize"><a title=Migration-Guide-V4 href=/docs/v4.12.x/Guides/Migration-Guide-V4>Migration-Guide-V4</a></li><li style="text-transform: capitalize"><a title=Plugins-Guide href=/docs/v4.12.x/Guides/Plugins-Guide>Plugins-Guide</a></li><li style="text-transform: capitalize"><a title=Prototype-Poisoning href=/docs/v4.12.x/Guides/Prototype-Poisoning>Prototype-Poisoning</a></li><li style="text-transform: capitalize"><a title=Recommendations href=/docs/v4.12.x/Guides/Recommendations>Recommendations</a></li><li style="text-transform: capitalize" id=doc-menu-section><a title=Serverless class=is-active href=/docs/v4.12.x/Guides/Serverless>Serverless</a></li><li style="text-transform: capitalize"><a title=Style-Guide href=/docs/v4.12.x/Guides/Style-Guide>Style-Guide</a></li><li style="text-transform: capitalize"><a title=Testing href=/docs/v4.12.x/Guides/Testing>Testing</a></li><li style="text-transform: capitalize"><a title=Write-Plugin href=/docs/v4.12.x/Guides/Write-Plugin>Write-Plugin</a></li><li style="text-transform: capitalize"><a title=Write-Type-Provider href=/docs/v4.12.x/Guides/Write-Type-Provider>Write-Type-Provider</a></li></ul><p class=menu-label><a href=/docs/v4.12.x/Reference>Reference</a></p><ul class=menu-list><li style="text-transform: capitalize"><a title=ContentTypeParser href=/docs/v4.12.x/Reference/ContentTypeParser>ContentTypeParser</a></li><li style="text-transform: capitalize"><a title=Decorators href=/docs/v4.12.x/Reference/Decorators>Decorators</a></li><li style="text-transform: capitalize"><a title=Encapsulation href=/docs/v4.12.x/Reference/Encapsulation>Encapsulation</a></li><li style="text-transform: capitalize"><a title=Errors href=/docs/v4.12.x/Reference/Errors>Errors</a></li><li style="text-transform: capitalize"><a title=HTTP2 href=/docs/v4.12.x/Reference/HTTP2>HTTP2</a></li><li style="text-transform: capitalize"><a title=Hooks href=/docs/v4.12.x/Reference/Hooks>Hooks</a></li><li style="text-transform: capitalize"><a title=LTS href=/docs/v4.12.x/Reference/LTS>LTS</a></li><li style="text-transform: capitalize"><a title=Lifecycle href=/docs/v4.12.x/Reference/Lifecycle>Lifecycle</a></li><li style="text-transform: capitalize"><a title=Logging href=/docs/v4.12.x/Reference/Logging>Logging</a></li><li style="text-transform: capitalize"><a title=Middleware href=/docs/v4.12.x/Reference/Middleware>Middleware</a></li><li style="text-transform: capitalize"><a title=Plugins href=/docs/v4.12.x/Reference/Plugins>Plugins</a></li><li style="text-transform: capitalize"><a title=Reply href=/docs/v4.12.x/Reference/Reply>Reply</a></li><li style="text-transform: capitalize"><a title=Request href=/docs/v4.12.x/Reference/Request>Request</a></li><li style="text-transform: capitalize"><a title=Routes href=/docs/v4.12.x/Reference/Routes>Routes</a></li><li style="text-transform: capitalize"><a title=Server href=/docs/v4.12.x/Reference/Server>Server</a></li><li style="text-transform: capitalize"><a title=Type-Providers href=/docs/v4.12.x/Reference/Type-Providers>Type-Providers</a></li><li style="text-transform: capitalize"><a title=TypeScript href=/docs/v4.12.x/Reference/TypeScript>TypeScript</a></li><li style="text-transform: capitalize"><a title=Validation-and-Serialization href=/docs/v4.12.x/Reference/Validation-and-Serialization>Validation-and-Serialization</a></li></ul><div class=content style="margin: .8em; border-top: 1px solid #ccc; padding: .8em 0 0 0">Docs version<div class=field><div class=control><div class=select><select onchange="if (this.value) window.location.href=this.value"><option value=/docs/latest>latest</option><option value=/docs/master>master</option><option value=/docs/v4.17.x>v4.17.x</option><option value=/docs/v4.16.x>v4.16.x</option><option value=/docs/v4.15.x>v4.15.x</option><option value=/docs/v4.14.x>v4.14.x</option><option value=/docs/v4.13.x>v4.13.x</option><option selected value=/docs/v4.12.x>v4.12.x</option><option value=/docs/v4.11.x>v4.11.x</option><option value=/docs/v4.10.x>v4.10.x</option><option value=/docs/v4.9.x>v4.9.x</option><option value=/docs/v4.8.x>v4.8.x</option><option value=/docs/v4.7.x>v4.7.x</option><option value=/docs/v4.6.x>v4.6.x</option><option value=/docs/v4.5.x>v4.5.x</option><option value=/docs/v4.4.x>v4.4.x</option><option value=/docs/v4.3.x>v4.3.x</option><option value=/docs/v4.2.x>v4.2.x</option><option value=/docs/v4.1.x>v4.1.x</option><option value=/docs/v4.0.x>v4.0.x</option><option value=/docs/v3.29.x>v3.29.x</option><option value=/docs/v3.28.x>v3.28.x</option><option value=/docs/v3.27.x>v3.27.x</option><option value=/docs/v3.26.x>v3.26.x</option><option value=/docs/v3.25.x>v3.25.x</option><option value=/docs/v3.24.x>v3.24.x</option><option value=/docs/v3.23.x>v3.23.x</option><option value=/docs/v3.22.x>v3.22.x</option><option value=/docs/v3.21.x>v3.21.x</option><option value=/docs/v3.20.x>v3.20.x</option><option value=/docs/v3.19.x>v3.19.x</option><option value=/docs/v3.18.x>v3.18.x</option><option value=/docs/v3.17.x>v3.17.x</option><option value=/docs/v3.16.x>v3.16.x</option><option value=/docs/v3.15.x>v3.15.x</option><option value=/docs/v3.14.x>v3.14.x</option><option value=/docs/v3.13.x>v3.13.x</option><option value=/docs/v3.12.x>v3.12.x</option><option value=/docs/v3.11.x>v3.11.x</option><option value=/docs/v3.10.x>v3.10.x</option><option value=/docs/v3.9.x>v3.9.x</option><option value=/docs/v3.8.x>v3.8.x</option><option value=/docs/v3.7.x>v3.7.x</option><option value=/docs/v3.6.x>v3.6.x</option><option value=/docs/v3.5.x>v3.5.x</option><option value=/docs/v3.4.x>v3.4.x</option><option value=/docs/v3.3.x>v3.3.x</option><option value=/docs/v3.2.x>v3.2.x</option><option value=/docs/v3.1.x>v3.1.x</option><option value=/docs/v3.0.x>v3.0.x</option><option value=/docs/v2.15.x>v2.15.x</option><option value=/docs/v2.14.x>v2.14.x</option><option value=/docs/v2.13.x>v2.13.x</option><option value=/docs/v2.12.x>v2.12.x</option><option value=/docs/v2.11.x>v2.11.x</option><option value=/docs/v2.10.x>v2.10.x</option><option value=/docs/v2.9.x>v2.9.x</option><option value=/docs/v2.8.x>v2.8.x</option><option value=/docs/v2.7.x>v2.7.x</option><option value=/docs/v2.6.x>v2.6.x</option><option value=/docs/v2.5.x>v2.5.x</option><option value=/docs/v2.4.x>v2.4.x</option><option value=/docs/v2.3.x>v2.3.x</option><option value=/docs/v2.2.x>v2.2.x</option><option value=/docs/v2.1.x>v2.1.x</option><option value=/docs/v2.0.x>v2.0.x</option><option value=/docs/v1.14.x>v1.14.x</option><option value=/docs/v1.13.x>v1.13.x</option></select></div></div></div></div></aside></div><div class="column is-9"><nav class=breadcrumb><ul><li><a href=/ style="padding-left: 0">Fastify</a></li><li><a href=/docs/v4.12.x>Documentation</a></li><li><div class=field><div class=control><div class=select><select onchange="if (this.value) window.location.href=this.value" style="border: none;"><option value=/docs/latest>latest</option><option value=/docs/master>master</option><option value=/docs/v4.17.x>v4.17.x</option><option value=/docs/v4.16.x>v4.16.x</option><option value=/docs/v4.15.x>v4.15.x</option><option value=/docs/v4.14.x>v4.14.x</option><option value=/docs/v4.13.x>v4.13.x</option><option selected value=/docs/v4.12.x>v4.12.x</option><option value=/docs/v4.11.x>v4.11.x</option><option value=/docs/v4.10.x>v4.10.x</option><option value=/docs/v4.9.x>v4.9.x</option><option value=/docs/v4.8.x>v4.8.x</option><option value=/docs/v4.7.x>v4.7.x</option><option value=/docs/v4.6.x>v4.6.x</option><option value=/docs/v4.5.x>v4.5.x</option><option value=/docs/v4.4.x>v4.4.x</option><option value=/docs/v4.3.x>v4.3.x</option><option value=/docs/v4.2.x>v4.2.x</option><option value=/docs/v4.1.x>v4.1.x</option><option value=/docs/v4.0.x>v4.0.x</option><option value=/docs/v3.29.x>v3.29.x</option><option value=/docs/v3.28.x>v3.28.x</option><option value=/docs/v3.27.x>v3.27.x</option><option value=/docs/v3.26.x>v3.26.x</option><option value=/docs/v3.25.x>v3.25.x</option><option value=/docs/v3.24.x>v3.24.x</option><option value=/docs/v3.23.x>v3.23.x</option><option value=/docs/v3.22.x>v3.22.x</option><option value=/docs/v3.21.x>v3.21.x</option><option value=/docs/v3.20.x>v3.20.x</option><option value=/docs/v3.19.x>v3.19.x</option><option value=/docs/v3.18.x>v3.18.x</option><option value=/docs/v3.17.x>v3.17.x</option><option value=/docs/v3.16.x>v3.16.x</option><option value=/docs/v3.15.x>v3.15.x</option><option value=/docs/v3.14.x>v3.14.x</option><option value=/docs/v3.13.x>v3.13.x</option><option value=/docs/v3.12.x>v3.12.x</option><option value=/docs/v3.11.x>v3.11.x</option><option value=/docs/v3.10.x>v3.10.x</option><option value=/docs/v3.9.x>v3.9.x</option><option value=/docs/v3.8.x>v3.8.x</option><option value=/docs/v3.7.x>v3.7.x</option><option value=/docs/v3.6.x>v3.6.x</option><option value=/docs/v3.5.x>v3.5.x</option><option value=/docs/v3.4.x>v3.4.x</option><option value=/docs/v3.3.x>v3.3.x</option><option value=/docs/v3.2.x>v3.2.x</option><option value=/docs/v3.1.x>v3.1.x</option><option value=/docs/v3.0.x>v3.0.x</option><option value=/docs/v2.15.x>v2.15.x</option><option value=/docs/v2.14.x>v2.14.x</option><option value=/docs/v2.13.x>v2.13.x</option><option value=/docs/v2.12.x>v2.12.x</option><option value=/docs/v2.11.x>v2.11.x</option><option value=/docs/v2.10.x>v2.10.x</option><option value=/docs/v2.9.x>v2.9.x</option><option value=/docs/v2.8.x>v2.8.x</option><option value=/docs/v2.7.x>v2.7.x</option><option value=/docs/v2.6.x>v2.6.x</option><option value=/docs/v2.5.x>v2.5.x</option><option value=/docs/v2.4.x>v2.4.x</option><option value=/docs/v2.3.x>v2.3.x</option><option value=/docs/v2.2.x>v2.2.x</option><option value=/docs/v2.1.x>v2.1.x</option><option value=/docs/v2.0.x>v2.0.x</option><option value=/docs/v1.14.x>v1.14.x</option><option value=/docs/v1.13.x>v1.13.x</option></select></div></div></div></li><div class=field><div class=control><div class=select><select onchange="if (this.value) window.location.href=this.value" style="border: none;"><option value=/docs/v4.12.x>Documentation</option><option value=/docs/v4.12.x/Guides>Guides</option><option value=/docs/v4.12.x/Guides/Benchmarking>Benchmarking</option><option value=/docs/v4.12.x/Guides/Contributing>Contributing</option><option value=/docs/v4.12.x/Guides/Database>Database</option><option value=/docs/v4.12.x/Guides/Delay-Accepting-Requests>Delay-Accepting-Requests</option><option value=/docs/v4.12.x/Guides/Ecosystem>Ecosystem</option><option value=/docs/v4.12.x/Guides/Fluent-Schema>Fluent-Schema</option><option value=/docs/v4.12.x/Guides/Getting-Started>Getting-Started</option><option value=/docs/v4.12.x/Guides/Migration-Guide-V3>Migration-Guide-V3</option><option value=/docs/v4.12.x/Guides/Migration-Guide-V4>Migration-Guide-V4</option><option value=/docs/v4.12.x/Guides/Plugins-Guide>Plugins-Guide</option><option value=/docs/v4.12.x/Guides/Prototype-Poisoning>Prototype-Poisoning</option><option value=/docs/v4.12.x/Guides/Recommendations>Recommendations</option><option selected value=/docs/v4.12.x/Guides/Serverless>Serverless</option><option value=/docs/v4.12.x/Guides/Style-Guide>Style-Guide</option><option value=/docs/v4.12.x/Guides/Testing>Testing</option><option value=/docs/v4.12.x/Guides/Write-Plugin>Write-Plugin</option><option value=/docs/v4.12.x/Guides/Write-Type-Provider>Write-Type-Provider</option><option value=/docs/v4.12.x/Reference>Reference</option><option value=/docs/v4.12.x/Reference/ContentTypeParser>ContentTypeParser</option><option value=/docs/v4.12.x/Reference/Decorators>Decorators</option><option value=/docs/v4.12.x/Reference/Encapsulation>Encapsulation</option><option value=/docs/v4.12.x/Reference/Errors>Errors</option><option value=/docs/v4.12.x/Reference/HTTP2>HTTP2</option><option value=/docs/v4.12.x/Reference/Hooks>Hooks</option><option value=/docs/v4.12.x/Reference/LTS>LTS</option><option value=/docs/v4.12.x/Reference/Lifecycle>Lifecycle</option><option value=/docs/v4.12.x/Reference/Logging>Logging</option><option value=/docs/v4.12.x/Reference/Middleware>Middleware</option><option value=/docs/v4.12.x/Reference/Plugins>Plugins</option><option value=/docs/v4.12.x/Reference/Reply>Reply</option><option value=/docs/v4.12.x/Reference/Request>Request</option><option value=/docs/v4.12.x/Reference/Routes>Routes</option><option value=/docs/v4.12.x/Reference/Server>Server</option><option value=/docs/v4.12.x/Reference/Type-Providers>Type-Providers</option><option value=/docs/v4.12.x/Reference/TypeScript>TypeScript</option><option value=/docs/v4.12.x/Reference/Validation-and-Serialization>Validation-and-Serialization</option></select></div></div></div></ul></nav><div id=doc-content class=content><h1 align=center>Serverless</h1><p>Run serverless applications and REST APIs using your existing Fastify application. By default, Fastify will not work on your serverless platform of choice, you will need to make some small changes to fix this. This document contains a small guide for the most popular serverless providers and how to use Fastify with them.</p><h4 id=should-you-use-fastify-in-a-serverless-platform>Should you use Fastify in a serverless platform?</h4><p>That is up to you! Keep in mind that functions as a service should always use small and focused functions, but you can also run an entire web application with them. It is important to remember that the bigger the application the slower the initial boot will be. The best way to run Fastify applications in serverless environments is to use platforms like Google Cloud Run, AWS Fargate, and Azure Container Instances, where the server can handle multiple requests at the same time and make full use of Fastify&#39;s features.</p><p>One of the best features of using Fastify in serverless applications is the ease of development. In your local environment, you will always run the Fastify application directly without the need for any additional tools, while the same code will be executed in your serverless platform of choice with an additional snippet of code.</p><h3 id=contents>Contents</h3><ul><li><a href=#aws>AWS</a></li><li><a href=#google-cloud-functions>Google Cloud Functions</a></li><li><a href=#google-cloud-run>Google Cloud Run</a></li><li><a href=#netlify-lambda>Netlify Lambda</a></li><li><a href=#vercel>Vercel</a></li></ul><h2 id=aws>AWS</h2><p>To integrate with AWS, you have two choices of library:</p><ul><li>Using <a href=https://github.com/fastify/aws-lambda-fastify>@fastify/aws-lambda</a> which only adds API Gateway support but has heavy optimizations for fastify.</li><li>Using <a href=https://github.com/H4ad/serverless-adapter>@h4ad/serverless-adapter</a> which is a little slower as it creates an HTTP request for each AWS event but has support for more AWS services such as: AWS SQS, AWS SNS and others.</li></ul><p>So you can decide which option is best for you, but you can test both libraries.</p><h3 id=using-fastifyaws-lambda>Using @fastify/aws-lambda</h3><p>The sample provided allows you to easily build serverless web applications/services and RESTful APIs using Fastify on top of AWS Lambda and Amazon API Gateway.</p><h4 id=appjs>app.js</h4><pre><code class=language-js>const fastify = require(&#39;fastify&#39;);

function init() {
  const app = fastify();
  app.get(&#39;/&#39;, (request, reply) =&gt; reply.send({ hello: &#39;world&#39; }));
  return app;
}

if (require.main === module) {
  // called directly i.e. &quot;node app&quot;
  init().listen({ port: 3000 }, (err) =&gt; {
    if (err) console.error(err);
    console.log(&#39;server listening on 3000&#39;);
  });
} else {
  // required as a module =&gt; executed on aws lambda
  module.exports = init;
}
</code></pre><p>When executed in your lambda function we do not need to listen to a specific port, so we just export the wrapper function <code>init</code> in this case. The <a href=#lambdajs><code>lambda.js</code></a> file will use this export.</p><p>When you execute your Fastify application like always, i.e. <code>node app.js</code> <em>(the detection for this could be <code>require.main === module</code>)</em>, you can normally listen to your port, so you can still run your Fastify function locally.</p><h4 id=lambdajs>lambda.js</h4><pre><code class=language-js>const awsLambdaFastify = require(&#39;@fastify/aws-lambda&#39;)
const init = require(&#39;./app&#39;);

const proxy = awsLambdaFastify(init())
// or
// const proxy = awsLambdaFastify(init(), { binaryMimeTypes: [&#39;application/octet-stream&#39;] })

exports.handler = proxy;
// or
// exports.handler = (event, context, callback) =&gt; proxy(event, context, callback);
// or
// exports.handler = (event, context) =&gt; proxy(event, context);
// or
// exports.handler = async (event, context) =&gt; proxy(event, context);
</code></pre><p>We just require <a href=https://github.com/fastify/aws-lambda-fastify>@fastify/aws-lambda</a> (make sure you install the dependency <code>npm i @fastify/aws-lambda</code>) and our <a href=#appjs><code>app.js</code></a> file and call the exported <code>awsLambdaFastify</code> function with the <code>app</code> as the only parameter. The resulting <code>proxy</code> function has the correct signature to be used as a lambda <code>handler</code> function. This way all the incoming events (API Gateway requests) are passed to the <code>proxy</code> function of <a href=https://github.com/fastify/aws-lambda-fastify>@fastify/aws-lambda</a>.</p><h4 id=example>Example</h4><p>An example deployable with <a href=https://claudiajs.com/tutorials/serverless-express.html>claudia.js</a> can be found <a href=https://github.com/claudiajs/example-projects/tree/master/fastify-app-lambda>here</a>.</p><h3 id=considerations>Considerations</h3><ul><li>API Gateway does not support streams yet, so you are not able to handle <a href=../../Reference/Reply#streams>streams</a>.</li><li>API Gateway has a timeout of 29 seconds, so it is important to provide a reply during this time.</li></ul><h4 id=beyond-api-gateway>Beyond API Gateway</h4><p>If you need to integrate with more AWS services, take a look at <a href=https://viniciusl.com.br/serverless-adapter/docs/main/frameworks/fastify>@h4ad/serverless-adapter</a> on Fastify to find out how to integrate.</p><h2 id=google-cloud-functions>Google Cloud Functions</h2><h3 id=creation-of-fastify-instance>Creation of Fastify instance</h3><pre><code class=language-js>const fastify = require(&quot;fastify&quot;)({
  logger: true // you can also define the level passing an object configuration to logger: {level: &#39;debug&#39;}
});
</code></pre><h3 id=add-custom-contenttypeparser-to-fastify-instance>Add Custom <code>contentTypeParser</code> to Fastify instance</h3><p>As explained <a href=https://github.com/fastify/fastify/issues/946#issuecomment-766319521>in issue #946</a>, since the Google Cloud Functions platform parses the body of the request before it arrives at the Fastify instance, troubling the body request in case of <code>POST</code> and <code>PATCH</code> methods, you need to add a custom <a href=../../Reference/ContentTypeParser><code>Content-Type Parser</code></a> to mitigate this behavior.</p><pre><code class=language-js>fastify.addContentTypeParser(&#39;application/json&#39;, {}, (req, body, done) =&gt; {
  done(null, body.body);
});
</code></pre><h3 id=define-your-endpoint-examples>Define your endpoint (examples)</h3><p>A simple <code>GET</code> endpoint:</p><pre><code class=language-js>fastify.get(&#39;/&#39;, async (request, reply) =&gt; {
  reply.send({message: &#39;Hello World!&#39;})
})
</code></pre><p>Or a more complete <code>POST</code> endpoint with schema validation:</p><pre><code class=language-js>fastify.route({
  method: &#39;POST&#39;,
  url: &#39;/hello&#39;,
  schema: {
    body: {
      type: &#39;object&#39;,
      properties: {
        name: { type: &#39;string&#39;}
      },
      required: [&#39;name&#39;]
    },
    response: {
      200: {
        type: &#39;object&#39;,
        properties: {
          message: {type: &#39;string&#39;}
        }
      }
    },
  },
  handler: async (request, reply) =&gt; {
    const { name } = request.body;
    reply.code(200).send({
      message: `Hello ${name}!`
    })
  }
})
</code></pre><h3 id=implement-and-export-the-function>Implement and export the function</h3><p>Final step, implement the function to handle the request and pass it to Fastify by emitting <code>request</code> event to <code>fastify.server</code>:</p><pre><code class=language-js>const fastifyFunction = async (request, reply) =&gt; {
  await fastify.ready();
  fastify.server.emit(&#39;request&#39;, request, reply)
}

export.fastifyFunction = fastifyFunction;
</code></pre><h3 id=local-test>Local test</h3><p>Install <a href=https://github.com/GoogleCloudPlatform/functions-framework-nodejs>Google Functions Framework for Node.js</a>.</p><p>You can install it globally:</p><pre><code class=language-bash>npm i -g @google-cloud/functions-framework
</code></pre><p>Or as a development library:</p><pre><code class=language-bash>npm i -D @google-cloud/functions-framework
</code></pre><p>Then you can run your function locally with Functions Framework:</p><pre><code class=language-bash>npx @google-cloud/functions-framework --target=fastifyFunction
</code></pre><p>Or add this command to your <code>package.json</code> scripts:</p><pre><code class=language-json>&quot;scripts&quot;: {
...
&quot;dev&quot;: &quot;npx @google-cloud/functions-framework --target=fastifyFunction&quot;
...
}
</code></pre><p>and run it with <code>npm run dev</code>.</p><h3 id=deploy>Deploy</h3><pre><code class=language-bash>gcloud functions deploy fastifyFunction \
--runtime nodejs14 --trigger-http --region $GOOGLE_REGION --allow-unauthenticated
</code></pre><h4 id=read-logs>Read logs</h4><pre><code class=language-bash>gcloud functions logs read
</code></pre><h4 id=example-request-to-hello-endpoint>Example request to <code>/hello</code> endpoint</h4><pre><code class=language-bash>curl -X POST https://$GOOGLE_REGION-$GOOGLE_PROJECT.cloudfunctions.net/me \
  -H &quot;Content-Type: application/json&quot; \
  -d &#39;{ &quot;name&quot;: &quot;Fastify&quot; }&#39;
{&quot;message&quot;:&quot;Hello Fastify!&quot;}
</code></pre><h3 id=references>References</h3><ul><li><a href=https://cloud.google.com/functions/docs/quickstart-nodejs>Google Cloud Functions - Node.js Quickstart</a></li></ul><h2 id=google-cloud-run>Google Cloud Run</h2><p>Unlike AWS Lambda or Google Cloud Functions, Google Cloud Run is a serverless <strong>container</strong> environment. Its primary purpose is to provide an infrastructure-abstracted environment to run arbitrary containers. As a result, Fastify can be deployed to Google Cloud Run with little-to-no code changes from the way you would write your Fastify app normally.</p><p><em>Follow the steps below to deploy to Google Cloud Run if you are already familiar with gcloud or just follow their <a href=https://cloud.google.com/run/docs/quickstarts/build-and-deploy>quickstart</a></em>.</p><h3 id=adjust-fastify-server>Adjust Fastify server</h3><p>In order for Fastify to properly listen for requests within the container, be sure to set the correct port and address:</p><pre><code class=language-js>function build() {
  const fastify = Fastify({ trustProxy: true })
  return fastify
}

async function start() {
  // Google Cloud Run will set this environment variable for you, so
  // you can also use it to detect if you are running in Cloud Run
  const IS_GOOGLE_CLOUD_RUN = process.env.K_SERVICE !== undefined

  // You must listen on the port Cloud Run provides
  const port = process.env.PORT || 3000

  // You must listen on all IPV4 addresses in Cloud Run
  const host = IS_GOOGLE_CLOUD_RUN ? &quot;0.0.0.0&quot; : undefined

  try {
    const server = build()
    const address = await server.listen({ port, host })
    console.log(`Listening on ${address}`)
  } catch (err) {
    console.error(err)
    process.exit(1)
  }
}

module.exports = build

if (require.main === module) {
  start()
}
</code></pre><h3 id=add-a-dockerfile>Add a Dockerfile</h3><p>You can add any valid <code>Dockerfile</code> that packages and runs a Node app. A basic <code>Dockerfile</code> can be found in the official <a href=https://github.com/knative/docs/blob/2d654d1fd6311750cc57187a86253c52f273d924/docs/serving/samples/hello-world/helloworld-nodejs/Dockerfile>gcloud docs</a>.</p><pre><code class=language-Dockerfile># Use the official Node.js 10 image.
# https://hub.docker.com/_/node
FROM node:10

# Create and change to the app directory.
WORKDIR /usr/src/app

# Copy application dependency manifests to the container image.
# A wildcard is used to ensure both package.json AND package-lock.json are copied.
# Copying this separately prevents re-running npm install on every code change.
COPY package*.json ./

# Install production dependencies.
RUN npm i --production

# Copy local code to the container image.
COPY . .

# Run the web service on container startup.
CMD [ &quot;npm&quot;, &quot;start&quot; ]
</code></pre><h3 id=add-a-dockerignore>Add a .dockerignore</h3><p>To keep build artifacts out of your container (which keeps it small and improves build times) add a <code>.dockerignore</code> file like the one below:</p><pre><code class=language-.dockerignore>Dockerfile
README.md
node_modules
npm-debug.log
</code></pre><h3 id=submit-build>Submit build</h3><p>Next, submit your app to be built into a Docker image by running the following command (replacing <code>PROJECT-ID</code> and <code>APP-NAME</code> with your GCP project id and an app name):</p><pre><code class=language-bash>gcloud builds submit --tag gcr.io/PROJECT-ID/APP-NAME
</code></pre><h3 id=deploy-image>Deploy Image</h3><p>After your image has built, you can deploy it with the following command:</p><pre><code class=language-bash>gcloud beta run deploy --image gcr.io/PROJECT-ID/APP-NAME --platform managed
</code></pre><p>Your app will be accessible from the URL GCP provides.</p><h2 id=netlify-lambda>netlify-lambda</h2><p>First, please perform all preparation steps related to <strong>AWS Lambda</strong>.</p><p>Create a folder called <code>functions</code>, then create <code>server.js</code> (and your endpoint path will be <code>server.js</code>) inside the <code>functions</code> folder.</p><h3 id=functionsserverjs>functions/server.js</h3><pre><code class=language-js>export { handler } from &#39;../lambda.js&#39;; // Change `lambda.js` path to your `lambda.js` path
</code></pre><h3 id=netlifytoml>netlify.toml</h3><pre><code class=language-toml>[build]
  # This will be run the site build
  command = &quot;npm run build:functions&quot;
  # This is the directory is publishing to netlify&#39;s CDN
  # and this is directory of your front of your app
  # publish = &quot;build&quot;
  # functions build directory
  functions = &quot;functions-build&quot; # always appends `-build` folder to your `functions` folder for builds
</code></pre><h3 id=webpackconfignetlifyjs>webpack.config.netlify.js</h3><p><strong>Do not forget to add this Webpack config, or else problems may occur</strong></p><pre><code class=language-js>const nodeExternals = require(&#39;webpack-node-externals&#39;);
const dotenv = require(&#39;dotenv-safe&#39;);
const webpack = require(&#39;webpack&#39;);

const env = process.env.NODE_ENV || &#39;production&#39;;
const dev = env === &#39;development&#39;;

if (dev) {
  dotenv.config({ allowEmptyValues: true });
}

module.exports = {
  mode: env,
  devtool: dev ? &#39;eval-source-map&#39; : &#39;none&#39;,
  externals: [nodeExternals()],
  devServer: {
    proxy: {
      &#39;/.netlify&#39;: {
        target: &#39;http://localhost:9000&#39;,
        pathRewrite: { &#39;^/.netlify/functions&#39;: &#39;&#39; }
      }
    }
  },
  module: {
    rules: []
  },
  plugins: [
    new webpack.DefinePlugin({
      &#39;process.env.APP_ROOT_PATH&#39;: JSON.stringify(&#39;/&#39;),
      &#39;process.env.NETLIFY_ENV&#39;: true,
      &#39;process.env.CONTEXT&#39;: env
    })
  ]
};
</code></pre><h3 id=scripts>Scripts</h3><p>Add this command to your <code>package.json</code> <em>scripts</em></p><pre><code class=language-json>&quot;scripts&quot;: {
...
&quot;build:functions&quot;: &quot;netlify-lambda build functions --config ./webpack.config.netlify.js&quot;
...
}
</code></pre><p>Then it should work fine</p><h2 id=vercel>Vercel</h2><p><a href=https://vercel.com>Vercel</a> provides zero-configuration deployment for Node.js applications. To use it now, it is as simple as configuring your <code>vercel.json</code> file like the following:</p><pre><code class=language-json>{
    &quot;rewrites&quot;: [
        {
            &quot;source&quot;: &quot;/(.*)&quot;,
            &quot;destination&quot;: &quot;/api/serverless.js&quot;
        }
    ]
}
</code></pre><p>Then, write <code>api/serverless.js</code> like so:</p><pre><code class=language-js>&quot;use strict&quot;;

// Read the .env file.
import * as dotenv from &quot;dotenv&quot;;
dotenv.config();

// Require the framework
import Fastify from &quot;fastify&quot;;

// Instantiate Fastify with some config
const app = Fastify({
  logger: true,
});

// Register your application as a normal plugin.
app.register(import(&quot;../src/app&quot;));

export default async (req, res) =&gt; {
    await app.ready();
    app.server.emit(&#39;request&#39;, req, res);
}
</code></pre></div><hr><nav class=level></nav></div></div></div></section><script>// dynamically creates a submenu for the current section based on the content headers
  var titles = document.querySelectorAll('#doc-content h3, #doc-content h4')
  var currentMenu = document.getElementById('doc-menu-section')
  if (titles.length && currentMenu) {
    var submenu = document.createElement('ul')
    titles.forEach(el => {
      var currentSubmenuItem = document.createElement('li')
      var currentSubmenuLink = document.createElement('a')
      currentSubmenuLink.href = '#' + el.id
      currentSubmenuLink.title = el.textContent
      currentSubmenuLink.append(document.createTextNode(el.textContent))
      currentSubmenuItem.append(currentSubmenuLink)
      submenu.append(currentSubmenuItem)
    })
    currentMenu.append(submenu)
  }

  // dynamically creates header anchor links
  var headers = document.querySelectorAll('#doc-content h3, #doc-content h4')
  headers.forEach(el => {
    var currentAnchorLink = document.createElement('a')
    currentAnchorLink.className = 'anchor'
    currentAnchorLink.href = "#" + el.id
    currentAnchorLink.append(document.createTextNode('¶'))
    el.insertBefore(currentAnchorLink, el.firstChild);
  })</script><script>const contentLoaded = document.addEventListener('DOMContentLoaded', setTOCHeight)
  const resize = window.addEventListener('resize', setTOCHeight)

  function setTOCHeight() {
    const docHeight = window.innerHeight
    const tocSidebar = document.querySelector('#toc') || 0

    const tocHeight = docHeight - tocSidebar.getBoundingClientRect().top

    document.documentElement.style
      .setProperty('--TOC-height', `${tocHeight}px`)
  }

  window.addEventListener('beforeunload', () => {
    document.removeEventListener(contentLoaded)
    window.removeEventListener(resize)
  })</script></main><footer class="grey is-primary footer"><div class=container><div class="content has-text-centered"><p>Fastify, Copyright &copy; 2016-2023 <a href=https://openjsf.org/ target=_blank rel=noopener>OpenJS Foundation</a> and <a href=https://github.com/fastify/fastify#team target=_blank rel=noopener>The Fastify team</a>, Licensed under <a href=https://github.com/fastify/fastify/blob/master/LICENSE target=_blank rel=noopener>MIT</a></p><a href=https://www.netlify.com><img src=https://www.netlify.com/img/global/badges/netlify-color-accent.svg alt="Deploys by Netlify" loading=lazy decoding=async></a><p><small>Icons by simpleicons.org</small></p></div></div></footer><script src=/js/main.1e1d476db6c0b326.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js integrity="sha512-s+tOYYcC3Jybgr9mVsdAxsRYlGNq4mlAurOrfNuGMQ/SCofNPu92tjE7YRZCsdEtWL1yGkqk15fU/ark206YTg==" crossorigin=anonymous></script><script>hljs.highlightAll();</script><script src=https://cdn.jsdelivr.net/npm/@docsearch/js@alpha></script><script type=text/javascript>docsearch({
        appId: 'DMPMC33PLU',
        apiKey: '12d46b3bfeee6511031cfe00778f3e45',
        indexName: 'fastify',
        container: '#algolia-search-input',
        algoliaOptions: { 'facetFilters': ["version:latest", "tags:docs"] }
      });</script></body></html>