<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Routes</title><meta name=description content="Fast and low overhead web framework, for Node.js"><link rel=apple-touch-icon sizes=57x57 href=/images/apple-icon-57x57.ed24c0a19503e080.png><link rel=apple-touch-icon sizes=60x60 href=/images/apple-icon-60x60.60c285c424d50738.png><link rel=apple-touch-icon sizes=72x72 href=/images/apple-icon-72x72.e49b27cfe1ab1461.png><link rel=apple-touch-icon sizes=76x76 href=/images/apple-icon-76x76.752f43fc91b8c1f7.png><link rel=apple-touch-icon sizes=114x114 href=/images/apple-icon-114x114.61739fa1d5a7059a.png><link rel=apple-touch-icon sizes=120x120 href=/images/apple-icon-120x120.7c25de37c5ce2ec1.png><link rel=apple-touch-icon sizes=144x144 href=/images/apple-icon-144x144.04d88fb27bd92cbe.png><link rel=apple-touch-icon sizes=152x152 href=/images/apple-icon-152x152.9364781175671626.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-icon-180x180.67579100928bfcd2.png><link rel=icon type=image/png sizes=192x192 href=/images/android-icon-192x192.37eb7f1ae3853740.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.1e22f0e774bc3cce.png><link rel=icon type=image/png sizes=96x96 href=/images/favicon-96x96.7e8a68b1b80c1799.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.e534ce05cb727f1a.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content=#ffffff><meta name=msapplication-TileImage content=/images/ms-icon-144x144.png><meta name=theme-color content=#ffffff><meta property=og:url content=https://www.fastify.io/docs/v3.26.x/Reference/Routes><meta property=og:type content=website><meta property=og:title content=Routes><meta property=og:description content="Fast and low overhead web framework, for Node.js"><meta property=og:image content=https://www.fastify.io/images/fastify-fb-share-image.07b6e6860853c758.png><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@fastifyjs><meta name=twitter:creator content=@fastifyjs><meta name=twitter:title content=Routes><meta name=twitter:description content="Fast and low overhead web framework, for Node.js"><meta name=twitter:image content=https://www.fastify.io/images/fastify-twitter-share-image.cd9f217b360af3e2.png><link rel=stylesheet href=/css/style.f4d6592b3a91c5ef.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/default.min.css integrity="sha512-kZqGbhf9JTB4bVJ0G8HCkqmaPcRgo88F0dneK30yku5Y/dep7CZfCnNml2Je/sY4lBoqoksXz4PtVXS4GHSUzQ==" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@alpha><meta name=robots content="noindex, nofollow"></head><body><nav id=main-navbar class=navbar><div class=navbar-brand><a class=navbar-item href=/ ><img src=/images/fastify-logo-menu.d13f8da7a965c800.png alt="Fastify: Fast and low overhead web framework, for Node.js" height=28 decoding=async> </a><a class="navbar-item is-hidden-desktop" href=https://github.com/fastify/fastify target=_blank rel=noopener><span class=icon style="color: #333;"><i class="fa fa-github"></i></span></a><div class="navbar-burger burger" data-target=mobileMenu><span></span> <span></span> <span></span></div></div><div class=navbar-menu id=mobileMenu><div class=navbar-start><a class=navbar-item href=/ >Home</a> <a class=navbar-item href=/docs/latest>Docs</a> <a class=navbar-item href=/ecosystem>Ecosystem</a> <a class=navbar-item href=/benchmarks>Benchmarks</a> <a class=navbar-item href=/contribute>Contribute</a> <a class=navbar-item href=https://medium.com/@fastifyjs/ >Blog</a> <a class=navbar-item href=https://github.com/fastify/help>Help</a></div><div class=navbar-end><span id=algolia-search-input class="control has-icons-left navbar-item"></span> <a class=navbar-item href=https://github.com/fastify/fastify target=_blank rel=noopener><span class="fa fa-github"></span>&nbsp;GitHub </a><a class=navbar-item href=https://twitter.com/fastifyjs target=_blank rel=noopener><span class="fa fa-twitter"></span>&nbsp;Twitter </a><a class=navbar-item rel=me href=https://fosstodon.org/@fastify target=_blank><span class="fa fa-hashtag"></span>&nbsp;Mastodon</a></div></div></nav><main class=page-content aria-label=Content><section class="hero is-primary" style="background-image: url(/images/bg-pattern-dark.3f8cda863b3bbf52.png)"><div class=hero-body><div class=container><h1 class=title>Documentation (v3.26.0)</h1></div></div></section><section class=section><div class=container><div class=columns><div class="column is-3 is-hidden-mobile sticky-container"><aside class="menu sticky" id=toc><ul class=menu-list></ul><p class=menu-label><a href=/docs/v3.26.x/Guides>Guides</a></p><ul class=menu-list><li style="text-transform: capitalize"><a title=Benchmarking href=/docs/v3.26.x/Guides/Benchmarking>Benchmarking</a></li><li style="text-transform: capitalize"><a title=Contributing href=/docs/v3.26.x/Guides/Contributing>Contributing</a></li><li style="text-transform: capitalize"><a title=Ecosystem href=/docs/v3.26.x/Guides/Ecosystem>Ecosystem</a></li><li style="text-transform: capitalize"><a title=Fluent-Schema href=/docs/v3.26.x/Guides/Fluent-Schema>Fluent-Schema</a></li><li style="text-transform: capitalize"><a title=Getting-Started href=/docs/v3.26.x/Guides/Getting-Started>Getting-Started</a></li><li style="text-transform: capitalize"><a title=Migration-Guide-V3 href=/docs/v3.26.x/Guides/Migration-Guide-V3>Migration-Guide-V3</a></li><li style="text-transform: capitalize"><a title=Plugins-Guide href=/docs/v3.26.x/Guides/Plugins-Guide>Plugins-Guide</a></li><li style="text-transform: capitalize"><a title=Prototype-Poisoning href=/docs/v3.26.x/Guides/Prototype-Poisoning>Prototype-Poisoning</a></li><li style="text-transform: capitalize"><a title=Recommendations href=/docs/v3.26.x/Guides/Recommendations>Recommendations</a></li><li style="text-transform: capitalize"><a title=Serverless href=/docs/v3.26.x/Guides/Serverless>Serverless</a></li><li style="text-transform: capitalize"><a title=Style-Guide href=/docs/v3.26.x/Guides/Style-Guide>Style-Guide</a></li><li style="text-transform: capitalize"><a title=Testing href=/docs/v3.26.x/Guides/Testing>Testing</a></li><li style="text-transform: capitalize"><a title=Write-Plugin href=/docs/v3.26.x/Guides/Write-Plugin>Write-Plugin</a></li></ul><p class=menu-label><a href=/docs/v3.26.x/Reference>Reference</a></p><ul class=menu-list><li style="text-transform: capitalize"><a title=ContentTypeParser href=/docs/v3.26.x/Reference/ContentTypeParser>ContentTypeParser</a></li><li style="text-transform: capitalize"><a title=Decorators href=/docs/v3.26.x/Reference/Decorators>Decorators</a></li><li style="text-transform: capitalize"><a title=Encapsulation href=/docs/v3.26.x/Reference/Encapsulation>Encapsulation</a></li><li style="text-transform: capitalize"><a title=Errors href=/docs/v3.26.x/Reference/Errors>Errors</a></li><li style="text-transform: capitalize"><a title=HTTP2 href=/docs/v3.26.x/Reference/HTTP2>HTTP2</a></li><li style="text-transform: capitalize"><a title=Hooks href=/docs/v3.26.x/Reference/Hooks>Hooks</a></li><li style="text-transform: capitalize"><a title=LTS href=/docs/v3.26.x/Reference/LTS>LTS</a></li><li style="text-transform: capitalize"><a title=Lifecycle href=/docs/v3.26.x/Reference/Lifecycle>Lifecycle</a></li><li style="text-transform: capitalize"><a title=Logging href=/docs/v3.26.x/Reference/Logging>Logging</a></li><li style="text-transform: capitalize"><a title=Middleware href=/docs/v3.26.x/Reference/Middleware>Middleware</a></li><li style="text-transform: capitalize"><a title=Plugins href=/docs/v3.26.x/Reference/Plugins>Plugins</a></li><li style="text-transform: capitalize"><a title=Reply href=/docs/v3.26.x/Reference/Reply>Reply</a></li><li style="text-transform: capitalize"><a title=Request href=/docs/v3.26.x/Reference/Request>Request</a></li><li style="text-transform: capitalize" id=doc-menu-section><a title=Routes class=is-active href=/docs/v3.26.x/Reference/Routes>Routes</a></li><li style="text-transform: capitalize"><a title=Server href=/docs/v3.26.x/Reference/Server>Server</a></li><li style="text-transform: capitalize"><a title=TypeScript href=/docs/v3.26.x/Reference/TypeScript>TypeScript</a></li><li style="text-transform: capitalize"><a title=Validation-and-Serialization href=/docs/v3.26.x/Reference/Validation-and-Serialization>Validation-and-Serialization</a></li></ul><div class=content style="margin: .8em; border-top: 1px solid #ccc; padding: .8em 0 0 0">Docs version<div class=field><div class=control><div class=select><select onchange="if (this.value) window.location.href=this.value"><option value=/docs/latest>latest</option><option value=/docs/master>master</option><option value=/docs/v4.9.x>v4.9.x</option><option value=/docs/v4.8.x>v4.8.x</option><option value=/docs/v4.7.x>v4.7.x</option><option value=/docs/v4.6.x>v4.6.x</option><option value=/docs/v4.5.x>v4.5.x</option><option value=/docs/v4.4.x>v4.4.x</option><option value=/docs/v4.3.x>v4.3.x</option><option value=/docs/v4.2.x>v4.2.x</option><option value=/docs/v4.1.x>v4.1.x</option><option value=/docs/v4.0.x>v4.0.x</option><option value=/docs/v3.29.x>v3.29.x</option><option value=/docs/v3.28.x>v3.28.x</option><option value=/docs/v3.27.x>v3.27.x</option><option selected value=/docs/v3.26.x>v3.26.x</option><option value=/docs/v3.25.x>v3.25.x</option><option value=/docs/v3.24.x>v3.24.x</option><option value=/docs/v3.23.x>v3.23.x</option><option value=/docs/v3.22.x>v3.22.x</option><option value=/docs/v3.21.x>v3.21.x</option><option value=/docs/v3.20.x>v3.20.x</option><option value=/docs/v3.19.x>v3.19.x</option><option value=/docs/v3.18.x>v3.18.x</option><option value=/docs/v3.17.x>v3.17.x</option><option value=/docs/v3.16.x>v3.16.x</option><option value=/docs/v3.15.x>v3.15.x</option><option value=/docs/v3.14.x>v3.14.x</option><option value=/docs/v3.13.x>v3.13.x</option><option value=/docs/v3.12.x>v3.12.x</option><option value=/docs/v3.11.x>v3.11.x</option><option value=/docs/v3.10.x>v3.10.x</option><option value=/docs/v3.9.x>v3.9.x</option><option value=/docs/v3.8.x>v3.8.x</option><option value=/docs/v3.7.x>v3.7.x</option><option value=/docs/v3.6.x>v3.6.x</option><option value=/docs/v3.5.x>v3.5.x</option><option value=/docs/v3.4.x>v3.4.x</option><option value=/docs/v3.3.x>v3.3.x</option><option value=/docs/v3.2.x>v3.2.x</option><option value=/docs/v3.1.x>v3.1.x</option><option value=/docs/v3.0.x>v3.0.x</option><option value=/docs/v2.15.x>v2.15.x</option><option value=/docs/v2.14.x>v2.14.x</option><option value=/docs/v2.13.x>v2.13.x</option><option value=/docs/v2.12.x>v2.12.x</option><option value=/docs/v2.11.x>v2.11.x</option><option value=/docs/v2.10.x>v2.10.x</option><option value=/docs/v2.9.x>v2.9.x</option><option value=/docs/v2.8.x>v2.8.x</option><option value=/docs/v2.7.x>v2.7.x</option><option value=/docs/v2.6.x>v2.6.x</option><option value=/docs/v2.5.x>v2.5.x</option><option value=/docs/v2.4.x>v2.4.x</option><option value=/docs/v2.3.x>v2.3.x</option><option value=/docs/v2.2.x>v2.2.x</option><option value=/docs/v2.1.x>v2.1.x</option><option value=/docs/v2.0.x>v2.0.x</option><option value=/docs/v1.14.x>v1.14.x</option><option value=/docs/v1.13.x>v1.13.x</option></select></div></div></div></div></aside></div><div class="column is-9"><nav class=breadcrumb><ul><li><a href=/ style="padding-left: 0">Fastify</a></li><li><a href=/docs/v3.26.x>Documentation</a></li><li><div class=field><div class=control><div class=select><select onchange="if (this.value) window.location.href=this.value" style="border: none;"><option value=/docs/latest>latest</option><option value=/docs/master>master</option><option value=/docs/v4.9.x>v4.9.x</option><option value=/docs/v4.8.x>v4.8.x</option><option value=/docs/v4.7.x>v4.7.x</option><option value=/docs/v4.6.x>v4.6.x</option><option value=/docs/v4.5.x>v4.5.x</option><option value=/docs/v4.4.x>v4.4.x</option><option value=/docs/v4.3.x>v4.3.x</option><option value=/docs/v4.2.x>v4.2.x</option><option value=/docs/v4.1.x>v4.1.x</option><option value=/docs/v4.0.x>v4.0.x</option><option value=/docs/v3.29.x>v3.29.x</option><option value=/docs/v3.28.x>v3.28.x</option><option value=/docs/v3.27.x>v3.27.x</option><option selected value=/docs/v3.26.x>v3.26.x</option><option value=/docs/v3.25.x>v3.25.x</option><option value=/docs/v3.24.x>v3.24.x</option><option value=/docs/v3.23.x>v3.23.x</option><option value=/docs/v3.22.x>v3.22.x</option><option value=/docs/v3.21.x>v3.21.x</option><option value=/docs/v3.20.x>v3.20.x</option><option value=/docs/v3.19.x>v3.19.x</option><option value=/docs/v3.18.x>v3.18.x</option><option value=/docs/v3.17.x>v3.17.x</option><option value=/docs/v3.16.x>v3.16.x</option><option value=/docs/v3.15.x>v3.15.x</option><option value=/docs/v3.14.x>v3.14.x</option><option value=/docs/v3.13.x>v3.13.x</option><option value=/docs/v3.12.x>v3.12.x</option><option value=/docs/v3.11.x>v3.11.x</option><option value=/docs/v3.10.x>v3.10.x</option><option value=/docs/v3.9.x>v3.9.x</option><option value=/docs/v3.8.x>v3.8.x</option><option value=/docs/v3.7.x>v3.7.x</option><option value=/docs/v3.6.x>v3.6.x</option><option value=/docs/v3.5.x>v3.5.x</option><option value=/docs/v3.4.x>v3.4.x</option><option value=/docs/v3.3.x>v3.3.x</option><option value=/docs/v3.2.x>v3.2.x</option><option value=/docs/v3.1.x>v3.1.x</option><option value=/docs/v3.0.x>v3.0.x</option><option value=/docs/v2.15.x>v2.15.x</option><option value=/docs/v2.14.x>v2.14.x</option><option value=/docs/v2.13.x>v2.13.x</option><option value=/docs/v2.12.x>v2.12.x</option><option value=/docs/v2.11.x>v2.11.x</option><option value=/docs/v2.10.x>v2.10.x</option><option value=/docs/v2.9.x>v2.9.x</option><option value=/docs/v2.8.x>v2.8.x</option><option value=/docs/v2.7.x>v2.7.x</option><option value=/docs/v2.6.x>v2.6.x</option><option value=/docs/v2.5.x>v2.5.x</option><option value=/docs/v2.4.x>v2.4.x</option><option value=/docs/v2.3.x>v2.3.x</option><option value=/docs/v2.2.x>v2.2.x</option><option value=/docs/v2.1.x>v2.1.x</option><option value=/docs/v2.0.x>v2.0.x</option><option value=/docs/v1.14.x>v1.14.x</option><option value=/docs/v1.13.x>v1.13.x</option></select></div></div></div></li><div class=field><div class=control><div class=select><select onchange="if (this.value) window.location.href=this.value" style="border: none;"><option value=/docs/v3.26.x>Documentation</option><option value=/docs/v3.26.x/Guides>Guides</option><option value=/docs/v3.26.x/Guides/Benchmarking>Benchmarking</option><option value=/docs/v3.26.x/Guides/Contributing>Contributing</option><option value=/docs/v3.26.x/Guides/Ecosystem>Ecosystem</option><option value=/docs/v3.26.x/Guides/Fluent-Schema>Fluent-Schema</option><option value=/docs/v3.26.x/Guides/Getting-Started>Getting-Started</option><option value=/docs/v3.26.x/Guides/Migration-Guide-V3>Migration-Guide-V3</option><option value=/docs/v3.26.x/Guides/Plugins-Guide>Plugins-Guide</option><option value=/docs/v3.26.x/Guides/Prototype-Poisoning>Prototype-Poisoning</option><option value=/docs/v3.26.x/Guides/Recommendations>Recommendations</option><option value=/docs/v3.26.x/Guides/Serverless>Serverless</option><option value=/docs/v3.26.x/Guides/Style-Guide>Style-Guide</option><option value=/docs/v3.26.x/Guides/Testing>Testing</option><option value=/docs/v3.26.x/Guides/Write-Plugin>Write-Plugin</option><option value=/docs/v3.26.x/Reference>Reference</option><option value=/docs/v3.26.x/Reference/ContentTypeParser>ContentTypeParser</option><option value=/docs/v3.26.x/Reference/Decorators>Decorators</option><option value=/docs/v3.26.x/Reference/Encapsulation>Encapsulation</option><option value=/docs/v3.26.x/Reference/Errors>Errors</option><option value=/docs/v3.26.x/Reference/HTTP2>HTTP2</option><option value=/docs/v3.26.x/Reference/Hooks>Hooks</option><option value=/docs/v3.26.x/Reference/LTS>LTS</option><option value=/docs/v3.26.x/Reference/Lifecycle>Lifecycle</option><option value=/docs/v3.26.x/Reference/Logging>Logging</option><option value=/docs/v3.26.x/Reference/Middleware>Middleware</option><option value=/docs/v3.26.x/Reference/Plugins>Plugins</option><option value=/docs/v3.26.x/Reference/Reply>Reply</option><option value=/docs/v3.26.x/Reference/Request>Request</option><option selected value=/docs/v3.26.x/Reference/Routes>Routes</option><option value=/docs/v3.26.x/Reference/Server>Server</option><option value=/docs/v3.26.x/Reference/TypeScript>TypeScript</option><option value=/docs/v3.26.x/Reference/Validation-and-Serialization>Validation-and-Serialization</option></select></div></div></div></ul></nav><div id=doc-content class=content><h2 id=routes>Routes</h2><p>The routes methods will configure the endpoints of your application. You have two ways to declare a route with Fastify, the shorthand method and the full declaration.</p><ul><li><a href=#full-declaration>Full declaration</a></li><li><a href=#routes-options>Routes options</a></li><li><a href=#shorthand-declaration>Shorthand declaration</a></li><li><a href=#url-building>Url building</a></li><li><a href=#async-await>Async Await</a></li><li><a href=#promise-resolution>Promise resolution</a></li><li><a href=#route-prefixing>Route Prefixing</a><ul><li><a href=#handling-of--route-inside-prefixed-plugins>Handling of / route inside prefixed plugins</a></li></ul></li><li><a href=#custom-log-level>Custom Log Level</a></li><li><a href=#custom-log-serializer>Custom Log Serializer</a></li><li><a href=#config>Config</a></li><li><a href=#constraints>Constraints</a><ul><li><a href=#version-constraints>Version Constraints</a></li><li><a href=#host-constraints>Host Constraints</a></li></ul></li></ul><h3 id=full-declaration>Full declaration</h3><p><a id=full-declaration></a></p><pre><code class=language-js>fastify.route(options)
</code></pre><h3 id=routes-options>Routes options</h3><p><a id=options></a></p><ul><li><p><code>method</code>: currently it supports <code>&#39;DELETE&#39;</code>, <code>&#39;GET&#39;</code>, <code>&#39;HEAD&#39;</code>, <code>&#39;PATCH&#39;</code>, <code>&#39;POST&#39;</code>, <code>&#39;PUT&#39;</code> and <code>&#39;OPTIONS&#39;</code>. It could also be an array of methods.</p></li><li><p><code>url</code>: the path of the URL to match this route (alias: <code>path</code>).</p></li><li><p><code>schema</code>: an object containing the schemas for the request and response. They need to be in <a href=https://json-schema.org/ >JSON Schema</a> format, check <a href=.././Validation-and-Serialization>here</a> for more info.</p><ul><li><code>body</code>: validates the body of the request if it is a POST, PUT, or PATCH method.</li><li><code>querystring</code> or <code>query</code>: validates the querystring. This can be a complete JSON Schema object, with the property <code>type</code> of <code>object</code> and <code>properties</code> object of parameters, or simply the values of what would be contained in the <code>properties</code> object as shown below.</li><li><code>params</code>: validates the params.</li><li><code>response</code>: filter and generate a schema for the response, setting a schema allows us to have 10-20% more throughput.</li></ul></li><li><p><code>exposeHeadRoute</code>: creates a sibling <code>HEAD</code> route for any <code>GET</code> routes. Defaults to the value of <a href=.././Server#exposeHeadRoutes><code>exposeHeadRoutes</code></a> instance option. If you want a custom <code>HEAD</code> handler without disabling this option, make sure to define it before the <code>GET</code> route.</p></li><li><p><code>attachValidation</code>: attach <code>validationError</code> to request, if there is a schema validation error, instead of sending the error to the error handler.</p></li><li><p><code>onRequest(request, reply, done)</code>: a <a href=.././Hooks#onrequest>function</a> as soon that a request is received, it could also be an array of functions.</p></li><li><p><code>preParsing(request, reply, done)</code>: a <a href=.././Hooks#preparsing>function</a> called before parsing the request, it could also be an array of functions.</p></li><li><p><code>preValidation(request, reply, done)</code>: a <a href=.././Hooks#prevalidation>function</a> called after the shared <code>preValidation</code> hooks, useful if you need to perform authentication at route level for example, it could also be an array of functions.</p></li><li><p><code>preHandler(request, reply, done)</code>: a <a href=.././Hooks#prehandler>function</a> called just before the request handler, it could also be an array of functions.</p></li><li><p><code>preSerialization(request, reply, payload, done)</code>: a <a href=.././Hooks#preserialization>function</a> called just before the serialization, it could also be an array of functions.</p></li><li><p><code>onSend(request, reply, payload, done)</code>: a <a href=.././Hooks#route-hooks>function</a> called right before a response is sent, it could also be an array of functions.</p></li><li><p><code>onResponse(request, reply, done)</code>: a <a href=.././Hooks#onresponse>function</a> called when a response has been sent, so you will not be able to send more data to the client. It could also be an array of functions.</p></li><li><p><code>onTimeout(request, reply, done)</code>: a <a href=.././Hooks#ontimeout>function</a> called when a request is timed out and the HTTP socket has been hanged up.</p></li><li><p><code>onError(request, reply, error, done)</code>: a <a href=.././Hooks#onerror>function</a> called when an Error is thrown or send to the client by the route handler.</p></li><li><p><code>handler(request, reply)</code>: the function that will handle this request. The <a href=.././Server>Fastify server</a> will be bound to <code>this</code> when the handler is called. Note: using an arrow function will break the binding of <code>this</code>.</p></li><li><p><code>errorHandler(error, request, reply)</code>: a custom error handler for the scope of the request. Overrides the default error global handler, and anything set by <a href=.././Server#seterrorhandler><code>setErrorHandler</code></a>, for requests to the route. To access the default handler, you can access <code>instance.errorHandler</code>. Note that this will point to fastify&#39;s default <code>errorHandler</code> only if a plugin hasn&#39;t overridden it already.</p></li><li><p><code>validatorCompiler({ schema, method, url, httpPart })</code>: function that builds schemas for request validations. See the <a href=.././Validation-and-Serialization#schema-validator>Validation and Serialization</a> documentation.</p></li><li><p><code>serializerCompiler({ { schema, method, url, httpStatus } })</code>: function that builds schemas for response serialization. See the <a href=.././Validation-and-Serialization#schema-serializer>Validation and Serialization</a> documentation.</p></li><li><p><code>schemaErrorFormatter(errors, dataVar)</code>: function that formats the errors from the validation compiler. See the <a href=.././Validation-and-Serialization#error-handling>Validation and Serialization</a> documentation. Overrides the global schema error formatter handler, and anything set by <code>setSchemaErrorFormatter</code>, for requests to the route.</p></li><li><p><code>bodyLimit</code>: prevents the default JSON body parser from parsing request bodies larger than this number of bytes. Must be an integer. You may also set this option globally when first creating the Fastify instance with <code>fastify(options)</code>. Defaults to <code>1048576</code> (1 MiB).</p></li><li><p><code>logLevel</code>: set log level for this route. See below.</p></li><li><p><code>logSerializers</code>: set serializers to log for this route.</p></li><li><p><code>config</code>: object used to store custom configuration.</p></li><li><p><code>version</code>: a <a href=https://semver.org/ >semver</a> compatible string that defined the version of the endpoint. <a href=#version-constraints>Example</a>.</p></li><li><p><code>prefixTrailingSlash</code>: string used to determine how to handle passing <code>/</code> as a route with a prefix.</p><ul><li><code>both</code> (default): Will register both <code>/prefix</code> and <code>/prefix/</code>.</li><li><code>slash</code>: Will register only <code>/prefix/</code>.</li><li><code>no-slash</code>: Will register only <code>/prefix</code>.</li></ul><p><code>request</code> is defined in <a href=.././Request>Request</a>.</p><p><code>reply</code> is defined in <a href=.././Reply>Reply</a>.</p></li></ul><p><strong>Notice:</strong> The documentation of <code>onRequest</code>, <code>preParsing</code>, <code>preValidation</code>, <code>preHandler</code>, <code>preSerialization</code>, <code>onSend</code>, and <code>onResponse</code> are described in more detail in <a href=.././Hooks>Hooks</a>. Additionally, to send a response before the request is handled by the <code>handler</code> please refer to <a href=.././Hooks#respond-to-a-request-from-a-hook>Respond to a request from a hook</a>.</p><p>Example:</p><pre><code class=language-js>fastify.route({
  method: &#39;GET&#39;,
  url: &#39;/&#39;,
  schema: {
    querystring: {
      name: { type: &#39;string&#39; },
      excitement: { type: &#39;integer&#39; }
    },
    response: {
      200: {
        type: &#39;object&#39;,
        properties: {
          hello: { type: &#39;string&#39; }
        }
      }
    }
  },
  handler: function (request, reply) {
    reply.send({ hello: &#39;world&#39; })
  }
})
</code></pre><h3 id=shorthand-declaration>Shorthand declaration</h3><p><a id=shorthand-declaration></a></p><p>The above route declaration is more <em>Hapi</em>-like, but if you prefer an <em>Express/Restify</em> approach, we support it as well:</p><p><code>fastify.get(path, [options], handler)</code></p><p><code>fastify.head(path, [options], handler)</code></p><p><code>fastify.post(path, [options], handler)</code></p><p><code>fastify.put(path, [options], handler)</code></p><p><code>fastify.delete(path, [options], handler)</code></p><p><code>fastify.options(path, [options], handler)</code></p><p><code>fastify.patch(path, [options], handler)</code></p><p>Example:</p><pre><code class=language-js>const opts = {
  schema: {
    response: {
      200: {
        type: &#39;object&#39;,
        properties: {
          hello: { type: &#39;string&#39; }
        }
      }
    }
  }
}
fastify.get(&#39;/&#39;, opts, (request, reply) =&gt; {
  reply.send({ hello: &#39;world&#39; })
})
</code></pre><p><code>fastify.all(path, [options], handler)</code> will add the same handler to all the supported methods.</p><p>The handler may also be supplied via the <code>options</code> object:</p><pre><code class=language-js>const opts = {
  schema: {
    response: {
      200: {
        type: &#39;object&#39;,
        properties: {
          hello: { type: &#39;string&#39; }
        }
      }
    }
  },
  handler: function (request, reply) {
    reply.send({ hello: &#39;world&#39; })
  }
}
fastify.get(&#39;/&#39;, opts)
</code></pre><blockquote><p>Note: if the handler is specified in both the <code>options</code> and as the third parameter to the shortcut method then throws duplicate <code>handler</code> error.</p></blockquote><h3 id=url-building>Url building</h3><p><a id=url-building></a></p><p>Fastify supports both static and dynamic URLs.</p><p>To register a <strong>parametric</strong> path, use the <em>colon</em> before the parameter name. For <strong>wildcard</strong>, use the <em>star</em>. <em>Remember that static routes are always checked before parametric and wildcard.</em></p><pre><code class=language-js>// parametric
fastify.get(&#39;/example/:userId&#39;, (request, reply) =&gt; {})
fastify.get(&#39;/example/:userId/:secretToken&#39;, (request, reply) =&gt; {})

// wildcard
fastify.get(&#39;/example/*&#39;, (request, reply) =&gt; {})
</code></pre><p>Regular expression routes are supported as well, but pay attention, RegExp are very expensive in term of performance!</p><pre><code class=language-js>// parametric with regexp
fastify.get(&#39;/example/:file(^\\d+).png&#39;, (request, reply) =&gt; {})
</code></pre><p>It is possible to define more than one parameter within the same couple of slash (&quot;/&quot;). Such as:</p><pre><code class=language-js>fastify.get(&#39;/example/near/:lat-:lng/radius/:r&#39;, (request, reply) =&gt; {})
</code></pre><p><em>Remember in this case to use the dash (&quot;-&quot;) as parameters separator.</em></p><p>Finally it is possible to have multiple parameters with RegExp.</p><pre><code class=language-js>fastify.get(&#39;/example/at/:hour(^\\d{2})h:minute(^\\d{2})m&#39;, (request, reply) =&gt; {})
</code></pre><p>In this case as parameter separator it is possible to use whatever character is not matched by the regular expression.</p><p>Having a route with multiple parameters may affect negatively the performance, so prefer single parameter approach whenever possible, especially on routes that are on the hot path of your application. If you are interested in how we handle the routing, check out <a href=https://github.com/delvedor/find-my-way>find-my-way</a>.</p><p>If you want a path containing a colon without declaring a parameter, use a double colon. For example:</p><pre><code class=language-js>fastify.post(&#39;/name::verb&#39;) // will be interpreted as /name:verb
</code></pre><h3 id=async-await>Async Await</h3><p><a id=async-await></a></p><p>Are you an <code>async/await</code> user? We have you covered!</p><pre><code class=language-js>fastify.get(&#39;/&#39;, options, async function (request, reply) {
  var data = await getData()
  var processed = await processData(data)
  return processed
})
</code></pre><p>As you can see, we are not calling <code>reply.send</code> to send back the data to the user. You just need to return the body and you are done!</p><p>If you need it you can also send back the data to the user with <code>reply.send</code>.</p><pre><code class=language-js>fastify.get(&#39;/&#39;, options, async function (request, reply) {
  var data = await getData()
  var processed = await processData(data)
  reply.send(processed)
})
</code></pre><p>If the route is wrapping a callback-based API that will call <code>reply.send()</code> outside of the promise chain, it is possible to <code>await reply</code>:</p><pre><code class=language-js>fastify.get(&#39;/&#39;, options, async function (request, reply) {
  setImmediate(() =&gt; {
    reply.send({ hello: &#39;world&#39; })
  })
  await reply
})
</code></pre><p>Returning reply also works:</p><pre><code class=language-js>fastify.get(&#39;/&#39;, options, async function (request, reply) {
  setImmediate(() =&gt; {
    reply.send({ hello: &#39;world&#39; })
  })
  return reply
})
</code></pre><p><strong>Warning:</strong></p><ul><li>When using both <code>return value</code> and <code>reply.send(value)</code> at the same time, the first one that happens takes precedence, the second value will be discarded, and a <em>warn</em> log will also be emitted because you tried to send a response twice.</li><li>You cannot return <code>undefined</code>. For more details read <a href=#promise-resolution>promise-resolution</a>.</li></ul><h3 id=promise-resolution>Promise resolution</h3><p><a id=promise-resolution></a></p><p>If your handler is an <code>async</code> function or returns a promise, you should be aware of a special behavior that is necessary to support the callback and promise control-flow. If the handler&#39;s promise is resolved with <code>undefined</code>, it will be ignored causing the request to hang and an <em>error</em> log to be emitted.</p><ol><li>If you want to use <code>async/await</code> or promises but return a value with <code>reply.send</code>:<ul><li><strong>Do not</strong> <code>return</code> any value.</li><li><strong>Do not</strong> forget to call <code>reply.send</code>.</li></ul></li><li>If you want to use <code>async/await</code> or promises:<ul><li><strong>Do not</strong> use <code>reply.send</code>.</li><li><strong>Do not</strong> return <code>undefined</code>.</li></ul></li></ol><p>In this way, we can support both <code>callback-style</code> and <code>async-await</code>, with the minimum trade-off. In spite of so much freedom we highly recommend to go with only one style because error handling should be handled in a consistent way within your application.</p><p><strong>Notice</strong>: Every async function returns a promise by itself.</p><h3 id=route-prefixing>Route Prefixing</h3><p><a id=route-prefixing></a></p><p>Sometimes you need to maintain two or more different versions of the same API; a classic approach is to prefix all the routes with the API version number, <code>/v1/user</code> for example. Fastify offers you a fast and smart way to create different versions of the same API without changing all the route names by hand, <em>route prefixing</em>. Let&#39;s see how it works:</p><pre><code class=language-js>// server.js
const fastify = require(&#39;fastify&#39;)()

fastify.register(require(&#39;./routes/v1/users&#39;), { prefix: &#39;/v1&#39; })
fastify.register(require(&#39;./routes/v2/users&#39;), { prefix: &#39;/v2&#39; })

fastify.listen(3000)
</code></pre><pre><code class=language-js>// routes/v1/users.js
module.exports = function (fastify, opts, done) {
  fastify.get(&#39;/user&#39;, handler_v1)
  done()
}
</code></pre><pre><code class=language-js>// routes/v2/users.js
module.exports = function (fastify, opts, done) {
  fastify.get(&#39;/user&#39;, handler_v2)
  done()
}
</code></pre><p>Fastify will not complain because you are using the same name for two different routes, because at compilation time it will handle the prefix automatically <em>(this also means that the performance will not be affected at all!)</em>.</p><p>Now your clients will have access to the following routes:</p><ul><li><code>/v1/user</code></li><li><code>/v2/user</code></li></ul><p>You can do this as many times as you want, it works also for nested <code>register</code> and routes parameter are supported as well. Be aware that if you use <a href=https://github.com/fastify/fastify-plugin><code>fastify-plugin</code></a> this option will not work.</p><h4 id=handling-of--route-inside-prefixed-plugins>Handling of / route inside prefixed plugins</h4><p>The <code>/</code> route has a different behavior depending on if the prefix ends with <code>/</code> or not. As an example, if we consider a prefix <code>/something/</code>, adding a <code>/</code> route will only match <code>/something/</code>. If we consider a prefix <code>/something</code>, adding a <code>/</code> route will match both <code>/something</code> and <code>/something/</code>.</p><p>See the <code>prefixTrailingSlash</code> route option above to change this behavior.</p><h3 id=custom-log-level>Custom Log Level</h3><p><a id=custom-log-level></a></p><p>It could happen that you need different log levels in your routes; Fastify achieves this in a very straightforward way.</p><p>You just need to pass the option <code>logLevel</code> to the plugin option or the route option with the <a href=https://github.com/pinojs/pino/blob/master/docs/api.md#level-string>value</a> that you need.</p><p>Be aware that if you set the <code>logLevel</code> at plugin level, also the <a href=.././Server#setnotfoundhandler><code>setNotFoundHandler</code></a> and <a href=.././Server#seterrorhandler><code>setErrorHandler</code></a> will be affected.</p><pre><code class=language-js>// server.js
const fastify = require(&#39;fastify&#39;)({ logger: true })

fastify.register(require(&#39;./routes/user&#39;), { logLevel: &#39;warn&#39; })
fastify.register(require(&#39;./routes/events&#39;), { logLevel: &#39;debug&#39; })

fastify.listen(3000)
</code></pre><p>Or you can directly pass it to a route:</p><pre><code class=language-js>fastify.get(&#39;/&#39;, { logLevel: &#39;warn&#39; }, (request, reply) =&gt; {
  reply.send({ hello: &#39;world&#39; })
})
</code></pre><p><em>Remember that the custom log level is applied only to the routes, and not to the global Fastify Logger, accessible with <code>fastify.log</code></em></p><h3 id=custom-log-serializer>Custom Log Serializer</h3><p><a id=custom-log-serializer></a></p><p>In some context, you may need to log a large object but it could be a waste of resources for some routes. In this case, you can define some <a href=https://github.com/pinojs/pino/blob/master/docs/api.md#serializers-object><code>serializer</code></a> and attach them in the right context!</p><pre><code class=language-js>const fastify = require(&#39;fastify&#39;)({ logger: true })

fastify.register(require(&#39;./routes/user&#39;), {
  logSerializers: {
    user: (value) =&gt; `My serializer one - ${value.name}`
  }
})
fastify.register(require(&#39;./routes/events&#39;), {
  logSerializers: {
    user: (value) =&gt; `My serializer two - ${value.name} ${value.surname}`
  }
})

fastify.listen(3000)
</code></pre><p>You can inherit serializers by context:</p><pre><code class=language-js>const fastify = Fastify({
  logger: {
    level: &#39;info&#39;,
    serializers: {
      user (req) {
        return {
          method: req.method,
          url: req.url,
          headers: req.headers,
          hostname: req.hostname,
          remoteAddress: req.ip,
          remotePort: req.socket.remotePort
        }
      }
    }
  }
})

fastify.register(context1, {
  logSerializers: {
    user: value =&gt; `My serializer father - ${value}`
  }
})

async function context1 (fastify, opts) {
  fastify.get(&#39;/&#39;, (req, reply) =&gt; {
    req.log.info({ user: &#39;call father serializer&#39;, key: &#39;another key&#39; })
    // shows: { user: &#39;My serializer father - call father  serializer&#39;, key: &#39;another key&#39; }
    reply.send({})
  })
}

fastify.listen(3000)
</code></pre><h3 id=config>Config</h3><p><a id=routes-config></a></p><p>Registering a new handler, you can pass a configuration object to it and retrieve it in the handler.</p><pre><code class=language-js>// server.js
const fastify = require(&#39;fastify&#39;)()

function handler (req, reply) {
  reply.send(reply.context.config.output)
}

fastify.get(&#39;/en&#39;, { config: { output: &#39;hello world!&#39; } }, handler)
fastify.get(&#39;/it&#39;, { config: { output: &#39;ciao mondo!&#39; } }, handler)

fastify.listen(3000)
</code></pre><h3 id=constraints>Constraints</h3><p><a id=constraints></a></p><p>Fastify supports constraining routes to match only certain requests based on some property of the request, like the <code>Host</code> header, or any other value via <a href=https://github.com/delvedor/find-my-way><code>find-my-way</code></a> constraints. Constraints are specified in the <code>constraints</code> property of the route options. Fastify has two built-in constraints ready for use: the <code>version</code> constraint and the <code>host</code> constraint, and you can add your own custom constraint strategies to inspect other parts of a request to decide if a route should be executed for a request.</p><h4 id=version-constraints>Version Constraints</h4><p>You can provide a <code>version</code> key in the <code>constraints</code> option to a route. Versioned routes allow you to declare multiple handlers for the same HTTP route path, which will then be matched according to each request&#39;s <code>Accept-Version</code> header. The <code>Accept-Version</code> header value should follow the <a href=http://semver.org/ >semver</a> specification, and routes should be declared with exact semver versions for matching.</p><p>Fastify will require a request <code>Accept-Version</code> header to be set if the route has a version set, and will prefer a versioned route to a non-versioned route for the same path. Advanced version ranges and pre-releases currently are not supported.</p><p><em>Be aware that using this feature will cause a degradation of the overall performances of the router.</em></p><pre><code class=language-js>fastify.route({
  method: &#39;GET&#39;,
  url: &#39;/&#39;,
  constraints: { version: &#39;1.2.0&#39; },
  handler: function (request, reply) {
    reply.send({ hello: &#39;world&#39; })
  }
})

fastify.inject({
  method: &#39;GET&#39;,
  url: &#39;/&#39;,
  headers: {
    &#39;Accept-Version&#39;: &#39;1.x&#39; // it could also be &#39;1.2.0&#39; or &#39;1.2.x&#39;
  }
}, (err, res) =&gt; {
  // { hello: &#39;world&#39; }
})
</code></pre><blockquote><h2 id=⚠--security-notice>⚠ Security Notice</h2><p>Remember to set a <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Vary><code>Vary</code></a> header in your responses with the value you are using for defining the versioning (e.g.: <code>&#39;Accept-Version&#39;</code>), to prevent cache poisoning attacks. You can also configure this as part of your Proxy/CDN.</p><pre><code class=language-js>const append = require(&#39;vary&#39;).append
fastify.addHook(&#39;onSend&#39;, async (req, reply) =&gt; {
  if (req.headers[&#39;accept-version&#39;]) { // or the custom header you are using
    let value = reply.getHeader(&#39;Vary&#39;) || &#39;&#39;
    const header = Array.isArray(value) ? value.join(&#39;, &#39;) : String(value)
    if ((value = append(header, &#39;Accept-Version&#39;))) { // or the custom header you are using
      reply.header(&#39;Vary&#39;, value)
    }
  }
})
</code></pre></blockquote><p>If you declare multiple versions with the same major or minor, Fastify will always choose the highest compatible with the <code>Accept-Version</code> header value.</p><p>If the request will not have the <code>Accept-Version</code> header, a 404 error will be returned.</p><p>It is possible to define a custom version matching logic. This can be done through the <a href=.././Server#constraints><code>constraints</code></a> configuration when creating a Fastify server instance.</p><h4 id=host-constraints>Host Constraints</h4><p>You can provide a <code>host</code> key in the <code>constraints</code> route option for to limit that route to only be matched for certain values of the request <code>Host</code> header. <code>host</code> constraint values can be specified as strings for exact matches or RegExps for arbitrary host matching.</p><pre><code class=language-js>fastify.route({
  method: &#39;GET&#39;,
  url: &#39;/&#39;,
  constraints: { host: &#39;auth.fastify.io&#39; },
  handler: function (request, reply) {
    reply.send(&#39;hello world from auth.fastify.io&#39;)
  }
})

fastify.inject({
  method: &#39;GET&#39;,
  url: &#39;/&#39;,
  headers: {
    &#39;Host&#39;: &#39;example.com&#39;
  }
}, (err, res) =&gt; {
  // 404 because the host doesn&#39;t match the constraint
})

fastify.inject({
  method: &#39;GET&#39;,
  url: &#39;/&#39;,
  headers: {
    &#39;Host&#39;: &#39;auth.fastify.io&#39;
  }
}, (err, res) =&gt; {
  // =&gt; &#39;hello world from auth.fastify.io&#39;
})
</code></pre><p>RegExp <code>host</code> constraints can also be specified allowing constraining to hosts matching wildcard subdomains (or any other pattern):</p><pre><code class=language-js>fastify.route({
  method: &#39;GET&#39;,
  url: &#39;/&#39;,
  constraints: { host: /.*\.fastify\.io/ }, // will match any subdomain of fastify.io
  handler: function (request, reply) {
    reply.send(&#39;hello world from &#39; + request.headers.host)
  }
})
</code></pre></div><hr><nav class=level></nav></div></div></div></section><script>// dynamically creates a submenu for the current section based on the content headers
  var titles = document.querySelectorAll('#doc-content h3, #doc-content h4')
  var currentMenu = document.getElementById('doc-menu-section')
  if (titles.length && currentMenu) {
    var submenu = document.createElement('ul')
    titles.forEach(el => {
      var currentSubmenuItem = document.createElement('li')
      var currentSubmenuLink = document.createElement('a')
      currentSubmenuLink.href = '#' + el.id
      currentSubmenuLink.title = el.textContent
      currentSubmenuLink.append(document.createTextNode(el.textContent))
      currentSubmenuItem.append(currentSubmenuLink)
      submenu.append(currentSubmenuItem)
    })
    currentMenu.append(submenu)
  }

  // dynamically creates header anchor links
  var headers = document.querySelectorAll('#doc-content h3, #doc-content h4')
  headers.forEach(el => {
    var currentAnchorLink = document.createElement('a')
    currentAnchorLink.className = 'anchor'
    currentAnchorLink.href = "#" + el.id
    currentAnchorLink.append(document.createTextNode('¶'))
    el.insertBefore(currentAnchorLink, el.firstChild);
  })</script><script>const contentLoaded = document.addEventListener('DOMContentLoaded', setTOCHeight)
  const resize = window.addEventListener('resize', setTOCHeight)

  function setTOCHeight() {
    const docHeight = window.innerHeight
    const tocSidebar = document.querySelector('#toc') || 0

    const tocHeight = docHeight - tocSidebar.getBoundingClientRect().top

    document.documentElement.style
      .setProperty('--TOC-height', `${tocHeight}px`)
  }

  window.addEventListener('beforeunload', () => {
    document.removeEventListener(contentLoaded)
    window.removeEventListener(resize)
  })</script></main><footer class="grey is-primary footer"><div class=container><div class="content has-text-centered"><p>Fastify, Copyright &copy; 2016-2022 <a href=https://openjsf.org/ target=_blank rel=noopener>OpenJS Foundation</a> and <a href=https://github.com/fastify/fastify#team target=_blank rel=noopener>The Fastify team</a>, Licensed under <a href=https://github.com/fastify/fastify/blob/master/LICENSE target=_blank rel=noopener>MIT</a></p><a href=https://www.netlify.com><img src=https://www.netlify.com/img/global/badges/netlify-color-accent.svg alt="Deploys by Netlify" loading=lazy decoding=async></a><p><small>Icons by simpleicons.org</small></p></div></div></footer><script src=/js/main.1e1d476db6c0b326.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js integrity="sha512-s+tOYYcC3Jybgr9mVsdAxsRYlGNq4mlAurOrfNuGMQ/SCofNPu92tjE7YRZCsdEtWL1yGkqk15fU/ark206YTg==" crossorigin=anonymous></script><script>hljs.highlightAll();</script><script src=https://cdn.jsdelivr.net/npm/@docsearch/js@alpha></script><script type=text/javascript>docsearch({
        appId: 'DMPMC33PLU',
        apiKey: '12d46b3bfeee6511031cfe00778f3e45',
        indexName: 'fastify',
        container: '#algolia-search-input',
        algoliaOptions: { 'facetFilters': ["version:latest", "tags:docs"] }
      });</script></body></html>